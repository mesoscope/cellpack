

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>cellpack.mgl_tools.DejaVu.Geom &mdash; cellPack 0.1.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> cellPack
          

          
          </a>

          
            
            
              <div class="version">
                0.1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../installation.html#stable-release">Stable release</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../installation.html#from-sources">From sources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../modules.html">Package modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../cellpack.html">cellpack package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../cellpack.html#subpackages">Subpackages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../cellpack.autopack.html">cellpack.autopack package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cellpack.bin.html">cellpack.bin package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cellpack.mgl_tools.html">cellpack.mgl_tools package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../cellpack.html#submodules">Submodules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../cellpack.html#module-cellpack.example">cellpack.example module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../cellpack.html#module-cellpack">Module contents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../contributing.html#get-started">Get Started!</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../contributing.html#deploying">Deploying</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">cellPack</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../../cellpack.html">cellpack</a> &raquo;</li>
        
      <li>cellpack.mgl_tools.DejaVu.Geom</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for cellpack.mgl_tools.DejaVu.Geom</h1><div class="highlight"><pre>
<span></span><span class="c1">## Automatically adapted for numpy.oldnumeric Jul 23, 2007 by</span>

<span class="c1">#############################################################################</span>
<span class="c1">#</span>
<span class="c1"># Author: Michel F. SANNER, Daniel Stoffler</span>
<span class="c1">#</span>
<span class="c1"># Copyright: M. Sanner, Daniel Stoffler TSRI 2000</span>
<span class="c1">#</span>
<span class="c1"># Revision: Guillaume Vareille</span>
<span class="c1">#</span>
<span class="c1">#############################################################################</span>

<span class="c1">#</span>
<span class="c1"># $Header: /opt/cvs/python/packages/share1.5/DejaVu/Geom.py,v 1.262 2010/10/22 19:36:31 sanner Exp $</span>
<span class="c1">#</span>
<span class="c1"># $Id: Geom.py,v 1.262 2010/10/22 19:36:31 sanner Exp $</span>
<span class="c1">#</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">from</span> <span class="nn">cellpack.mgl_tools</span> <span class="kn">import</span> <span class="n">DejaVu</span> <span class="k">as</span> <span class="n">DejaVu</span>
<span class="kn">import</span> <span class="nn">cellpack.mgl_tools.oldnumeric</span> <span class="k">as</span> <span class="nn">Numeric</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">Materials</span><span class="p">,</span> <span class="n">datamodel</span><span class="p">,</span> <span class="n">Clip</span>
<span class="kn">from</span> <span class="nn">.colorTool</span> <span class="kn">import</span> <span class="n">OneColor</span><span class="p">,</span> <span class="n">resetMaterialMemory</span>
<span class="kn">from</span> <span class="nn">.Transformable</span> <span class="kn">import</span> <span class="n">Transformable</span>
<span class="kn">from</span> <span class="nn">.Displayable</span> <span class="kn">import</span> <span class="n">Displayable</span>
<span class="kn">from</span> <span class="nn">.viewerFns</span> <span class="kn">import</span> <span class="n">checkKeywords</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">viewerConst</span>
<span class="kn">from</span> <span class="nn">.Common2d3dObject</span> <span class="kn">import</span> <span class="n">Common2d3dObject</span>

<span class="n">lib</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">cellpack.mgl_tools.opengltk.OpenGL</span> <span class="kn">import</span> <span class="n">GL</span>
    <span class="kn">from</span> <span class="nn">cellpack.mgl_tools.opengltk.extent</span> <span class="kn">import</span> <span class="n">_gllib</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">lib</span> <span class="o">=</span> <span class="kc">False</span>


<div class="viewcode-block" id="Geom"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom">[docs]</a><span class="k">class</span> <span class="nc">Geom</span><span class="p">(</span><span class="n">Common2d3dObject</span><span class="p">,</span> <span class="n">Transformable</span><span class="p">,</span> <span class="n">Displayable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for objects that can be displayed in a camera&quot;&quot;&quot;</span>

    <span class="n">_numberOfDeletedGeoms</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">##      def __del__(self):</span>
    <span class="c1">##          self.__class__._numberOfDeletedGeoms = self.__class__._numberOfDeletedGeoms + 1</span>
    <span class="c1">##          print &#39;Free Geom &#39;, self.__class__.__name__</span>

    <span class="n">keywords</span> <span class="o">=</span> <span class="n">Common2d3dObject</span><span class="o">.</span><span class="n">keywords</span> <span class="o">+</span> <span class="p">[</span>
        <span class="c1">#&#39;antialiased&#39;,</span>
        <span class="s2">&quot;backPolyMode&quot;</span><span class="p">,</span>
        <span class="s2">&quot;blendFunctions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;culling&quot;</span><span class="p">,</span>
        <span class="s2">&quot;depthMask&quot;</span><span class="p">,</span>
        <span class="s2">&quot;disableStencil&quot;</span><span class="p">,</span>
        <span class="s2">&quot;frontPolyMode&quot;</span><span class="p">,</span>
        <span class="s2">&quot;highlight&quot;</span><span class="p">,</span>
        <span class="s2">&quot;inheritBackPolyMode&quot;</span><span class="p">,</span>
        <span class="s2">&quot;inheritCulling&quot;</span><span class="p">,</span>
        <span class="s2">&quot;inheritFrontPolyMode&quot;</span><span class="p">,</span>
        <span class="s2">&quot;inheritLighting&quot;</span><span class="p">,</span>
        <span class="s2">&quot;inheritStippleLines&quot;</span><span class="p">,</span>
        <span class="s2">&quot;inheritLineWidth&quot;</span><span class="p">,</span>
        <span class="s2">&quot;inheritMaterial&quot;</span><span class="p">,</span>
        <span class="s2">&quot;inheritPointWidth&quot;</span><span class="p">,</span>
        <span class="s2">&quot;inheritStipplePolygons&quot;</span><span class="p">,</span>
        <span class="s2">&quot;inheritShading&quot;</span><span class="p">,</span>
        <span class="s2">&quot;inheritSharpColorBoundaries&quot;</span><span class="p">,</span>
        <span class="s2">&quot;inheritXform&quot;</span><span class="p">,</span>
        <span class="s2">&quot;instanceMatricesFromFortran&quot;</span><span class="p">,</span>
        <span class="s2">&quot;instanceMatricesFromC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;instanceMatrices&quot;</span><span class="p">,</span>
        <span class="s2">&quot;invertNormals&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lighting&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lineWidth&quot;</span><span class="p">,</span>
        <span class="s2">&quot;matBind&quot;</span><span class="p">,</span>
        <span class="s2">&quot;materials&quot;</span><span class="p">,</span>
        <span class="s2">&quot;matInd&quot;</span><span class="p">,</span>
        <span class="s2">&quot;matMask&quot;</span><span class="p">,</span>
        <span class="s2">&quot;matName&quot;</span><span class="p">,</span>
        <span class="s2">&quot;opacity&quot;</span><span class="p">,</span>
        <span class="s2">&quot;outline&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pickableVertices&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pivot&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pointWidth&quot;</span><span class="p">,</span>
        <span class="s2">&quot;polyFace&quot;</span><span class="p">,</span>
        <span class="s2">&quot;propName&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rawMaterialB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rawMaterialF&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rotation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;scale&quot;</span><span class="p">,</span>
        <span class="s2">&quot;scissor&quot;</span><span class="p">,</span>
        <span class="s2">&quot;scissorAspectRatio&quot;</span><span class="p">,</span>
        <span class="s2">&quot;scissorH&quot;</span><span class="p">,</span>
        <span class="s2">&quot;scissorX&quot;</span><span class="p">,</span>
        <span class="s2">&quot;scissorY&quot;</span><span class="p">,</span>
        <span class="s2">&quot;scissorW&quot;</span><span class="p">,</span>
        <span class="s2">&quot;shading&quot;</span><span class="p">,</span>
        <span class="s2">&quot;shape&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sharpColorBoundaries&quot;</span><span class="p">,</span>
        <span class="s2">&quot;stippleLines&quot;</span><span class="p">,</span>
        <span class="s2">&quot;stipplePolygons&quot;</span><span class="p">,</span>
        <span class="s2">&quot;texture&quot;</span><span class="p">,</span>
        <span class="s2">&quot;textureCoords&quot;</span><span class="p">,</span>
        <span class="s2">&quot;transient&quot;</span><span class="p">,</span>
        <span class="s2">&quot;translation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;transparent&quot;</span><span class="p">,</span>  <span class="c1"># is also set when materials are defines</span>
        <span class="s2">&quot;vertices&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vertexArrayFlag&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vnormals&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vreshape&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">sourceBlendFunctions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">destBlendFunctions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">lib</span><span class="p">:</span>
        <span class="n">sourceBlendFunctions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">GL</span><span class="o">.</span><span class="n">GL_ZERO</span><span class="p">,</span>
            <span class="n">GL</span><span class="o">.</span><span class="n">GL_ONE</span><span class="p">,</span>
            <span class="n">GL</span><span class="o">.</span><span class="n">GL_DST_COLOR</span><span class="p">,</span>
            <span class="n">GL</span><span class="o">.</span><span class="n">GL_ONE_MINUS_DST_COLOR</span><span class="p">,</span>
            <span class="n">GL</span><span class="o">.</span><span class="n">GL_SRC_ALPHA</span><span class="p">,</span>
            <span class="n">GL</span><span class="o">.</span><span class="n">GL_ONE_MINUS_SRC_ALPHA</span><span class="p">,</span>
            <span class="n">GL</span><span class="o">.</span><span class="n">GL_DST_ALPHA</span><span class="p">,</span>
            <span class="n">GL</span><span class="o">.</span><span class="n">GL_ONE_MINUS_DST_ALPHA</span><span class="p">,</span>
            <span class="n">GL</span><span class="o">.</span><span class="n">GL_SRC_ALPHA_SATURATE</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">destBlendFunctions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">GL</span><span class="o">.</span><span class="n">GL_ZERO</span><span class="p">,</span>
            <span class="n">GL</span><span class="o">.</span><span class="n">GL_ONE</span><span class="p">,</span>
            <span class="n">GL</span><span class="o">.</span><span class="n">GL_SRC_COLOR</span><span class="p">,</span>
            <span class="n">GL</span><span class="o">.</span><span class="n">GL_ONE_MINUS_SRC_COLOR</span><span class="p">,</span>
            <span class="n">GL</span><span class="o">.</span><span class="n">GL_SRC_ALPHA</span><span class="p">,</span>
            <span class="n">GL</span><span class="o">.</span><span class="n">GL_ONE_MINUS_SRC_ALPHA</span><span class="p">,</span>
            <span class="n">GL</span><span class="o">.</span><span class="n">GL_DST_ALPHA</span><span class="p">,</span>
            <span class="n">GL</span><span class="o">.</span><span class="n">GL_ONE_MINUS_DST_ALPHA</span><span class="p">,</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="c1"># print &quot;Geom.__init__&quot;</span>

        <span class="n">Transformable</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">Displayable</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clipP</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of clipping planes clipping only self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clipPI</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of clipping planes that are inherited</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clipSide</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 1 or -1 for each cliping plane</span>
        <span class="c1"># FIXME side should be stored in clipping plane</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scissor</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scissorX</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scissorY</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scissorW</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scissorH</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scissorAspectRatio</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">drawBB</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colorBB</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineWidthBB</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pickableVertices</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># when set individual vertices</span>
        <span class="c1"># in geom can be picked</span>

        <span class="c1"># bounding box defaults, get overwritten in ObjSubTreeBB</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxBB</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minBB</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lighting</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dpyList</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># display list for drawing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redoDspLst</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># set to 1 to for Display List re-calculation</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pickDpyList</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># display list for picking</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">normals</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vertexNormals</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">faceNormals</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">invertNormals</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sharpColorBoundaries</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;sharpColorBoundaries&quot;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">kw</span><span class="p">[</span><span class="s2">&quot;sharpColorBoundaries&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">inheritSharpColorBoundaries</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;inheritSharpColorBoundaries&quot;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">kw</span><span class="p">[</span><span class="s2">&quot;inheritSharpColorBoundaries&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># print &quot;kw[&#39;inheritSharpColorBoundaries&#39;]&quot;, kw[&#39;inheritSharpColorBoundaries&#39;]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;disableStencil&quot;</span><span class="p">):</span>
            <span class="n">kw</span><span class="p">[</span><span class="s2">&quot;disableStencil&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># if not kw.get(&#39;vertexArrayFlag&#39;):</span>
        <span class="c1">#    kw[&#39;vertexArrayFlag&#39;] = False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">highlight</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">DejaVu</span><span class="o">.</span><span class="n">enableVertexArray</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertexArrayFlag</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">kw</span><span class="p">[</span><span class="s2">&quot;immediateRendering&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertexArrayFlagBufferList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertexArrayFlag</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">Common2d3dObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">check</span><span class="p">),</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">ashape</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cap</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># set to GL.CLIP_PLANE[0,..6] to cap geometry</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capMesh</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># set to o or 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capFrontColor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capBackColor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<div class="viewcode-block" id="Geom.getState"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.getState">[docs]</a>    <span class="k">def</span> <span class="nf">getState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;return a dictionary describing this object&#39;s state</span>
<span class="sd">This dictionary can be passed to the Set method to restore the object&#39;s state</span>
<span class="sd">If full is True: large arrays such as vertices, materials, normals etc are also</span>
<span class="sd">saved in the state</span>
<span class="sd">&quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">Common2d3dObject</span><span class="o">.</span><span class="n">getState</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">lUpdate</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1">#&#39;antialiased&#39;:self.antialiased,</span>
            <span class="s2">&quot;backPolyMode&quot;</span><span class="p">:</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">POLYGON_MODES_REV</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">backPolyMode</span><span class="p">],</span>
            <span class="c1">#&#39;blendFunctions&#39;: see bellow</span>
            <span class="s2">&quot;culling&quot;</span><span class="p">:</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">CULLINGS_REV</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">culling</span><span class="p">],</span>  <span class="c1"># see bellow</span>
            <span class="s2">&quot;depthMask&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">depthMask</span><span class="p">,</span>
            <span class="s2">&quot;disableStencil&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">disableStencil</span><span class="p">,</span>
            <span class="s2">&quot;frontPolyMode&quot;</span><span class="p">:</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">POLYGON_MODES_REV</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frontPolyMode</span><span class="p">],</span>
            <span class="s2">&quot;inheritBackPolyMode&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">inheritBackPolyMode</span><span class="p">,</span>
            <span class="s2">&quot;inheritCulling&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">inheritCulling</span><span class="p">,</span>
            <span class="s2">&quot;inheritFrontPolyMode&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">inheritFrontPolyMode</span><span class="p">,</span>
            <span class="s2">&quot;inheritLighting&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">inheritLighting</span><span class="p">,</span>
            <span class="s2">&quot;inheritStippleLines&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">inheritStippleLines</span><span class="p">,</span>
            <span class="s2">&quot;inheritLineWidth&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">inheritLineWidth</span><span class="p">,</span>
            <span class="s2">&quot;inheritMaterial&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">inheritMaterial</span><span class="p">,</span>
            <span class="s2">&quot;inheritPointWidth&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">inheritPointWidth</span><span class="p">,</span>
            <span class="s2">&quot;inheritStipplePolygons&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">inheritStipplePolygons</span><span class="p">,</span>
            <span class="s2">&quot;inheritShading&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">inheritShading</span><span class="p">,</span>
            <span class="s2">&quot;inheritSharpColorBoundaries&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">inheritSharpColorBoundaries</span><span class="p">,</span>
            <span class="s2">&quot;inheritXform&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">inheritXform</span><span class="p">,</span>
            <span class="s2">&quot;instanceMatricesFromFortran&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">instanceMatricesFortran</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="s2">&quot;invertNormals&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">invertNormals</span><span class="p">,</span>
            <span class="s2">&quot;lighting&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">lighting</span><span class="p">,</span>
            <span class="s2">&quot;lineWidth&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineWidth</span><span class="p">,</span>
            <span class="c1">#&#39;matBind&#39;: covered by materialCode</span>
            <span class="c1">#&#39;materials&#39;: covered by materialCode</span>
            <span class="c1">#&#39;matInd&#39;: covered by materialCode</span>
            <span class="c1">#&#39;matMask&#39;: covered by materialCode</span>
            <span class="c1">#&#39;matName&#39;: covered by materialCode</span>
            <span class="c1">#&#39;opacity&#39;: covered by materialCode</span>
            <span class="s2">&quot;outline&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawOutline</span><span class="p">,</span>
            <span class="s2">&quot;pickableVertices&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pickableVertices</span><span class="p">,</span>
            <span class="s2">&quot;pivot&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pivot</span><span class="p">),</span>
            <span class="s2">&quot;pointWidth&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pointWidth</span><span class="p">,</span>
            <span class="c1">#&#39;polyFace&#39;: covered by materialCode</span>
            <span class="c1">#&#39;propName&#39;: covered by materialCode</span>
            <span class="c1">#&#39;rawMaterialB&#39;: covered by materialCode</span>
            <span class="c1">#&#39;rawMaterialF&#39;: covered by materialCode</span>
            <span class="s2">&quot;rotation&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="p">),</span>
            <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">),</span>
            <span class="s2">&quot;shading&quot;</span><span class="p">:</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">SHADINGS_REV</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shading</span><span class="p">],</span>
            <span class="c1">#&#39;shape&#39;: geometry definition rather than attributes</span>
            <span class="s2">&quot;stippleLines&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stippleLines</span><span class="p">,</span>
            <span class="s2">&quot;stipplePolygons&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stipplePolygons</span><span class="p">,</span>
            <span class="s2">&quot;scissor&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scissor</span><span class="p">,</span>
            <span class="s2">&quot;scissorAspectRatio&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scissorAspectRatio</span><span class="p">,</span>
            <span class="s2">&quot;scissorH&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scissorH</span><span class="p">,</span>
            <span class="s2">&quot;scissorX&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scissorX</span><span class="p">,</span>
            <span class="s2">&quot;scissorY&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scissorY</span><span class="p">,</span>
            <span class="s2">&quot;scissorW&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scissorW</span><span class="p">,</span>
            <span class="s2">&quot;sharpColorBoundaries&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sharpColorBoundaries</span><span class="p">,</span>
            <span class="c1">#&#39;texture&#39;: FIXME TODO</span>
            <span class="c1">#&#39;textureCoords&#39;: FIXME TODO</span>
            <span class="c1">#&#39;transient&#39;: covered by visible</span>
            <span class="s2">&quot;translation&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">translation</span><span class="p">),</span>
            <span class="s2">&quot;transparent&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">transparent</span> <span class="ow">is</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;vertexArrayFlag&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexArrayFlag</span><span class="p">,</span>
            <span class="c1">#&#39;vertices&#39;: geometry definition rather than attributes</span>
            <span class="c1">#&#39;vnormals&#39;: geometry definition rather than attributes</span>
            <span class="c1">#&#39;vreshape&#39;: geometry definition rather than attributes</span>
        <span class="p">}</span>
        <span class="n">state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lUpdate</span><span class="p">)</span>

        <span class="c1">#        val = self.culling</span>
        <span class="c1">#        if   val==viewerConst.INHERIT: val=&quot;inherit&quot;</span>
        <span class="c1">#        elif val==GL.GL_NONE: val=&quot;none&quot;</span>
        <span class="c1">#        elif val==GL.GL_FRONT: val=&quot;front&quot;</span>
        <span class="c1">#        elif val==GL.GL_BACK: val=&quot;back&quot;</span>
        <span class="c1">#        elif val==GL.GL_FRONT_AND_BACK: val=&quot;front_and_back&quot;</span>
        <span class="c1">#        state[&#39;culling&#39;]=val</span>

        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">srcBlendFunc</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_ZERO</span><span class="p">:</span>
            <span class="n">val1</span> <span class="o">=</span> <span class="s2">&quot;GL_ZERO&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_ONE</span><span class="p">:</span>
            <span class="n">val1</span> <span class="o">=</span> <span class="s2">&quot;GL_ONE&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_DST_COLOR</span><span class="p">:</span>
            <span class="n">val1</span> <span class="o">=</span> <span class="s2">&quot;GL_DST_COLOR&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_ONE_MINUS_DST_COLOR</span><span class="p">:</span>
            <span class="n">val1</span> <span class="o">=</span> <span class="s2">&quot;GL_ONE_MINUS_DST_COLOR&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_SRC_ALPHA</span><span class="p">:</span>
            <span class="n">val1</span> <span class="o">=</span> <span class="s2">&quot;GL_SRC_ALPHA&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_ONE_MINUS_SRC_ALPHA</span><span class="p">:</span>
            <span class="n">val1</span> <span class="o">=</span> <span class="s2">&quot;GL_ONE_MINUS_SRC_ALPHA&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_DST_ALPHA</span><span class="p">:</span>
            <span class="n">val1</span> <span class="o">=</span> <span class="s2">&quot;GL_DST_ALPHA&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_ONE_MINUS_DST_ALPHA</span><span class="p">:</span>
            <span class="n">val1</span> <span class="o">=</span> <span class="s2">&quot;GL_ONE_MINUS_DST_ALPHA&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_SRC_ALPHA_SATURATE</span><span class="p">:</span>
            <span class="n">val1</span> <span class="o">=</span> <span class="s2">&quot;GL_SRC_ALPHA_SATURATE&quot;</span>

        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dstBlendFunc</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_ZERO</span><span class="p">:</span>
            <span class="n">val2</span> <span class="o">=</span> <span class="s2">&quot;GL_ZERO&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_ONE</span><span class="p">:</span>
            <span class="n">val2</span> <span class="o">=</span> <span class="s2">&quot;GL_ONE&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_SRC_COLOR</span><span class="p">:</span>
            <span class="n">val2</span> <span class="o">=</span> <span class="s2">&quot;GL_SRC_COLOR&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_ONE_MINUS_SRC_COLOR</span><span class="p">:</span>
            <span class="n">val2</span> <span class="o">=</span> <span class="s2">&quot;GL.GL_ONE_MINUS_SRC_COLOR&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_SRC_ALPHA</span><span class="p">:</span>
            <span class="n">val2</span> <span class="o">=</span> <span class="s2">&quot;GL_SRC_ALPHA&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_ONE_MINUS_SRC_ALPHA</span><span class="p">:</span>
            <span class="n">val2</span> <span class="o">=</span> <span class="s2">&quot;GL_ONE_MINUS_SRC_ALPHA&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_DST_ALPHA</span><span class="p">:</span>
            <span class="n">val2</span> <span class="o">=</span> <span class="s2">&quot;GL_DST_ALPHA&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_ONE_MINUS_DST_ALPHA</span><span class="p">:</span>
            <span class="n">val2</span> <span class="o">=</span> <span class="s2">&quot;GL_ONE_MINUS_DST_ALPHA&quot;</span>

        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;blendFunctions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">full</span><span class="p">:</span>
            <span class="n">state</span><span class="p">[</span><span class="s2">&quot;vertices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVertices</span><span class="p">()</span>
            <span class="n">state</span><span class="p">[</span><span class="s2">&quot;vnormals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVNormals</span><span class="p">()</span>
            <span class="n">state</span><span class="p">[</span><span class="s2">&quot;rawMaterialF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span><span class="p">]</span><span class="o">.</span><span class="n">getState</span><span class="p">()</span>
            <span class="n">state</span><span class="p">[</span><span class="s2">&quot;rawMaterialB&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_BACK</span><span class="p">]</span><span class="o">.</span><span class="n">getState</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">state</span></div>

<div class="viewcode-block" id="Geom.applyStrokes"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.applyStrokes">[docs]</a>    <span class="k">def</span> <span class="nf">applyStrokes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">strength</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>  <span class="c1"># modified Stefano</span>
        <span class="sd">&quot;&quot;&quot;configures Geom to display stroke silhouette lines by drawing back faces</span>
<span class="sd">        as lines.</span>

<span class="sd">        None &lt;- strokes(color=(0,0,0,1), strength=1)</span>

<span class="sd">        Stroke -&gt; None</span>

<span class="sd">        color is an RGB tuple defining the color of the strokes</span>
<span class="sd">        strength is the width of the stroke lines&quot;&quot;&quot;</span>
        <span class="c1"># turn on/off culling</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">culling</span> <span class="o">!=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_NONE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">culling</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_NONE</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">culling</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_BACK</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inheritCulling</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># make sure the backfaces are draw as lines</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetBackPolyMode</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LINE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inheritBackPolyMode</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># set back material to black</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inheritMaterial</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>

        <span class="n">prop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_BACK</span><span class="p">]</span><span class="o">.</span><span class="n">prop</span>
        <span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">((</span><span class="n">color</span><span class="p">,),</span> <span class="s2">&quot;f&quot;</span><span class="p">)</span>
        <span class="n">prop</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">((</span><span class="n">color</span><span class="p">,),</span> <span class="s2">&quot;f&quot;</span><span class="p">)</span>
        <span class="n">prop</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">(((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),),</span> <span class="s2">&quot;f&quot;</span><span class="p">)</span>
        <span class="n">prop</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">(((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),),</span> <span class="s2">&quot;f&quot;</span><span class="p">)</span>
        <span class="n">prop</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">((</span><span class="mf">0.0</span><span class="p">,),</span> <span class="s2">&quot;f&quot;</span><span class="p">)</span>

        <span class="c1"># set the width of lines</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineWidth</span> <span class="o">=</span> <span class="n">strength</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inheritLineWidth</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># set inheritence flags for all children</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AllObjects</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">child</span> <span class="o">==</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">child</span><span class="o">.</span><span class="n">inheritCulling</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">child</span><span class="o">.</span><span class="n">inheritBackPolyMode</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># child.inheritMaterial = True</span>
            <span class="n">child</span><span class="o">.</span><span class="n">inheritLineWidth</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_BACK</span><span class="p">]</span><span class="o">.</span><span class="n">prop</span>
            <span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">((</span><span class="n">color</span><span class="p">,),</span> <span class="s2">&quot;f&quot;</span><span class="p">)</span>
            <span class="n">prop</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">((</span><span class="n">color</span><span class="p">,),</span> <span class="s2">&quot;f&quot;</span><span class="p">)</span>
            <span class="n">prop</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">(((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),),</span> <span class="s2">&quot;f&quot;</span><span class="p">)</span>
            <span class="n">prop</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">(((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),),</span> <span class="s2">&quot;f&quot;</span><span class="p">)</span>
            <span class="n">prop</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">((</span><span class="mf">0.0</span><span class="p">,),</span> <span class="s2">&quot;f&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Geom.GetABSCoords"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.GetABSCoords">[docs]</a>    <span class="k">def</span> <span class="nf">GetABSCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;Return the coordinates of the object if the object was a child of root.</span>
<span class="sd">&quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMatrix</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">rootObject</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVertices</span><span class="p">(</span><span class="n">homogenous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ct</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">])</span></div>

<div class="viewcode-block" id="Geom.getGeomMaterialCode"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.getGeomMaterialCode">[docs]</a>    <span class="k">def</span> <span class="nf">getGeomMaterialCode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geomName</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">includeBinding</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of strings containing Python code to restore the</span>
<span class="sd">material of this geoemtry.</span>
<span class="sd">indent is the level of indentation that is desired.</span>
<span class="sd">geomName is the name of the Geom object in the source code generated.</span>
<span class="sd">&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;## Material for </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;if </span><span class="si">%s</span><span class="s2">:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">geomName</span><span class="p">)</span>
        <span class="n">fmat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">fmat</span><span class="o">.</span><span class="n">_modified</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;    from opengltk.OpenGL import GL</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;    state = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">fmat</span><span class="o">.</span><span class="n">getState</span><span class="p">(</span><span class="n">includeBinding</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;    </span><span class="si">%s</span><span class="s2">.materials[GL.GL_FRONT].Set(**state)</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">geomName</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">bmat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_BACK</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">bmat</span><span class="o">.</span><span class="n">_modified</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;    from opengltk.OpenGL import GL</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;    state = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">bmat</span><span class="o">.</span><span class="n">getState</span><span class="p">()))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;    </span><span class="si">%s</span><span class="s2">.materials[GL.GL_BACK].Set(**state)</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">geomName</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;    </span><span class="si">%s</span><span class="s2">._setTransparent(&#39;implicit&#39;)</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">geomName</span><span class="p">))</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;    pass  ## needed in case there no modif</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;## End Materials for </span><span class="si">%s</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">lines</span></div>

<div class="viewcode-block" id="Geom.getGeomClipPlanesCode"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.getGeomClipPlanesCode">[docs]</a>    <span class="k">def</span> <span class="nf">getGeomClipPlanesCode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geomName</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of strings containing Python code to restore the</span>
<span class="sd">clipping planes of this geoemtry.</span>
<span class="sd">indent is the level of indentation that is desired.</span>
<span class="sd">geomName is the name of the Geom object in the source code generated.</span>
<span class="sd">&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;## Clipping Planes for </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;if </span><span class="si">%s</span><span class="s2">:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">geomName</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;    </span><span class="si">%s</span><span class="s2">.clipP = []</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">geomName</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;    </span><span class="si">%s</span><span class="s2">.clipPI = []</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">geomName</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clipP</span><span class="p">):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;    clip = </span><span class="si">%s</span><span class="s2">.viewer.clipP[</span><span class="si">%d</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">geomName</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">indent</span>
                <span class="o">+</span> <span class="s2">&quot;    </span><span class="si">%s</span><span class="s2">.AddClipPlane(clip, </span><span class="si">%s</span><span class="s2">.clipSide[clip.num], False)</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">geomName</span><span class="p">,</span> <span class="n">geomName</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clipPI</span><span class="p">):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;    clip = </span><span class="si">%s</span><span class="s2">.viewer.clipP[</span><span class="si">%d</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">geomName</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">indent</span>
                <span class="o">+</span> <span class="s2">&quot;    </span><span class="si">%s</span><span class="s2">.AddClipPlane(clip, </span><span class="si">%s</span><span class="s2">.clipSide[clip.num], True)</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">geomName</span><span class="p">,</span> <span class="n">geomName</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;    pass  ## needed in case there no modif</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;## End Clipping Planes for </span><span class="si">%s</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">lines</span></div>

<div class="viewcode-block" id="Geom.delete"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Geom.getVertices"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.getVertices">[docs]</a>    <span class="k">def</span> <span class="nf">getVertices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">homogenous</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;returns a handle to the vertices array&quot;&quot;&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">array</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">homogenous</span><span class="p">:</span>
            <span class="n">ch</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">c</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span>
            <span class="n">ch</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
            <span class="k">return</span> <span class="n">ch</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">c</span></div>

<div class="viewcode-block" id="Geom.getVNormals"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.getVNormals">[docs]</a>    <span class="k">def</span> <span class="nf">getVNormals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;returns a handle to the vertices array&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">normals</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">NONE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">normals</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">normals</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">normals</span><span class="o">.</span><span class="n">array</span></div>

<div class="viewcode-block" id="Geom.getOcclusionPointsDir"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.getOcclusionPointsDir">[docs]</a>    <span class="k">def</span> <span class="nf">getOcclusionPointsDir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVertices</span><span class="p">()</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVNormals</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">v</span><span class="p">,</span> <span class="n">n</span></div>

<div class="viewcode-block" id="Geom.getDepthMask"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.getDepthMask">[docs]</a>    <span class="k">def</span> <span class="nf">getDepthMask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">while</span> <span class="n">obj</span><span class="o">.</span><span class="n">inheritMaterial</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">parent</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">depthMask</span></div>

<div class="viewcode-block" id="Geom.SetPolyMode"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.SetPolyMode">[docs]</a>    <span class="k">def</span> <span class="nf">SetPolyMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;Modify polymode&quot;&quot;&quot;</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">viewer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">rootObject</span> <span class="ow">and</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">INHERIT</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">OUTLINED</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">face</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span><span class="p">:</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">outline</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">drawOutline</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">frontPolyMode</span><span class="o">=</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FILL</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">face</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_BACK</span><span class="p">:</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">outline</span><span class="o">=</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">drawOutline</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">True</span><span class="p">),</span> <span class="n">backPolyMode</span><span class="o">=</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FILL</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">face</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT_AND_BACK</span><span class="p">:</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span>
                    <span class="n">outline</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                    <span class="n">frontPolyMode</span><span class="o">=</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FILL</span><span class="p">,</span>
                    <span class="n">backPolyMode</span><span class="o">=</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FILL</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">face</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span><span class="p">:</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">outline</span><span class="o">=</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">drawOutline</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">frontPolyMode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">face</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_BACK</span><span class="p">:</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">outline</span><span class="o">=</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">drawOutline</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">False</span><span class="p">),</span> <span class="n">backPolyMode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">face</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT_AND_BACK</span><span class="p">:</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">outline</span><span class="o">=</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">frontPolyMode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">backPolyMode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span></div>

<div class="viewcode-block" id="Geom.SetFrontPolyMode"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.SetFrontPolyMode">[docs]</a>    <span class="k">def</span> <span class="nf">SetFrontPolyMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;Modify the current Object&#39;s frontPolyMode&quot;&quot;&quot;</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">frontAndBack</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">SetPolyMode</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT_AND_BACK</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SetPolyMode</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span></div>

<div class="viewcode-block" id="Geom.SetBackPolyMode"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.SetBackPolyMode">[docs]</a>    <span class="k">def</span> <span class="nf">SetBackPolyMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;Modify the current Object&#39;s frontPolyMode&quot;&quot;&quot;</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">frontAndBack</span> <span class="o">=</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">NO</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">SetPolyMode</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_BACK</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span></div>

<div class="viewcode-block" id="Geom.SetFrontBackPolyMode"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.SetFrontBackPolyMode">[docs]</a>    <span class="k">def</span> <span class="nf">SetFrontBackPolyMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;Modify the current Object&#39;s frontPolyMode&quot;&quot;&quot;</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">frontAndBack</span> <span class="o">=</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">YES</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">SetPolyMode</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT_AND_BACK</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span></div>

<div class="viewcode-block" id="Geom.GetPolyMode"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.GetPolyMode">[docs]</a>    <span class="k">def</span> <span class="nf">GetPolyMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="n">face</span> <span class="o">==</span> <span class="s2">&quot;front&quot;</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">obj</span><span class="o">.</span><span class="n">inheritFrontPolyMode</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">parent</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">frontPolyMode</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># face == &#39;back&#39;:</span>
            <span class="k">while</span> <span class="n">obj</span><span class="o">.</span><span class="n">inheritBackPolyMode</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">parent</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">backPolyMode</span></div>

<div class="viewcode-block" id="Geom.getDrawOutlineMode"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.getDrawOutlineMode">[docs]</a>    <span class="k">def</span> <span class="nf">getDrawOutlineMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="n">face</span> <span class="o">==</span> <span class="s2">&quot;front&quot;</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">obj</span><span class="o">.</span><span class="n">inheritFrontPolyMode</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">parent</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">drawOutline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># face == &#39;back&#39;:</span>
            <span class="k">while</span> <span class="n">obj</span><span class="o">.</span><span class="n">inheritBackPolyMode</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">parent</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">drawOutline</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="Geom.GetShading"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.GetShading">[docs]</a>    <span class="k">def</span> <span class="nf">GetShading</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">while</span> <span class="n">obj</span><span class="o">.</span><span class="n">inheritShading</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">parent</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">shading</span></div>

<div class="viewcode-block" id="Geom.GetLighting"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.GetLighting">[docs]</a>    <span class="k">def</span> <span class="nf">GetLighting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">while</span> <span class="n">obj</span><span class="o">.</span><span class="n">inheritLighting</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">parent</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">lighting</span></div>

<div class="viewcode-block" id="Geom.getSharpColorBoundaries"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.getSharpColorBoundaries">[docs]</a>    <span class="k">def</span> <span class="nf">getSharpColorBoundaries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="c1"># print &quot;getSharpColorBoundaries&quot;, self.name</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">while</span> <span class="n">obj</span><span class="o">.</span><span class="n">inheritSharpColorBoundaries</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">parent</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">sharpColorBoundaries</span></div>

<div class="viewcode-block" id="Geom.MaterialBindingMode"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.MaterialBindingMode">[docs]</a>    <span class="k">def</span> <span class="nf">MaterialBindingMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">face</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>  <span class="c1"># GL.GL_FRONT</span>
        <span class="sd">&quot;&quot;&quot;Figure out how materials should be used to color the object&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">num</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bytes</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span><span class="p">],</span> <span class="n">num</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">face</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">face</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">face</span>
        <span class="k">if</span> <span class="n">face</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT_AND_BACK</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frontAndBack</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">nn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">num</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># self.inheritMaterial = False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mode</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nn</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">binding</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">OVERALL</span>
            <span class="k">elif</span> <span class="n">nn</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">vertices</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">binding</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">PER_VERTEX</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;faceSet&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">nn</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faceSet</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">binding</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">PER_PART</span>
            <span class="k">elif</span> <span class="n">nn</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instanceMatricesFortran</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">binding</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">PER_INSTANCE</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">binding</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="c1"># self.inheritMaterial = True</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># a mode is  requested</span>

            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">INHERIT</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">binding</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">INHERIT</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">PER_VERTEX</span> <span class="ow">and</span> <span class="n">nn</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">vertices</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">binding</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">PER_VERTEX</span>
            <span class="k">elif</span> <span class="p">(</span>
                <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;faceSet&quot;</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">PER_PART</span>
                <span class="ow">and</span> <span class="n">nn</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faceSet</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">binding</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">PER_PART</span>
            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">OVERALL</span> <span class="ow">and</span> <span class="n">nn</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">binding</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">OVERALL</span>
            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">PER_INSTANCE</span> <span class="ow">and</span> <span class="n">nn</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">instanceMatricesFortran</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">binding</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">PER_INSTANCE</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">binding</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span></div>
            <span class="c1"># self.inheritMaterial = True</span>

<div class="viewcode-block" id="Geom.AddMaterial"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.AddMaterial">[docs]</a>    <span class="k">def</span> <span class="nf">AddMaterial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">propNum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">face</span><span class="o">=</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;Add materials to the current set&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">propNum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">propNum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">propNum</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bytes</span><span class="p">:</span>
            <span class="n">propNum</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span><span class="p">],</span> <span class="n">propNum</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">face</span>
        <span class="k">if</span> <span class="n">face</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT_AND_BACK</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frontAndBack</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">propNum</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">binding</span><span class="p">[</span><span class="n">propNum</span><span class="p">]</span> <span class="o">==</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">OVERALL</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">propNum</span><span class="p">]</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">array</span><span class="p">((),</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">FPRECISION</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">propNum</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">propNum</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">propNum</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span>

        <span class="n">values</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">viewerConst</span><span class="o">.</span><span class="n">FPRECISION</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">propNum</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">alpha</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">FPRECISION</span><span class="p">)</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">values</span><span class="p">,</span> <span class="n">alpha</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">propNum</span><span class="p">]</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">propNum</span><span class="p">],</span> <span class="n">values</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MaterialBindingMode</span><span class="p">(</span><span class="n">propNum</span><span class="p">,</span> <span class="n">face</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span></div>

<div class="viewcode-block" id="Geom.SetMaterial"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.SetMaterial">[docs]</a>    <span class="k">def</span> <span class="nf">SetMaterial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">propNum</span><span class="p">,</span> <span class="n">face</span><span class="o">=</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;Set the materials</span>
<span class="sd">            WARNING: when back face colors are set, two sided lighting has to</span>
<span class="sd">            be enabled&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">propNum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">propNum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">propNum</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bytes</span><span class="p">:</span>
            <span class="n">propNum</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span><span class="p">],</span> <span class="n">propNum</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">face</span>
        <span class="k">if</span> <span class="n">face</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT_AND_BACK</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span>
        <span class="k">elif</span> <span class="n">face</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_BACK</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">lightModel</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">twoSide</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">propNum</span><span class="p">]</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">array</span><span class="p">((),</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">FPRECISION</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">propNum</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">propNum</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">propNum</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddMaterial</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">propNum</span><span class="p">,</span> <span class="n">face</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span></div>

    <span class="c1">#        mat = self.materials[f].prop[propNum]</span>
    <span class="c1">#        if len(mat) and propNum==1: # diffuse</span>
    <span class="c1">#            alphaMin = Numeric.minimum.reduce( mat[:,3] )</span>
    <span class="c1">#            if alphaMin &lt; 1.0:</span>
    <span class="c1">#                self.setTransparency(1)</span>
    <span class="c1">#            else:</span>
    <span class="c1">#                self.setTransparency(0)</span>

<div class="viewcode-block" id="Geom.GetNormals"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.GetNormals">[docs]</a>    <span class="k">def</span> <span class="nf">GetNormals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;Find the normals to be used for a given shading</span>
<span class="sd">&quot;&quot;&quot;</span>
        <span class="n">lShadeModel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetShading</span><span class="p">()</span>  <span class="c1"># self.shading</span>
        <span class="k">if</span> <span class="n">lShadeModel</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_NONE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normals</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">lShadeModel</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FLAT</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;faceSet&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">normals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faceSet</span><span class="o">.</span><span class="n">normals</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">normals</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">lShadeModel</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_SMOOTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">normals</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span></div>

<div class="viewcode-block" id="Geom.Add"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.Add">[docs]</a>    <span class="k">def</span> <span class="nf">Add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">redo</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;add data to this object</span>
<span class="sd">set self.redoDspLst to 1 to force re-building of geometries DpyList</span>
<span class="sd">which implies recontruction of main display list.</span>
<span class="sd">set redoMain to 1 to force on reconstruction of main DpyList&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Geom.Add&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
                <span class="n">checkKeywords</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">keywords</span><span class="p">),</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

        <span class="n">v</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vertices&quot;</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vnormals&quot;</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;materials&quot;</span><span class="p">)</span>
        <span class="n">pf</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;polyFace&quot;</span><span class="p">)</span>
        <span class="n">mbm</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;matBind&quot;</span><span class="p">)</span>
        <span class="n">pn</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;propName&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">AddValues</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">normals</span><span class="o">.</span><span class="n">AddValues</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">v</span> <span class="ow">or</span> <span class="n">n</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redoDspLst</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">normals</span><span class="o">.</span><span class="n">PropertyStatus</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="p">))</span>

            <span class="c1"># expect a set of 4x4 transformation matrices with translation in</span>
            <span class="c1"># last column. We store a flat version of the transposed matrix since</span>
            <span class="c1"># this is what can be passed to OpenGL directly</span>
            <span class="n">imat</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;instanceMatrices&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">imat</span><span class="p">:</span>
                <span class="n">imat</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">imat</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">)</span>
                <span class="n">imat</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">imat</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">imat</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">imat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">imat</span><span class="p">:</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Numeric</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
                    <span class="n">conc</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">concatenate</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">instanceMatricesFortran</span> <span class="o">=</span> <span class="n">conc</span><span class="p">(</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instanceMatricesFortran</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">redoDspLst</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redoDspLst</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AddMaterial</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">propNum</span><span class="o">=</span><span class="n">pn</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mbm</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">v</span> <span class="ow">or</span> <span class="n">imat</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MaterialBindingMode</span><span class="p">(</span><span class="n">pn</span><span class="p">,</span> <span class="n">face</span><span class="o">=</span><span class="n">pf</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mbm</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">v</span> <span class="ow">or</span> <span class="n">n</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shading</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_SMOOTH</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lighting</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">GetNormals</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span> <span class="ow">and</span> <span class="n">redo</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">redoDspLst</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">objectsNeedingRedo</span><span class="p">[</span><span class="bp">self</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Geom.SetForChildren"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.SetForChildren">[docs]</a>    <span class="k">def</span> <span class="nf">SetForChildren</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;set properties for children of this object.  If recursive is True</span>
<span class="sd">the properties are set for the entire subtree.</span>
<span class="sd">&quot;&quot;&quot;</span>
        <span class="c1"># print &quot;SetForChildren&quot;, kw</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="o">*</span><span class="p">(),</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">recursive</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">c</span><span class="o">.</span><span class="n">SetForChildren</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="kc">True</span><span class="p">,),</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_setRotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Numeric</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="p">(</span><span class="mi">16</span><span class="p">,))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">mat</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span> <span class="ow">and</span> <span class="bp">self</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">rootObject</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoViewerDisplayListFlag&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_setTranslation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Numeric</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">translation</span> <span class="o">=</span> <span class="n">mat</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoViewerDisplayListFlag&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_setScale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mat</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Numeric</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>  <span class="c1"># ValueError as e:</span>
            <span class="k">return</span>  <span class="c1"># raise ValueError(e)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">mat</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoViewerDisplayListFlag&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_setPivot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetPivot</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>

<div class="viewcode-block" id="Geom.Set"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.Set">[docs]</a>    <span class="k">def</span> <span class="nf">Set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">redo</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">updateOwnGui</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">setCurrent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;set data for this object</span>
<span class="sd">check=1 : verify that all the keywords present can be handle by this func </span>
<span class="sd">redo : if redo == 0 : display lists are not rebuilt</span>
<span class="sd">updateOwnGui=True : allow to update owngui at the end this func</span>
<span class="sd">&quot;&quot;&quot;</span>
        <span class="c1"># print &quot;Geom.Set&quot;</span>

        <span class="n">redoFlags</span> <span class="o">=</span> <span class="n">Common2d3dObject</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">check</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">redoNow</span><span class="p">(</span><span class="n">redo</span><span class="p">,</span> <span class="n">updateOwnGui</span><span class="p">,</span> <span class="n">redoFlags</span><span class="p">)</span>

        <span class="n">imat</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;instanceMatricesFromFortran&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">imat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fortran</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fortran</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">imat</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;instanceMatricesFromC&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">imat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">imat</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;instanceMatrices&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">imat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">imat</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">imat</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">)</span>
            <span class="n">imat</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">imat</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">imat</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">imat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="n">mats</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ma</span> <span class="ow">in</span> <span class="n">imat</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fortran</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">mats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Numeric</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ma</span><span class="p">,</span> <span class="p">(</span><span class="mi">16</span><span class="p">,)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Numeric</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Numeric</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">ma</span><span class="p">),</span> <span class="p">(</span><span class="mi">16</span><span class="p">,)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instanceMatricesFortran</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mats</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">)</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoViewerDisplayListFlag&quot;</span><span class="p">]</span>

        <span class="n">v</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;vertices&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">reshape</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;vreshape&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;vnormals&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;texture&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;materials&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">lPf</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;polyFace&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">mbm</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;matBind&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">pn</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;propName&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;vertexSet&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;shape&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">s</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span> <span class="o">=</span> <span class="n">datamodel</span><span class="o">.</span><span class="n">VertexSet</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

        <span class="c1"># set default face side and default material property</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">lPf</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bytes</span><span class="p">:</span>
            <span class="n">lPf</span> <span class="o">=</span> <span class="n">lPf</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">lPf</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
                <span class="n">lPf</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_NONE</span>
            <span class="k">elif</span> <span class="n">lPf</span> <span class="o">==</span> <span class="s2">&quot;back&quot;</span><span class="p">:</span>
                <span class="n">lPf</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_BACK</span>
            <span class="k">elif</span> <span class="n">lPf</span> <span class="o">==</span> <span class="s2">&quot;front&quot;</span><span class="p">:</span>
                <span class="n">lPf</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span>
            <span class="k">elif</span> <span class="n">lPf</span> <span class="o">==</span> <span class="s2">&quot;frontandback&quot;</span><span class="p">:</span>
                <span class="n">lPf</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT_AND_BACK</span>
        <span class="k">if</span> <span class="n">lPf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lPf</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">SetValues</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">reshape</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">normals</span><span class="o">.</span><span class="n">SetValues</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">reshape</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>

            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>

            <span class="c1"># the following line causes vnormals to be overwritten I think (MS)</span>
            <span class="c1"># self.vertexSet.normals.status = viewerConst.UNKNOWN</span>

            <span class="c1"># the line below does not force re-computation we the number</span>
            <span class="c1"># of coordinates is the same change</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">normals</span><span class="o">.</span><span class="n">PropertyStatus</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">normals</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">NONE</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;faceSet&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;faces&quot;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">faceSet</span><span class="o">.</span><span class="n">normals</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">NONE</span>

        <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">.Texture</span> <span class="kn">import</span> <span class="n">Texture</span>

            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">Texture</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">texture</span> <span class="o">=</span> <span class="n">t</span>
            <span class="n">t</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">viewer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span>

            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_RGBA</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_setTransparent</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inheritMaterial</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_setTransparent</span><span class="p">(</span><span class="s2">&quot;implicit&quot;</span><span class="p">)</span>

        <span class="n">tx</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;textureCoords&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">texCoords</span> <span class="o">=</span> <span class="n">datamodel</span><span class="o">.</span><span class="n">VectorProperties</span><span class="p">(</span>
                <span class="s2">&quot;texCoords&quot;</span><span class="p">,</span> <span class="n">tx</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="n">viewerConst</span><span class="o">.</span><span class="n">FPRECISION</span>
            <span class="p">)</span>

            <span class="n">shp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">texCoords</span><span class="o">.</span><span class="n">ashape</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">shp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="p">(</span><span class="n">shp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;texture&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">texture</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">texture</span><span class="o">.</span><span class="n">auto</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">tx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="p">,</span> <span class="s2">&quot;texCoords&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">texCoords</span><span class="o">.</span><span class="n">PropertyStatus</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="p">))</span>

        <span class="n">fmode</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;frontPolyMode&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fmode</span><span class="p">:</span>

            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">fmode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">fmode</span> <span class="o">=</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">POLYGON_MODES</span><span class="p">[</span><span class="n">fmode</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">fmode</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">viewerConst</span><span class="o">.</span><span class="n">POLYGON_MODES</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frontPolyMode</span> <span class="o">=</span> <span class="n">fmode</span>
            <span class="k">if</span> <span class="n">fmode</span> <span class="o">==</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">INHERIT</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inheritFrontPolyMode</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inheritFrontPolyMode</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span>
                <span class="ow">and</span> <span class="n">fmode</span> <span class="ow">in</span> <span class="p">[</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FILL</span><span class="p">,</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">OUTLINED</span><span class="p">]</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lighting</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GetNormals</span><span class="p">()</span>

        <span class="n">bmode</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;backPolyMode&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bmode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">bmode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">bytes</span><span class="p">:</span>
                <span class="n">bmode</span> <span class="o">=</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">POLYGON_MODES</span><span class="p">[</span><span class="n">bmode</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">bmode</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">viewerConst</span><span class="o">.</span><span class="n">POLYGON_MODES</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">backPolyMode</span> <span class="o">=</span> <span class="n">bmode</span>
            <span class="k">if</span> <span class="n">bmode</span> <span class="o">==</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">INHERIT</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inheritBackPolyMode</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inheritBackPolyMode</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span>
                <span class="ow">and</span> <span class="n">bmode</span> <span class="ow">in</span> <span class="p">[</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FILL</span><span class="p">,</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">OUTLINED</span><span class="p">]</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lighting</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GetNormals</span><span class="p">()</span>

        <span class="n">smode</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;shading&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">smode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SMODE&quot;</span><span class="p">,</span> <span class="n">smode</span><span class="p">,</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">SHADINGS</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">smode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">bytes</span><span class="p">:</span>
                <span class="n">smode</span> <span class="o">=</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">SHADINGS</span><span class="p">[</span><span class="n">smode</span><span class="p">]</span>
            <span class="c1"># assert smode in list(viewerConst.SHADINGS.values())</span>
            <span class="k">if</span> <span class="n">smode</span> <span class="o">==</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">INHERIT</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inheritShading</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inheritShading</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shading</span> <span class="o">=</span> <span class="n">smode</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="p">:</span>  <span class="c1"># and self.lighting:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GetNormals</span><span class="p">()</span>
                <span class="k">for</span> <span class="nb">object</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AllObjects</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">Geom</span><span class="p">):</span>
                        <span class="nb">object</span><span class="o">.</span><span class="n">GetNormals</span><span class="p">()</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayChildrenListFlag&quot;</span><span class="p">]</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;matMask&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">rawMat</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;rawMaterialF&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rawMat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">rawMat</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span>
            <span class="n">mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># default mask sets all properties</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">mask</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">mat</span><span class="o">.</span><span class="n">SetMaterial</span><span class="p">(</span><span class="n">rawMat</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modified</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">MaterialBindingMode</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">face</span><span class="o">=</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mbm</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mask</span><span class="p">[</span><span class="n">mat</span><span class="o">.</span><span class="n">diffuse</span><span class="p">]</span> <span class="ow">or</span> <span class="n">mask</span><span class="p">[</span><span class="n">mat</span><span class="o">.</span><span class="n">opac</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">MaterialBindingMode</span><span class="p">(</span><span class="n">pn</span><span class="p">,</span> <span class="n">face</span><span class="o">=</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span><span class="p">)</span>

            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>

        <span class="n">rawMat</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;rawMaterialB&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rawMat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">rawMat</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span>
            <span class="n">mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_BACK</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># default mask sets all properties</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">mask</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">mat</span><span class="o">.</span><span class="n">SetMaterial</span><span class="p">(</span><span class="n">rawMat</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modified</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">MaterialBindingMode</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">face</span><span class="o">=</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_BACK</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mbm</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mask</span><span class="p">[</span><span class="n">mat</span><span class="o">.</span><span class="n">diffuse</span><span class="p">]</span> <span class="ow">or</span> <span class="n">mask</span><span class="p">[</span><span class="n">mat</span><span class="o">.</span><span class="n">opac</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">MaterialBindingMode</span><span class="p">(</span><span class="n">pn</span><span class="p">,</span> <span class="n">face</span><span class="o">=</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_BACK</span><span class="p">)</span>

            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">lPf</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT_AND_BACK</span><span class="p">:</span>
            <span class="n">pfList</span> <span class="o">=</span> <span class="p">[</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span><span class="p">,</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_BACK</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">lPf</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span><span class="p">:</span>
            <span class="n">pfList</span> <span class="o">=</span> <span class="p">[</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">lPf</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_BACK</span><span class="p">:</span>
            <span class="n">pfList</span> <span class="o">=</span> <span class="p">[</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_BACK</span><span class="p">]</span>
        <span class="n">matName</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;matName&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">matInd</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;matInd&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">lOpacity</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;opacity&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pf</span> <span class="ow">in</span> <span class="n">pfList</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>  <span class="c1"># ValueError as e</span>
                    <span class="k">return</span>  <span class="c1"># raise ValueError(e)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">pf</span><span class="p">]</span><span class="o">.</span><span class="n">SetMaterial</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">pn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modified</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">pn</span> <span class="ow">is</span> <span class="kc">None</span>
                    <span class="ow">or</span> <span class="n">pn</span> <span class="o">==</span> <span class="mi">1</span>
                    <span class="ow">or</span> <span class="n">pn</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;diffuse&quot;</span><span class="p">,</span> <span class="s2">&quot;DIFFUSE&quot;</span><span class="p">,</span> <span class="s2">&quot;diff&quot;</span><span class="p">,</span> <span class="s2">&quot;DIFF&quot;</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">m</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span>
                    <span class="p">):</span>  <span class="c1"># opacity info was provided</span>
                        <span class="n">mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">pf</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">MaterialBindingMode</span><span class="p">(</span><span class="n">mat</span><span class="o">.</span><span class="n">opac</span><span class="p">)</span>
                        <span class="n">mat</span><span class="o">.</span><span class="n">SetMaterial</span><span class="p">(</span><span class="n">m</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">mat</span><span class="o">.</span><span class="n">opac</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modified</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">MaterialBindingMode</span><span class="p">(</span><span class="n">pn</span><span class="p">,</span> <span class="n">face</span><span class="o">=</span><span class="n">pf</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mbm</span><span class="p">)</span>
                <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>
                <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoViewerDisplayListFlag&quot;</span><span class="p">]</span>

            <span class="k">elif</span> <span class="p">(</span><span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">imat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">inheritMaterial</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">MaterialBindingMode</span><span class="p">(</span><span class="n">pn</span><span class="p">,</span> <span class="n">face</span><span class="o">=</span><span class="n">pf</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mbm</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">mbm</span><span class="p">:</span>
                <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">MaterialBindingMode</span><span class="p">(</span><span class="n">pn</span><span class="p">,</span> <span class="n">face</span><span class="o">=</span><span class="n">pf</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mbm</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">matName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">matInd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mat</span> <span class="o">=</span> <span class="n">Materials</span><span class="o">.</span><span class="n">Materials</span><span class="p">(</span><span class="n">matName</span><span class="p">,</span> <span class="n">matInd</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">pf</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat</span>
                <span class="c1"># self.inheritMaterial = 0</span>
                <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">lOpacity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lOpacity</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">lOpacity</span> <span class="o">=</span> <span class="p">[</span><span class="n">lOpacity</span><span class="p">]</span>
                <span class="n">mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">pf</span><span class="p">]</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">SetMaterial</span><span class="p">(</span><span class="n">lOpacity</span><span class="p">,</span> <span class="n">mat</span><span class="o">.</span><span class="n">opac</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modified</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">MaterialBindingMode</span><span class="p">(</span><span class="n">mat</span><span class="o">.</span><span class="n">opac</span><span class="p">,</span> <span class="n">face</span><span class="o">=</span><span class="n">pf</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mbm</span><span class="p">)</span>
                <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>

        <span class="c1"># we do transparent here after setting opacity and materials</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;transparent&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setTransparent</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="c1"># Schedules this object to hide in val seconds</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;transient&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">redoDspLst</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">cameras</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="n">val</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Hide</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s2">&quot;Object </span><span class="si">%s</span><span class="s2"> isn&#39;t in a viewer&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,))</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;lineWidth&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">val</span> <span class="o">&gt;=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lineWidth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;pointWidth&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">val</span> <span class="o">&gt;=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pointWidth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;visible&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visible</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="p">:</span>
                    <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;visible can only be True or False&quot;</span><span class="p">)</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;lighting&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lighting</span> <span class="o">!=</span> <span class="n">val</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lighting</span> <span class="o">=</span> <span class="n">val</span>
                    <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;updateOwnGuiFlag&quot;</span><span class="p">]</span>
                    <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;lighting can only be True or False&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lighting</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">normals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GetNormals</span><span class="p">()</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;inheritLighting&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span> <span class="s2">&quot;only False or True are possible&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inheritLighting</span> <span class="o">!=</span> <span class="n">val</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inheritLighting</span> <span class="o">=</span> <span class="n">val</span>
                <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;updateOwnGuiFlag&quot;</span><span class="p">]</span>
                <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;stippleLines&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stippleLines</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;stippleLines can only be True or False&quot;</span><span class="p">)</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;stipplePolygons&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stipplePolygons</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;stipplePolygons can only be True or False&quot;</span><span class="p">)</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;outline&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">drawOutline</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">((</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">drawOutline</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;outline can only be True or False, or a tuple like (True, True)&quot;</span>
                <span class="p">)</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setTransparent</span><span class="p">(</span><span class="s2">&quot;implicit&quot;</span><span class="p">)</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;culling&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bytes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;inherit&quot;</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">INHERIT</span>
                <span class="k">elif</span> <span class="n">val</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_NONE</span>
                <span class="k">elif</span> <span class="n">val</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;front&quot;</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span>
                <span class="k">elif</span> <span class="n">val</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;back&quot;</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_BACK</span>
                <span class="k">elif</span> <span class="n">val</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;front_and_back&quot;</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT_AND_BACK</span>
            <span class="k">assert</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="n">viewerConst</span><span class="o">.</span><span class="n">INHERIT</span><span class="p">,</span>
                <span class="n">GL</span><span class="o">.</span><span class="n">GL_NONE</span><span class="p">,</span>
                <span class="n">GL</span><span class="o">.</span><span class="n">GL_BACK</span><span class="p">,</span>
                <span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT_AND_BACK</span><span class="p">,</span>
                <span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_BACK</span><span class="p">,</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_NONE</span><span class="p">,</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span><span class="p">,</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT_AND_BACK</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inheritCulling</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">culling</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">INHERIT</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inheritCulling</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;pickableVertices&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pickableVertices</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;pickableVertices can only be True or False&quot;</span><span class="p">)</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;scissor&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scissor</span> <span class="o">=</span> <span class="n">val</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">activeScissor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">activeScissor</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">activeScissor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">activeScissor</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="n">redoViewerDisplayListFlagFlag</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;scissor can only be True or False&quot;</span><span class="p">)</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;scissorX&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scissorX</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoViewerDisplayListFlag&quot;</span><span class="p">]</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;scissorY&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scissorY</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoViewerDisplayListFlag&quot;</span><span class="p">]</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;scissorW&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scissorW</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scissorAspectRatio</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scissorW</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">scissorH</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoViewerDisplayListFlag&quot;</span><span class="p">]</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;scissorH&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scissorH</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scissorAspectRatio</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scissorW</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">scissorH</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoViewerDisplayListFlag&quot;</span><span class="p">]</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;scissorAspectRatio&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="o">-</span><span class="n">val</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scissorAspectRatio</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scissorW</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scissorAspectRatio</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scissorH</span><span class="p">)</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoViewerDisplayListFlag&quot;</span><span class="p">]</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;depthMask&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">depthMask</span> <span class="o">=</span> <span class="n">val</span>
                <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;depthMask can only be True or False&quot;</span><span class="p">)</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;blendFunctions&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;arguemnt should be a 2-tuple&quot;</span>
            <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">if</span> <span class="n">src</span> <span class="o">==</span> <span class="s2">&quot;GL_ZERO&quot;</span><span class="p">:</span>
                <span class="n">src</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_ZER</span>
            <span class="k">elif</span> <span class="n">src</span> <span class="o">==</span> <span class="s2">&quot;GL_ONE&quot;</span><span class="p">:</span>
                <span class="n">src</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_ONE</span>
            <span class="k">elif</span> <span class="n">src</span> <span class="o">==</span> <span class="s2">&quot;GL_DST_COLOR&quot;</span><span class="p">:</span>
                <span class="n">src</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_DST_COLOR</span>
            <span class="k">elif</span> <span class="n">src</span> <span class="o">==</span> <span class="s2">&quot;GL_ONE_MINUS_DST_COLOR&quot;</span><span class="p">:</span>
                <span class="n">src</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_ONE_MINUS_DST_COLOR</span>
            <span class="k">elif</span> <span class="n">src</span> <span class="o">==</span> <span class="s2">&quot;GL_SRC_ALPHA&quot;</span><span class="p">:</span>
                <span class="n">src</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_SRC_ALPHA</span>
            <span class="k">elif</span> <span class="n">src</span> <span class="o">==</span> <span class="s2">&quot;GL_ONE_MINUS_SRC_ALPHA&quot;</span><span class="p">:</span>
                <span class="n">src</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_ONE_MINUS_SRC_ALPHA</span>
            <span class="k">elif</span> <span class="n">src</span> <span class="o">==</span> <span class="s2">&quot;GL_DST_ALPHA&quot;</span><span class="p">:</span>
                <span class="n">src</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_DST_ALPHA</span>
            <span class="k">elif</span> <span class="n">src</span> <span class="o">==</span> <span class="s2">&quot;GL_ONE_MINUS_DST_ALPHA&quot;</span><span class="p">:</span>
                <span class="n">src</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_ONE_MINUS_DST_ALPHA</span>
            <span class="k">elif</span> <span class="n">src</span> <span class="o">==</span> <span class="s2">&quot;GL_SRC_ALPHA_SATURATE&quot;</span><span class="p">:</span>
                <span class="n">src</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_SRC_ALPHA_SATURATE</span>

            <span class="k">if</span> <span class="n">dst</span> <span class="o">==</span> <span class="s2">&quot;GL_ZERO&quot;</span><span class="p">:</span>
                <span class="n">dst</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_ZERO</span>
            <span class="k">elif</span> <span class="n">dst</span> <span class="o">==</span> <span class="s2">&quot;GL_ONE&quot;</span><span class="p">:</span>
                <span class="n">dst</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_ONE</span>
            <span class="k">elif</span> <span class="n">dst</span> <span class="o">==</span> <span class="s2">&quot;GL_SRC_COLOR&quot;</span><span class="p">:</span>
                <span class="n">dst</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_SRC_COLOR</span>
            <span class="k">elif</span> <span class="n">dst</span> <span class="o">==</span> <span class="s2">&quot;GL.GL_ONE_MINUS_SRC_COLOR&quot;</span><span class="p">:</span>
                <span class="n">dst</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_ONE_MINUS_SRC_COLOR</span>
            <span class="k">elif</span> <span class="n">dst</span> <span class="o">==</span> <span class="s2">&quot;GL_SRC_ALPHA&quot;</span><span class="p">:</span>
                <span class="n">dst</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_SRC_ALPHA</span>
            <span class="k">elif</span> <span class="n">dst</span> <span class="o">==</span> <span class="s2">&quot;GL_ONE_MINUS_SRC_ALPHA&quot;</span><span class="p">:</span>
                <span class="n">dst</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_ONE_MINUS_SRC_ALPHA</span>
            <span class="k">elif</span> <span class="n">dst</span> <span class="o">==</span> <span class="s2">&quot;GL_DST_ALPHA&quot;</span><span class="p">:</span>
                <span class="n">dst</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_DST_ALPHA</span>
            <span class="k">elif</span> <span class="n">dst</span> <span class="o">==</span> <span class="s2">&quot;GL_ONE_MINUS_DST_ALPHA&quot;</span><span class="p">:</span>
                <span class="n">dst</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_ONE_MINUS_DST_ALPHA</span>

            <span class="k">assert</span> <span class="n">src</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceBlendFunctions</span>
            <span class="k">assert</span> <span class="n">dst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">destBlendFunctions</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">srcBlendFunc</span> <span class="o">=</span> <span class="n">src</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dstBlendFunc</span> <span class="o">=</span> <span class="n">dst</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>

        <span class="n">inheritMaterial</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;inheritMaterial&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inheritMaterial</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inheritMaterial</span> <span class="o">=</span> <span class="n">inheritMaterial</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;inheritXform&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span> <span class="s2">&quot;only False or True are possible&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inheritXform</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;inheritPointWidth&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span> <span class="s2">&quot;only False or True are possible&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inheritPointWidth</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span>
                <span class="s2">&quot;redoDisplayListFlag&quot;</span>
            <span class="p">]</span>  <span class="c1"># if container we force rebuilding main dpyList</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;inheritLineWidth&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span> <span class="s2">&quot;only False or True are possible&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inheritLineWidth</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span>
                <span class="s2">&quot;redoViewerDisplayListFlag&quot;</span>
            <span class="p">]</span>  <span class="c1"># if container we force rebuilding main dpyList</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;inheritStippleLines&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span> <span class="s2">&quot;only False or True are possible&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inheritStippleLines</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span>
                <span class="s2">&quot;redoViewerDisplayListFlag&quot;</span>
            <span class="p">]</span>  <span class="c1"># if container we force rebuilding main dpyList</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;inheritStipplePolygons&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span> <span class="s2">&quot;only False or True are possible&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inheritStipplePolygons</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoViewerDisplayListFlag&quot;</span><span class="p">]</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;inheritFrontPolyMode&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span> <span class="s2">&quot;only False or True are possible&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inheritFrontPolyMode</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoViewerDisplayListFlag&quot;</span><span class="p">]</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;inheritBackPolyMode&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span> <span class="s2">&quot;only False or True are possible&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inheritBackPolyMode</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoViewerDisplayListFlag&quot;</span><span class="p">]</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;inheritShading&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span> <span class="s2">&quot;only False or True are possible&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inheritShading</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoViewerDisplayListFlag&quot;</span><span class="p">]</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;inheritCulling&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span> <span class="s2">&quot;only False or True are possible&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inheritCulling</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoViewerDisplayListFlag&quot;</span><span class="p">]</span>

        <span class="n">invertNormals</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;invertNormals&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">invertNormals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">invertNormals</span> <span class="o">!=</span> <span class="n">invertNormals</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">invertNormals</span> <span class="o">=</span> <span class="n">invertNormals</span>

        <span class="n">inheritSharpColorBoundaries</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;inheritSharpColorBoundaries&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inheritSharpColorBoundaries</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inheritSharpColorBoundaries</span> <span class="o">!=</span> <span class="n">inheritSharpColorBoundaries</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inheritSharpColorBoundaries</span> <span class="o">=</span> <span class="n">inheritSharpColorBoundaries</span>
                <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayChildrenListFlag&quot;</span><span class="p">]</span>

        <span class="n">sharpColorBoundaries</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;sharpColorBoundaries&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sharpColorBoundaries</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sharpColorBoundaries</span> <span class="o">!=</span> <span class="n">sharpColorBoundaries</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sharpColorBoundaries</span> <span class="o">=</span> <span class="n">sharpColorBoundaries</span>
                <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayChildrenListFlag&quot;</span><span class="p">]</span>

        <span class="n">highlight</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;highlight&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">highlight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">highlight</span> <span class="o">!=</span> <span class="n">highlight</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">highlight</span> <span class="o">=</span> <span class="n">highlight</span>
                <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>

        <span class="n">disableStencil</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;disableStencil&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">disableStencil</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disableStencil</span> <span class="o">=</span> <span class="n">disableStencil</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>

        <span class="n">vertexArrayFlag</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;vertexArrayFlag&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vertexArrayFlag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertexArrayFlag</span> <span class="o">=</span> <span class="n">vertexArrayFlag</span>
            <span class="n">redoFlags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>

        <span class="c1"># this part give some problem</span>
        <span class="c1">#        if self.viewer is None :</span>
        <span class="c1">#            DejaVu.enableVertexArray = False</span>
        <span class="c1">#            self.vertexArrayFlag = False</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">DejaVu</span><span class="o">.</span><span class="n">enableVertexArray</span> <span class="ow">is</span> <span class="kc">True</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexArrayFlag</span> <span class="ow">is</span> <span class="kc">True</span>
            <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;vertexSet&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">DejaVu</span><span class="o">.</span><span class="n">enableVBO</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="kn">from</span> <span class="nn">opengltk.extent</span> <span class="kn">import</span> <span class="n">_glextlib</span>

                    <span class="c1"># mode = _glextlib.GL_STATIC_DRAW_ARB</span>
                    <span class="n">mode</span> <span class="o">=</span> <span class="n">_glextlib</span><span class="o">.</span><span class="n">GL_DYNAMIC_DRAW_ARB</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexArrayFlagBufferList</span><span class="p">):</span>
                        <span class="n">vbos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexArrayFlagBufferList</span>
                        <span class="n">_glextlib</span><span class="o">.</span><span class="n">glDeleteBuffersARB</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vbos</span><span class="p">),</span> <span class="n">vbos</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">vertexArrayFlagBufferList</span> <span class="o">=</span> <span class="n">_glextlib</span><span class="o">.</span><span class="n">glGenBuffersARB</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
                    <span class="c1"># vertices</span>
                    <span class="c1"># print &quot;contiguous&quot;, self.vertexSet.vertices.array.flags.contiguous</span>
                    <span class="c1"># if self.vertexSet.vertices.array.flags.contiguous is False:</span>
                    <span class="c1">#    self.vertexSet.vertices.array = Numeric.array(self.vertexSet.vertices.array,copy=1)</span>
                    <span class="n">_glextlib</span><span class="o">.</span><span class="n">glBindBufferARB</span><span class="p">(</span>
                        <span class="n">_glextlib</span><span class="o">.</span><span class="n">GL_ARRAY_BUFFER_ARB</span><span class="p">,</span>
                        <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexArrayFlagBufferList</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="p">)</span>
                    <span class="c1"># _glextlib.glBufferDataARB(</span>
                    <span class="c1">#    _glextlib.GL_ARRAY_BUFFER_ARB,</span>
                    <span class="c1">#    4*len(self.vertexSet.vertices.array)*\</span>
                    <span class="c1">#    len(self.vertexSet.vertices.array[0]),</span>
                    <span class="c1">#    self.vertexSet.vertices.array,</span>
                    <span class="c1">#    _glextlib.GL_STATIC_DRAW_ARB)</span>

                    <span class="c1"># the following code create GLerror: out of memory on</span>
                    <span class="c1"># tahiti</span>
                    <span class="n">vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">array</span>
                    <span class="n">_glextlib</span><span class="o">.</span><span class="n">glBufferDataARB</span><span class="p">(</span>
                        <span class="n">_glextlib</span><span class="o">.</span><span class="n">GL_ARRAY_BUFFER_ARB</span><span class="p">,</span>
                        <span class="mi">4</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="n">vertices</span><span class="p">,</span>
                        <span class="n">mode</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="n">_gllib</span><span class="o">.</span><span class="n">glVertexPointer</span><span class="p">(</span>
                        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FLOAT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
                    <span class="p">)</span>
                    <span class="c1"># normals</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">normals</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">_glextlib</span><span class="o">.</span><span class="n">glBindBufferARB</span><span class="p">(</span>
                            <span class="n">_glextlib</span><span class="o">.</span><span class="n">GL_ARRAY_BUFFER_ARB</span><span class="p">,</span>
                            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexArrayFlagBufferList</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="p">)</span>
                        <span class="n">_glextlib</span><span class="o">.</span><span class="n">glBufferDataARB</span><span class="p">(</span>
                            <span class="n">_glextlib</span><span class="o">.</span><span class="n">GL_ARRAY_BUFFER_ARB</span><span class="p">,</span>
                            <span class="mi">4</span>
                            <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">normals</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                            <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">normals</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">normals</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
                            <span class="n">mode</span><span class="p">,</span>
                        <span class="p">)</span>

                        <span class="n">_gllib</span><span class="o">.</span><span class="n">glNormalPointer</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FLOAT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

                <span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
                    <span class="n">DejaVu</span><span class="o">.</span><span class="n">enableVBO</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">DejaVu</span><span class="o">.</span><span class="n">enableVertexArrayVBO</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="n">DejaVu</span><span class="o">.</span><span class="n">enableVertexArrayNonVBO</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">_gllib</span><span class="o">.</span><span class="n">glVertexPointer</span><span class="p">(</span>
                            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                            <span class="n">GL</span><span class="o">.</span><span class="n">GL_FLOAT</span><span class="p">,</span>
                            <span class="mi">0</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">normals</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">_gllib</span><span class="o">.</span><span class="n">glNormalPointer</span><span class="p">(</span>
                                <span class="n">GL</span><span class="o">.</span><span class="n">GL_FLOAT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">normals</span><span class="o">.</span><span class="n">array</span>
                            <span class="p">)</span>
                    <span class="n">enableVertexArray</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">DejaVu</span><span class="o">.</span><span class="n">enableVertexArrayVBO</span> <span class="ow">or</span> <span class="n">DejaVu</span><span class="o">.</span><span class="n">enableVertexArrayNonVBO</span>
                    <span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">inheritMaterial</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">enableVBO</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">DejaVu</span><span class="o">.</span><span class="n">enableVertexArrayNonVBO</span> <span class="ow">is</span> <span class="kc">True</span>
            <span class="p">):</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">inheritMaterial</span><span class="p">:</span>
                    <span class="n">mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span><span class="p">]</span>
                    <span class="n">fpProp</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">fpBind</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">propInd</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                        <span class="n">b</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="n">propInd</span><span class="p">)</span>
                        <span class="n">fpProp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                        <span class="n">fpBind</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                    <span class="n">fpProp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mat</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                    <span class="n">fpBind</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mat</span><span class="o">.</span><span class="n">binding</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fpProp</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">fpBind</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_BACK</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">inheritMaterial</span><span class="p">:</span>
                    <span class="n">mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_BACK</span><span class="p">]</span>
                    <span class="n">bpProp</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">bpBind</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">propInd</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                        <span class="n">b</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="n">propInd</span><span class="p">)</span>
                        <span class="n">bpProp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                        <span class="n">bpBind</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                    <span class="n">bpProp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mat</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                    <span class="n">bpBind</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mat</span><span class="o">.</span><span class="n">binding</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">bpProp</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">bpBind</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="n">fpBind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fpBind</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">PER_VERTEX</span><span class="p">:</span>
                    <span class="n">lColorArray</span> <span class="o">=</span> <span class="n">fpProp</span><span class="p">[</span><span class="mi">1</span><span class="p">][:]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">colorArray</span> <span class="o">=</span> <span class="n">lColorArray</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">colorArray</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">lColorArray</span><span class="o">.</span><span class="n">shape</span>
                    <span class="k">if</span> <span class="n">DejaVu</span><span class="o">.</span><span class="n">enableVBO</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="c1"># colors</span>
                        <span class="kn">from</span> <span class="nn">opengltk.extent</span> <span class="kn">import</span> <span class="n">_glextlib</span>

                        <span class="n">_glextlib</span><span class="o">.</span><span class="n">glBindBufferARB</span><span class="p">(</span>
                            <span class="n">_glextlib</span><span class="o">.</span><span class="n">GL_ARRAY_BUFFER_ARB</span><span class="p">,</span>
                            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexArrayFlagBufferList</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
                        <span class="p">)</span>
                        <span class="n">_glextlib</span><span class="o">.</span><span class="n">glBufferDataARB</span><span class="p">(</span>
                            <span class="n">_glextlib</span><span class="o">.</span><span class="n">GL_ARRAY_BUFFER_ARB</span><span class="p">,</span>
                            <span class="mi">4</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colorArray</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colorArray</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">colorArray</span><span class="p">,</span>
                            <span class="n">_glextlib</span><span class="o">.</span><span class="n">GL_STATIC_DRAW_ARB</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">_gllib</span><span class="o">.</span><span class="n">glColorPointer</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FLOAT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="n">DejaVu</span><span class="o">.</span><span class="n">enableVertexArrayNonVBO</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">_gllib</span><span class="o">.</span><span class="n">glColorPointer</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FLOAT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorArray</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">colorPointerIsOn</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">colorPointerIsOn</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">elif</span> <span class="n">DejaVu</span><span class="o">.</span><span class="n">enableVertexArray</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">DejaVu</span><span class="o">.</span><span class="n">enableVBO</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">redoNow</span><span class="p">(</span><span class="n">redo</span><span class="p">,</span> <span class="n">updateOwnGui</span><span class="p">,</span> <span class="n">redoFlags</span><span class="p">,</span> <span class="n">setCurrent</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_setTransparent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="c1"># print &quot;_setTransparent&quot;, self.name, val</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span><span class="p">]</span><span class="o">.</span><span class="n">fixOpacity</span><span class="p">()</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_BACK</span><span class="p">]</span><span class="o">.</span><span class="n">fixOpacity</span><span class="p">()</span>
        <span class="n">lDetectedTransparency</span> <span class="o">=</span> <span class="n">t1</span> <span class="ow">or</span> <span class="n">t2</span>

        <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;implicit&quot;</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">lDetectedTransparency</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">getDrawOutlineMode</span><span class="p">(</span><span class="s2">&quot;front&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>
                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDrawOutlineMode</span><span class="p">(</span><span class="s2">&quot;back&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>
                <span class="p">)</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">outline</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1.0</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;only 0 or 1 are possible&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transparent</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoDisplayListFlag&quot;</span><span class="p">]</span>
            <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redoFlags</span><span class="p">[</span><span class="s2">&quot;redoViewerDisplayListFlag&quot;</span><span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># if container we force rebuilding main dpyList</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="n">v</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;vertexSet&quot;</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;faceSet&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">and</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2">&gt; </span><span class="si">%s</span><span class="s2"> with </span><span class="si">%d</span><span class="s2"> vertices and </span><span class="si">%d</span><span class="s2"> faces&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="p">),</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faceSet</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2">&gt; </span><span class="si">%s</span><span class="s2"> with </span><span class="si">%d</span><span class="s2"> vertices&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2">&gt; &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,)</span>

<div class="viewcode-block" id="Geom.BoundingBox"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.BoundingBox">[docs]</a>    <span class="k">def</span> <span class="nf">BoundingBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lineWidth</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;Turn Bounding Box drawing on and off, set attributs&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">display</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">display</span> <span class="ow">in</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">BB_MODES</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drawBB</span> <span class="o">=</span> <span class="n">display</span>

        <span class="k">if</span> <span class="n">color</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">OneColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">color</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">colorBB</span> <span class="o">=</span> <span class="n">color</span>

        <span class="k">if</span> <span class="n">lineWidth</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lineWidthBB</span> <span class="o">=</span> <span class="n">lineWidth</span></div>

<div class="viewcode-block" id="Geom.Draw"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.Draw">[docs]</a>    <span class="k">def</span> <span class="nf">Draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot; function that make the opengl call to draw the geom</span>
<span class="sd">Should be call by RedoDisplayList in between glNewList/ glEndList</span>
<span class="sd">&quot;&quot;&quot;</span>
        <span class="c1"># print &quot;Geom.Draw&quot;, self.name</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Geom.deleteOpenglTemplateList"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.deleteOpenglTemplateList">[docs]</a>    <span class="k">def</span> <span class="nf">deleteOpenglTemplateList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="c1"># print &quot;Common2d3dObject.deleteOpenglTemplateList&quot;, self</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;makeTemplate&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">templateDSPL</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># viewer.currentCamera.tk.call(viewer.currentCamera._w, &#39;makecurrent&#39;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">deleteTemplate</span><span class="p">()</span></div>

<div class="viewcode-block" id="Geom.deleteOpenglList"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.deleteOpenglList">[docs]</a>    <span class="k">def</span> <span class="nf">deleteOpenglList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="c1"># print &quot;Geom.deleteOpenglList&quot;, self</span>

        <span class="n">Common2d3dObject</span><span class="o">.</span><span class="n">deleteOpenglList</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outline</span><span class="o">.</span><span class="n">dpyList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">currentcontext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">currentCamera</span><span class="o">.</span><span class="n">tk</span><span class="o">.</span><span class="n">call</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">currentCamera</span><span class="o">.</span><span class="n">_w</span><span class="p">,</span> <span class="s2">&quot;contexttag&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">currentcontext</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outline</span><span class="o">.</span><span class="n">dpyList</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sd">&quot;&quot;&quot;deleteOpenglList failed because the current context is the wrong one&quot;&quot;&quot;</span>
                <span class="p">)</span>
                <span class="c1"># print &quot;currentcontext != self.outline.dpyList[1]&quot;, currentcontext, self.outline.dpyList[1]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># print &#39;-%d&#39;%self.outline.dpyList[0], currentcontext, &quot;glDeleteLists Geom&quot;</span>
                <span class="n">GL</span><span class="o">.</span><span class="n">glDeleteLists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outline</span><span class="o">.</span><span class="n">dpyList</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outline</span><span class="o">.</span><span class="n">dpyList</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Geom.RedoDisplayList"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.RedoDisplayList">[docs]</a>    <span class="k">def</span> <span class="nf">RedoDisplayList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="c1"># print &quot;Geom.RedoDisplayList&quot;, self</span>
        <span class="c1">##          if __debug__:</span>
        <span class="c1">##              print &#39;Spheres RedoDisplayList for&#39;, self.fullName</span>

        <span class="n">resetMaterialMemory</span><span class="p">()</span>
        <span class="n">Common2d3dObject</span><span class="o">.</span><span class="n">RedoDisplayList</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Geom.AddClipPlane"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.AddClipPlane">[docs]</a>    <span class="k">def</span> <span class="nf">AddClipPlane</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">side</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">clipChildren</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tagModified</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;Add the arbitrary clipping plane &#39;cp&#39; to this geometry&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_modified</span> <span class="o">=</span> <span class="n">tagModified</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">Clip</span><span class="o">.</span><span class="n">ClippingPlane</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;First agument has to be an instance of a ClippingPlane&quot;</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;clipping plane can only be added after the is in a viewer&quot;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">side</span> <span class="ow">in</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clipSide</span><span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="n">side</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;side can only be 1 or -1&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">clipChildren</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clipPI</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">clipChildren</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clipP</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;clipChildren can only be True or False&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">activeClippingPlanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">activeClippingPlanes</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">currentClip</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">currentClip</span> <span class="o">=</span> <span class="n">cp</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">deleteOpenglList</span><span class="p">()</span></div>

<div class="viewcode-block" id="Geom.RemoveClipPlane"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.RemoveClipPlane">[docs]</a>    <span class="k">def</span> <span class="nf">RemoveClipPlane</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cp</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;Remove the clip. plane from the list of CP clipping this object&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">Clip</span><span class="o">.</span><span class="n">ClippingPlane</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;First agument has to be an instance of ClippingPlane&quot;</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">clipPI</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clipPI</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">clipP</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clipP</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">activeClippingPlanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">activeClippingPlanes</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">deleteOpenglList</span><span class="p">()</span></div>

<div class="viewcode-block" id="Geom.ApplyParentsTransform"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.ApplyParentsTransform">[docs]</a>    <span class="k">def</span> <span class="nf">ApplyParentsTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;Return a vector of 3D coordinates transformed by all</span>
<span class="sd">        transformations up to root (excluded)&quot;&quot;&quot;</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMatrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LastParentBeforeRoot</span><span class="p">(),</span> <span class="n">instance</span><span class="p">)</span>
        <span class="n">one</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="n">coords</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">char</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">coords</span><span class="p">,</span> <span class="n">one</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">mat</span><span class="p">))[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span></div>

<div class="viewcode-block" id="Geom.TransformedCoords"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.TransformedCoords">[docs]</a>    <span class="k">def</span> <span class="nf">TransformedCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
            <span class="sd">&quot;&quot;&quot;Return the vertices after applying the current transformation&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">rootObject</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="p">):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMatrix</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">vertices</span> <span class="o">*</span> <span class="n">m</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

    <span class="c1">##     def GravityCenterSubtree(self):</span>
    <span class="c1">##     &quot;&quot;&quot;Compute the center of gravity of the object subtree&quot;&quot;&quot;</span>

    <span class="c1">##     allObj = self.AllObjects()</span>
    <span class="c1">##     center = Numeric.zeros( (3, ), viewerConst.FPRECISION)</span>
    <span class="c1">##     for o in allObj:</span>
    <span class="c1">##         if not o.visible: continue</span>
    <span class="c1">##         if len(o.vertexSet):</span>
    <span class="c1">##         m = o.GetMatrix(self)</span>
    <span class="c1">##         p = Numeric.concatenate( (o.vertices.GravityCenter(), [1.0]) )</span>
    <span class="c1">##         p = Numeric.dot(m, p)</span>
    <span class="c1">##         center = center + p[:3]</span>
    <span class="c1">##     return center/len(allObj)</span>

<div class="viewcode-block" id="Geom.ObjSubTreeBB"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.ObjSubTreeBB">[docs]</a>    <span class="k">def</span> <span class="nf">ObjSubTreeBB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>

        <span class="n">GL</span><span class="o">.</span><span class="n">glPushMatrix</span><span class="p">()</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">MakeMat</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">instanceMatricesFortran</span><span class="p">:</span>
            <span class="n">GL</span><span class="o">.</span><span class="n">glPushMatrix</span><span class="p">()</span>
            <span class="n">GL</span><span class="o">.</span><span class="n">glMultMatrixf</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">visible</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">Transformable</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ObjSubTreeBB</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="o">.</span><span class="n">visible</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">vertexSet</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">array</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">maxBB</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">minBB</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">obj</span><span class="o">.</span><span class="n">maxBB</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">minBB</span><span class="p">],</span> <span class="s2">&quot;f&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
                <span class="n">ones</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">)</span>
                <span class="n">vhom</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">v</span><span class="p">,</span> <span class="n">ones</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

                <span class="n">mat</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">glGetDoublev</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_MODELVIEW_MATRIX</span><span class="p">)</span>

                <span class="n">mat</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
                <span class="c1"># apply current matrix to coordinates and check against bb</span>
                <span class="n">ct</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vhom</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span>

                <span class="n">maxo</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">maximum</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">ct</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__maxBB</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__maxBB</span> <span class="o">=</span> <span class="n">maxo</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__maxBB</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">maximum</span><span class="o">.</span><span class="n">reduce</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">__maxBB</span><span class="p">,</span> <span class="n">maxo</span><span class="p">))</span>

                <span class="n">mino</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">minimum</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">ct</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__minBB</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__minBB</span> <span class="o">=</span> <span class="n">mino</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__minBB</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">minimum</span><span class="o">.</span><span class="n">reduce</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">__minBB</span><span class="p">,</span> <span class="n">mino</span><span class="p">))</span>

                <span class="c1"># we add the radius of the sphere to the bounding box</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;radius&quot;</span><span class="p">):</span>
                    <span class="n">lRadius</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Radius</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">lRadius</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">radius</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lRadius</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">radius</span>
                        <span class="k">if</span> <span class="n">lRadius</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__minBB</span> <span class="o">-=</span> <span class="n">lRadius</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__maxBB</span> <span class="o">+=</span> <span class="n">lRadius</span>

            <span class="n">GL</span><span class="o">.</span><span class="n">glPopMatrix</span><span class="p">()</span>

        <span class="n">GL</span><span class="o">.</span><span class="n">glPopMatrix</span><span class="p">()</span>  <span class="c1"># Restore the matrix</span></div>

<div class="viewcode-block" id="Geom.ComputeBB"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.ComputeBB">[docs]</a>    <span class="k">def</span> <span class="nf">ComputeBB</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;This method computes the bounding box of the visible objects</span>
<span class="sd">        in the tree rooted at this object.</span>
<span class="sd">        This method handles properly instance matrices</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># simulate a full redraw to build Xform matrices, apply to points</span>
        <span class="c1"># and find bounding box</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glPushMatrix</span><span class="p">()</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glLoadIdentity</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__minBB</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__maxBB</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ObjSubTreeBB</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glPopMatrix</span><span class="p">()</span>
        <span class="n">maxBB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__maxBB</span>
        <span class="n">minBB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__minBB</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">__maxBB</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">__minBB</span>
        <span class="k">if</span> <span class="n">minBB</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">minBB</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">maxBB</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">maxBB</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">minBB</span><span class="p">),</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">maxBB</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_DrawBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bbmin</span><span class="p">,</span> <span class="n">bbmax</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;Draw the bounding box using lines&quot;&quot;&quot;</span>

        <span class="n">GL</span><span class="o">.</span><span class="n">glPushAttrib</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_CURRENT_BIT</span> <span class="o">|</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHTING_BIT</span> <span class="o">|</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_LINE_BIT</span><span class="p">)</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glShadeModel</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FLAT</span><span class="p">)</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glDisable</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHTING</span><span class="p">)</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glColor4fv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colorBB</span><span class="p">)</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glLineWidth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineWidthBB</span><span class="p">)</span>
        <span class="c1"># FIXME build a display list for a cube once</span>
        <span class="c1"># just scale the 3 dimensions and translate</span>

        <span class="n">GL</span><span class="o">.</span><span class="n">glBegin</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LINE_STRIP</span><span class="p">)</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bbmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bbmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glEnd</span><span class="p">()</span>

        <span class="n">GL</span><span class="o">.</span><span class="n">glBegin</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LINE_STRIP</span><span class="p">)</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmax</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bbmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmax</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bbmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmax</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmax</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmax</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glEnd</span><span class="p">()</span>

        <span class="n">GL</span><span class="o">.</span><span class="n">glBegin</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LINES</span><span class="p">)</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmax</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

        <span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmax</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

        <span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bbmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bbmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmax</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

        <span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bbmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bbmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmin</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbmax</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glEnd</span><span class="p">()</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glPopAttrib</span><span class="p">()</span>

<div class="viewcode-block" id="Geom.DrawTreeBoundingBox"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.DrawTreeBoundingBox">[docs]</a>    <span class="k">def</span> <span class="nf">DrawTreeBoundingBox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;Draw&#39;s the bounding box of this object and all of its visible</span>
<span class="sd">       descendants&quot;&quot;&quot;</span>

        <span class="c1"># bbmin, bbmax = self.BoundingBoxSubtree()</span>
        <span class="n">bbmin</span><span class="p">,</span> <span class="n">bbmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ComputeBB</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_DrawBox</span><span class="p">(</span><span class="n">bbmin</span><span class="p">,</span> <span class="n">bbmax</span><span class="p">)</span></div>

<div class="viewcode-block" id="Geom.DrawBoundingBox"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.DrawBoundingBox">[docs]</a>    <span class="k">def</span> <span class="nf">DrawBoundingBox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;Draw&#39;s the objects bounding box&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_DrawBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">bbmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">bbmax</span><span class="p">)</span></div>

<div class="viewcode-block" id="Geom.addVertexNormalsGeom"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.addVertexNormalsGeom">[docs]</a>    <span class="k">def</span> <span class="nf">addVertexNormalsGeom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="c1"># print &quot;addVertexNormalsGeom&quot;</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">rootObject</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_vertexnormals&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_vertexnormals&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVNormals</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVertices</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">])),</span> <span class="n">v</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
        <span class="kn">from</span> <span class="nn">DejaVu.Polylines</span> <span class="kn">import</span> <span class="n">Polylines</span>

        <span class="n">g</span> <span class="o">=</span> <span class="n">Polylines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_vertexnormals&quot;</span><span class="p">,</span> <span class="n">vertices</span><span class="o">=</span><span class="n">pts</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">inheritedNormarrow</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_NONE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">AddObject</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertexNormals</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">g</span></div>

<div class="viewcode-block" id="Geom.faceCenterVector"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.faceCenterVector">[docs]</a>    <span class="k">def</span> <span class="nf">faceCenterVector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">faceIndex</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="n">v0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faceSet</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">faceIndex</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faceSet</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">faceIndex</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexSet</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faceSet</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">faceIndex</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span>
        <span class="n">center</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">v0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">v2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.33333333333333333333333333</span><span class="p">,</span>
            <span class="p">(</span><span class="n">v0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">v1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">v2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.33333333333333333333333333</span><span class="p">,</span>
            <span class="p">(</span><span class="n">v0</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">v1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">v2</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.33333333333333333333333333</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">normal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faceSet</span><span class="o">.</span><span class="n">normals</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">faceIndex</span><span class="p">]</span>
        <span class="n">outsidePoint</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">normal</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">normal</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">normal</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">center</span><span class="p">,</span> <span class="n">outsidePoint</span></div>

<div class="viewcode-block" id="Geom.addFaceNormalsGeom"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.addFaceNormalsGeom">[docs]</a>    <span class="k">def</span> <span class="nf">addFaceNormalsGeom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;faceSet&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">rootObject</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_facenormals&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_facenormals&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFNormals</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFaces</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVertices</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">pts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faceSet</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">array</span><span class="p">)):</span>
            <span class="n">pts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faceCenterVector</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

        <span class="kn">from</span> <span class="nn">DejaVu.Polylines</span> <span class="kn">import</span> <span class="n">Polylines</span>

        <span class="n">g</span> <span class="o">=</span> <span class="n">Polylines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_facenormals&quot;</span><span class="p">,</span> <span class="n">vertices</span><span class="o">=</span><span class="n">pts</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">inheritedNormarrow</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_NONE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">AddObject</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">faceNormals</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">g</span></div>

<div class="viewcode-block" id="Geom.removeVertexNormalsGeom"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.removeVertexNormalsGeom">[docs]</a>    <span class="k">def</span> <span class="nf">removeVertexNormalsGeom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">rootObject</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_vertexnormals&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_vertexnormals&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">RemoveObject</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vertexNormals</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Geom.removeFaceNormalsGeom"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.removeFaceNormalsGeom">[docs]</a>    <span class="k">def</span> <span class="nf">removeFaceNormalsGeom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">rootObject</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_facenormals&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_facenormals&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">RemoveObject</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">faceNormals</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Geom.RenderMode"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.RenderMode">[docs]</a>    <span class="k">def</span> <span class="nf">RenderMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">face</span><span class="o">=</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT</span><span class="p">,</span> <span class="n">redo</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;Set the render mode&quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;RenderMode is deprecated, use .Set(frontPolyMode=, shading=)&quot;</span><span class="p">,</span>
            <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">bytes</span><span class="p">:</span>
                <span class="n">mode</span> <span class="o">=</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">POLYGON_MODES</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">viewerConst</span><span class="o">.</span><span class="n">POLYGON_MODES</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">face</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_BACK</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">backPolyMode</span> <span class="o">=</span> <span class="n">mode</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inheritBackPolyMode</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frontPolyMode</span> <span class="o">=</span> <span class="n">mode</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inheritFrontPolyMode</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">INHERIT</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">face</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_BACK</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inheritBackPolyMode</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inheritFrontPolyMode</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Invalide polygon mode&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">shading</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">inhSet</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">shading</span> <span class="o">==</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">INHERIT</span><span class="p">:</span>
                <span class="n">shading</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_NONE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inheritShading</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">inhSet</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">shading</span> <span class="ow">in</span> <span class="n">viewerConst</span><span class="o">.</span><span class="n">SHADINGS</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">inhSet</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">inheritShading</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">shading</span> <span class="o">=</span> <span class="n">shading</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Invalid shading model </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">shading</span><span class="p">,))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FILL</span> <span class="ow">or</span> <span class="n">shading</span> <span class="o">!=</span> <span class="s2">&quot;ignore&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">redoDspLst</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lighting</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">GetNormals</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">redo</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">objectsNeedingRedo</span><span class="p">[</span><span class="bp">self</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Geom.asIndexedPolygons"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.asIndexedPolygons">[docs]</a>    <span class="k">def</span> <span class="nf">asIndexedPolygons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;Should return an IndexedPolygons object if this object can be</span>
<span class="sd">        represented using triangles, else return None&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Geom.sortPoly"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.sortPoly">[docs]</a>    <span class="k">def</span> <span class="nf">sortPoly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;None &lt;- sortPoly(order=-1)</span>
<span class="sd">        Sorts the geometry polygons according to z values of polygon&#39;s</span>
<span class="sd">        geomtric centers. Order=-1 sorts by furthest z first,, order=1 sorts</span>
<span class="sd">        by closest z first&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">faceSet</span><span class="p">):</span>
                <span class="n">g</span><span class="o">.</span><span class="n">sortPoly</span><span class="p">(</span><span class="n">order</span><span class="p">)</span></div>

<div class="viewcode-block" id="Geom.sortPoly_cb"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.sortPoly_cb">[docs]</a>    <span class="k">def</span> <span class="nf">sortPoly_cb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sortPoly</span><span class="p">()</span></div>

<div class="viewcode-block" id="Geom.setViewer"><a class="viewcode-back" href="../../../../cellpack.mgl_tools.DejaVu.html#cellpack.mgl_tools.DejaVu.Geom.Geom.setViewer">[docs]</a>    <span class="k">def</span> <span class="nf">setViewer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewer</span><span class="p">,</span> <span class="n">buildDisplayList</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DejaVu</span><span class="p">,</span> <span class="s2">&quot;functionName&quot;</span><span class="p">):</span>
                <span class="n">DejaVu</span><span class="o">.</span><span class="n">functionName</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;set viewer in all children of geom object</span>
<span class="sd">&quot;&quot;&quot;</span>
        <span class="n">Common2d3dObject</span><span class="o">.</span><span class="n">setViewer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewer</span><span class="p">,</span> <span class="n">buildDisplayList</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;texture&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">texture</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">texture</span><span class="o">.</span><span class="n">viewer</span> <span class="o">=</span> <span class="n">viewer</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Megan Riel-Mehan.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>