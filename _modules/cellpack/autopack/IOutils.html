<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>cellpack.autopack.IOutils &#8212; cellPack 1.0.7 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/classic.css?v=514cf933" />
    
    <script src="../../../_static/documentation_options.js?v=46dfa7f5"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">cellPack 1.0.7 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../cellpack.html" >cellpack</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../autopack.html" accesskey="U">cellpack.autopack</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">cellpack.autopack.IOutils</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for cellpack.autopack.IOutils</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Sun Jan 27 09:04:10 2013</span>

<span class="sd">@author: Ludovic Autin</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">json</span> <span class="kn">import</span> <span class="n">encoder</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>

<span class="kn">import</span> <span class="nn">cellpack.autopack</span> <span class="k">as</span> <span class="nn">autopack</span>
<span class="kn">import</span> <span class="nn">cellpack.autopack.transformation</span> <span class="k">as</span> <span class="nn">tr</span>
<span class="kn">from</span> <span class="nn">cellpack.autopack.Recipe</span> <span class="kn">import</span> <span class="n">Recipe</span>
<span class="kn">from</span> <span class="nn">cellpack.autopack.writers</span> <span class="kn">import</span> <span class="n">Writer</span>
<span class="kn">from</span> <span class="nn">.ingredient.Ingredient</span> <span class="kn">import</span> <span class="n">Ingredient</span>
<span class="kn">from</span> <span class="nn">cellpack.autopack.Serializable</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">sCompartment</span><span class="p">,</span>
    <span class="n">sIngredientGroup</span><span class="p">,</span>
    <span class="n">sIngredient</span><span class="p">,</span>
    <span class="n">sIngredientFiber</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.ingredient.grow</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ActinIngredient</span><span class="p">,</span>
    <span class="n">GrowIngredient</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">encoder</span><span class="o">.</span><span class="n">FLOAT_REPR</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="nb">format</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="s2">&quot;.8g&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="setValueToPythonStr">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.setValueToPythonStr">[docs]</a>
<span class="k">def</span> <span class="nf">setValueToPythonStr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">attrname</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">attrname</span><span class="p">,</span> <span class="s2">&quot; is None !&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">attrname</span> <span class="o">==</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">tuple</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">autopack</span><span class="o">.</span><span class="n">helper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">autopack</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">getMaterialProperty</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">va</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">va</span><span class="p">)</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                        <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">va</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attrname</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attrname</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span></div>



<div class="viewcode-block" id="getStringValueOptions">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.getStringValueOptions">[docs]</a>
<span class="k">def</span> <span class="nf">getStringValueOptions</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">attrname</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to return the given environment option as a string to</span>
<span class="sd">    be write in the xml file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;None&quot;</span>
    <span class="k">if</span> <span class="n">attrname</span> <span class="o">==</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">tuple</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">autopack</span><span class="o">.</span><span class="n">helper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">autopack</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">getMaterialProperty</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">va</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">va</span><span class="p">)</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                        <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">va</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">value</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>



<div class="viewcode-block" id="updatePositionsRadii">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.updatePositionsRadii">[docs]</a>
<span class="k">def</span> <span class="nf">updatePositionsRadii</span><span class="p">(</span><span class="n">ingr</span><span class="p">):</span>
    <span class="n">toupdate</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;positions&quot;</span><span class="p">:</span> <span class="p">[]}</span>
    <span class="n">toupdate</span><span class="p">[</span><span class="s2">&quot;radii&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">nLOD</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ingr</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nLOD</span><span class="p">):</span>
        <span class="n">toupdate</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;coords&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ingr</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()}</span>
        <span class="p">)</span>
        <span class="n">toupdate</span><span class="p">[</span><span class="s2">&quot;radii&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;radii&quot;</span><span class="p">:</span> <span class="n">ingr</span><span class="o">.</span><span class="n">radii</span><span class="p">[</span><span class="n">i</span><span class="p">]})</span>
    <span class="k">return</span> <span class="n">toupdate</span></div>



<div class="viewcode-block" id="GrabResult">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.GrabResult">[docs]</a>
<span class="k">class</span> <span class="nc">GrabResult</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class for callbacks&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collision</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># self.lock = thread.allocate_lock()</span>

<div class="viewcode-block" id="GrabResult.reset">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.GrabResult.reset">[docs]</a>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collision</span> <span class="o">=</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="GrabResult.grab">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.GrabResult.grab">[docs]</a>
    <span class="k">def</span> <span class="nf">grab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the callback function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># we must use lock here because += is not atomic</span>
        <span class="c1"># self.lock.acquire()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collision</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>
</div>

        <span class="c1"># self.lock.release()</span>


<div class="viewcode-block" id="ExportCollada">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.ExportCollada">[docs]</a>
<span class="k">class</span> <span class="nc">ExportCollada</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">env</span></div>



<div class="viewcode-block" id="IOingredientTool">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.IOingredientTool">[docs]</a>
<span class="k">class</span> <span class="nc">IOingredientTool</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="c1"># parser that can return an ingredient</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">IOingredientTool</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">env</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_quaternion</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="IOingredientTool.read">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.IOingredientTool.read">[docs]</a>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="n">fileName</span><span class="p">,</span> <span class="n">fileExtension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fileExtension</span> <span class="o">==</span> <span class="s2">&quot;.xml&quot;</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># self.load_XML(setupfile)</span>
        <span class="k">elif</span> <span class="n">fileExtension</span> <span class="o">==</span> <span class="s2">&quot;.py&quot;</span><span class="p">:</span>  <span class="c1"># execute ?</span>
            <span class="k">pass</span>  <span class="c1"># return IOutils.load_Python(env,setupfile)</span>
        <span class="k">elif</span> <span class="n">fileExtension</span> <span class="o">==</span> <span class="s2">&quot;.json&quot;</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># return IOutils.load_Json(env,setupfile)</span></div>


<div class="viewcode-block" id="IOingredientTool.makeIngredientFromJson">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.IOingredientTool.makeIngredientFromJson">[docs]</a>
    <span class="k">def</span> <span class="nf">makeIngredientFromJson</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">inode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">recipe</span><span class="o">=</span><span class="s2">&quot;Generic&quot;</span><span class="p">):</span>
        <span class="n">overwrite_dic</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ingr_dic</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">inode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;include&quot;</span> <span class="ow">in</span> <span class="n">inode</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">inode</span><span class="p">[</span><span class="s2">&quot;include&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;overwrite&quot;</span> <span class="ow">in</span> <span class="n">inode</span><span class="p">:</span>
                <span class="n">overwrite_dic</span> <span class="o">=</span> <span class="n">inode</span><span class="p">[</span><span class="s2">&quot;overwrite&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">autopack</span><span class="o">.</span><span class="n">get_local_file_location</span><span class="p">(</span>
                <span class="n">filename</span><span class="p">,</span>
                <span class="c1"># destination = recipe+os.sep+&quot;recipe&quot;+os.sep+&quot;ingredients&quot;+os.sep,</span>
                <span class="n">cache</span><span class="o">=</span><span class="s2">&quot;recipes&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>  <span class="c1"># doesnt work with symbol link ?</span>
                <span class="n">ingr_dic</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">inode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ingr_dic</span> <span class="o">=</span> <span class="n">inode</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;filename is None and not ingredient dictionary provided&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="n">ingr_dic</span>
        <span class="c1"># check for overwritten parameter</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">overwrite_dic</span><span class="p">):</span>
            <span class="n">kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">overwrite_dic</span><span class="p">)</span>
        <span class="n">ingre</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeIngredient</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ingre</span></div>


<div class="viewcode-block" id="IOingredientTool.ingrJsonNode">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.IOingredientTool.ingrJsonNode">[docs]</a>
    <span class="k">def</span> <span class="nf">ingrJsonNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ingr</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kwds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transpose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># force position instead of sphereFile</span>
        <span class="n">ingdic</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">kwds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwds</span> <span class="o">=</span> <span class="n">ingr</span><span class="o">.</span><span class="n">KWDS</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwds</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ingr</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
            <span class="c1">#            if hasattr(v,&quot;tolist&quot;):</span>
            <span class="c1">#                v=v.tolist()</span>
            <span class="c1">#            ingdic[k] = v</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ingdic</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">Writer</span><span class="o">.</span><span class="n">setValueToJsonNode</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span>
        <span class="c1"># if sphereTree file present should not use the pos-radii keyword</span>
        <span class="c1"># if ingr.sphereFile is not None and not result:</span>
        <span class="c1"># remove the position and radii key</span>
        <span class="c1">#    ingdic.pop(&quot;positions&quot;, None)</span>
        <span class="c1">#    ingdic.pop(&quot;radii&quot;, None)</span>
        <span class="c1"># update the positions and radii to new format</span>
        <span class="n">toupdate</span> <span class="o">=</span> <span class="n">updatePositionsRadii</span><span class="p">(</span><span class="n">ingr</span><span class="p">)</span>
        <span class="n">ingdic</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">toupdate</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ingr</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;transform&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ingr</span><span class="o">.</span><span class="n">source</span><span class="p">:</span>
                <span class="n">ingr</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;transform&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="n">ingr</span><span class="o">.</span><span class="n">offset</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ingr</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;transform&quot;</span><span class="p">][</span><span class="s2">&quot;offset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ingr</span><span class="o">.</span><span class="n">offset</span>

        <span class="c1"># reslt ?s</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">ingdic</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ingr</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
                <span class="c1"># position</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;tolist&quot;</span><span class="p">):</span>
                    <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="c1"># rotation</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;tolist&quot;</span><span class="p">):</span>
                    <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">R</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>  <span class="c1"># this will not work with cellvIEW?</span>
                <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
                    <span class="n">R</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="p">)</span>  <span class="c1"># this will not work with cellvIEW?</span>
                <span class="c1"># transpose ?</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_quaternion</span><span class="p">:</span>
                    <span class="n">R</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">quaternion_from_matrix</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">ingdic</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">R</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ingr</span><span class="p">,</span> <span class="n">GrowIngredient</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ingr</span><span class="p">,</span> <span class="n">ActinIngredient</span><span class="p">):</span>
                <span class="n">ingdic</span><span class="p">[</span><span class="s2">&quot;nbCurve&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ingr</span><span class="o">.</span><span class="n">nbCurve</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ingr</span><span class="o">.</span><span class="n">nbCurve</span><span class="p">):</span>
                    <span class="n">lp</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ingr</span><span class="o">.</span><span class="n">listePtLinear</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">ingr</span><span class="o">.</span><span class="n">listePtLinear</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lp</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="n">ingdic</span><span class="p">[</span><span class="s2">&quot;curve&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ingr</span><span class="o">.</span><span class="n">listePtLinear</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="c1">#            res=numpy.array(ingdic[&quot;results&quot;]).transpose()</span>
                <span class="c1">#            ingdic[&quot;results&quot;]=res.tolist()</span>
        <span class="n">ingdic</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ingr</span><span class="o">.</span><span class="n">composition_name</span>
        <span class="k">return</span> <span class="n">ingdic</span></div>


<div class="viewcode-block" id="IOingredientTool.ingrPythonNode">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.IOingredientTool.ingrPythonNode">[docs]</a>
    <span class="k">def</span> <span class="nf">ingrPythonNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ingr</span><span class="p">,</span> <span class="n">recipe</span><span class="o">=</span><span class="s2">&quot;recipe&quot;</span><span class="p">):</span>
        <span class="n">inrStr</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;#include as follow : execfile(&#39;pathto/&quot;</span>
            <span class="o">+</span> <span class="n">ingr</span><span class="o">.</span><span class="n">name</span>
            <span class="o">+</span> <span class="s2">&quot;.py&#39;,globals(),{&#39;recipe&#39;:recipe_variable_name})</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">ingr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;MultiSphere&quot;</span><span class="p">:</span>
            <span class="n">inrStr</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot;from autopack.Ingredient import SingleSphereIngr, MultiSphereIngr</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">inrStr</span> <span class="o">+=</span> <span class="n">ingr</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;= MultiSphereIngr( </span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">ingr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;MultiCylinder&quot;</span><span class="p">:</span>
            <span class="n">inrStr</span> <span class="o">+=</span> <span class="s2">&quot;from autopack.Ingredient import MultiCylindersIngr</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">inrStr</span> <span class="o">+=</span> <span class="n">ingr</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;= MultiCylindersIngr( </span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ingr</span><span class="o">.</span><span class="n">KWDS</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ingr</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="n">aStr</span> <span class="o">=</span> <span class="n">setValueToPythonStr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">aStr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">inrStr</span> <span class="o">+=</span> <span class="n">aStr</span> <span class="o">+</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">inrStr</span> <span class="o">+=</span> <span class="s2">&quot;)</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">inrStr</span> <span class="o">+=</span> <span class="n">recipe</span> <span class="o">+</span> <span class="s2">&quot;.addIngredient(&quot;</span> <span class="o">+</span> <span class="n">ingr</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;)</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">inrStr</span></div>


<div class="viewcode-block" id="IOingredientTool.clean_arguments">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.IOingredientTool.clean_arguments">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">clean_arguments</span><span class="p">(</span><span class="n">arguments_to_include</span><span class="p">,</span> <span class="o">**</span><span class="n">arguments</span><span class="p">):</span>
        <span class="n">new_arguments</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arguments</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">arguments_to_include</span><span class="p">:</span>
                <span class="n">new_arguments</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">new_arguments</span></div>


<div class="viewcode-block" id="IOingredientTool.makeIngredient">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.IOingredientTool.makeIngredient">[docs]</a>
    <span class="k">def</span> <span class="nf">makeIngredient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">ingr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">ingredient_type</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">ingredient_type</span> <span class="o">==</span> <span class="s2">&quot;Grow&quot;</span>
            <span class="ow">or</span> <span class="n">ingredient_type</span> <span class="o">==</span> <span class="s2">&quot;Actine&quot;</span>
            <span class="ow">or</span> <span class="n">ingredient_type</span> <span class="o">==</span> <span class="s2">&quot;MultiCylinder&quot;</span>
        <span class="p">):</span>
            <span class="n">arguments</span> <span class="o">=</span> <span class="n">IOingredientTool</span><span class="o">.</span><span class="n">clean_arguments</span><span class="p">(</span><span class="n">GrowIngredient</span><span class="o">.</span><span class="n">ARGUMENTS</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arguments</span> <span class="o">=</span> <span class="n">IOingredientTool</span><span class="o">.</span><span class="n">clean_arguments</span><span class="p">(</span><span class="n">Ingredient</span><span class="o">.</span><span class="n">ARGUMENTS</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">ingr</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">create_ingredient</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ingr</span></div>


<div class="viewcode-block" id="IOingredientTool.set_recipe_ingredient">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.IOingredientTool.set_recipe_ingredient">[docs]</a>
    <span class="k">def</span> <span class="nf">set_recipe_ingredient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmlnode</span><span class="p">,</span> <span class="n">recipe</span><span class="p">):</span>
        <span class="c1"># get the defined ingredient</span>
        <span class="n">ingrnodes</span> <span class="o">=</span> <span class="n">xmlnode</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s2">&quot;ingredient&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ingrnode</span> <span class="ow">in</span> <span class="n">ingrnodes</span><span class="p">:</span>
            <span class="n">ingre</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeIngredientFromXml</span><span class="p">(</span><span class="n">inode</span><span class="o">=</span><span class="n">ingrnode</span><span class="p">)</span>  <span class="c1"># , recipe=self.name)</span>
            <span class="k">if</span> <span class="n">ingre</span><span class="p">:</span>
                <span class="n">recipe</span><span class="o">.</span><span class="n">addIngredient</span><span class="p">(</span><span class="n">ingre</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;PROBLEM creating ingredient from &quot;</span><span class="p">,</span>
                    <span class="n">ingrnode</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="c1"># check for includes</span>
        <span class="n">ingrnodes_include</span> <span class="o">=</span> <span class="n">xmlnode</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s2">&quot;include&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">inclnode</span> <span class="ow">in</span> <span class="n">ingrnodes_include</span><span class="p">:</span>
            <span class="n">xmlfile</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">inclnode</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">))</span>
            <span class="n">ingre</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeIngredientFromXml</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">xmlfile</span><span class="p">)</span>  <span class="c1"># , recipe=self.name)</span>
            <span class="k">if</span> <span class="n">ingre</span><span class="p">:</span>
                <span class="n">recipe</span><span class="o">.</span><span class="n">addIngredient</span><span class="p">(</span><span class="n">ingre</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PROBLEM creating ingredient from &quot;</span><span class="p">,</span> <span class="n">ingrnode</span><span class="p">)</span></div>
</div>

            <span class="c1"># look for overwritten attribute</span>


<div class="viewcode-block" id="addCompartments">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.addCompartments">[docs]</a>
<span class="k">def</span> <span class="nf">addCompartments</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">compdic</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">io_ingr</span><span class="p">):</span>
    <span class="c1"># compdic on the form : {u&#39;positions&#39;: [[]], u&#39;from&#39;: u&#39;HIV-1_0.1.6-7.json&#39;, u&#39;rotations&#39;: [[]]}</span>

    <span class="n">fname</span> <span class="o">=</span> <span class="n">compdic</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">]</span>
    <span class="c1"># retrievet the file</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">autopack</span><span class="o">.</span><span class="n">get_local_file_location</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="s2">&quot;recipes&quot;</span><span class="p">)</span>
    <span class="n">ninstance</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">compdic</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">])</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>  <span class="c1"># doesnt work with symbol link ?</span>
        <span class="k">if</span> <span class="n">autopack</span><span class="o">.</span><span class="n">use_json_hook</span><span class="p">:</span>
            <span class="n">jsondic</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                <span class="n">fp</span><span class="p">,</span> <span class="n">object_pairs_hook</span><span class="o">=</span><span class="n">OrderedDict</span>
            <span class="p">)</span>  <span class="c1"># ,indent=4, separators=(&#39;,&#39;, &#39;: &#39;)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">jsondic</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ninstance</span><span class="p">):</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">compdic</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">])</span>  <span class="c1"># Vec3</span>
        <span class="n">rot</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">compdic</span><span class="p">[</span><span class="s2">&quot;rotations&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">])</span>  <span class="c1"># quaternion</span>
        <span class="c1"># we only extract the compartments ferom the file</span>
        <span class="c1"># order issue</span>
        <span class="k">for</span> <span class="n">cname</span> <span class="ow">in</span> <span class="n">jsondic</span><span class="p">[</span><span class="s2">&quot;compartments&quot;</span><span class="p">]:</span>
            <span class="n">comp_dic</span> <span class="o">=</span> <span class="n">jsondic</span><span class="p">[</span><span class="s2">&quot;compartments&quot;</span><span class="p">][</span><span class="n">cname</span><span class="p">]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">comp_dic</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="n">geom</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">comp_dic</span><span class="p">[</span><span class="s2">&quot;geom&quot;</span><span class="p">])</span>
            <span class="n">rep</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;rep&quot;</span> <span class="ow">in</span> <span class="n">comp_dic</span><span class="p">:</span>
                <span class="n">rep</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">comp_dic</span><span class="p">[</span><span class="s2">&quot;rep&quot;</span><span class="p">])</span>
            <span class="n">rep_file</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;rep_file&quot;</span> <span class="ow">in</span> <span class="n">comp_dic</span><span class="p">:</span>
                <span class="n">rep_file</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">comp_dic</span><span class="p">[</span><span class="s2">&quot;rep_file&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">rep</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rep</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">rep</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">rep</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">rname</span> <span class="o">=</span> <span class="n">rep_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">fileName</span><span class="p">,</span> <span class="n">fileExtension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">rname</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">fileExtension</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">fileExtension</span> <span class="o">=</span> <span class="n">autopack</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">hext</span>
                    <span class="k">if</span> <span class="n">fileExtension</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">rep_file</span> <span class="o">=</span> <span class="n">rep_file</span> <span class="o">+</span> <span class="n">fileExtension</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rep_file</span> <span class="o">=</span> <span class="n">rep_file</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">fileExtension</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rep</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">rep_file</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;add compartment &quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">rep</span><span class="p">,</span> <span class="n">rep_file</span><span class="p">)</span>
            <span class="n">compartment</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">create_compartment</span><span class="p">(</span>
                <span class="n">name</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">comp_dic</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]),</span> <span class="n">rep</span><span class="p">,</span> <span class="n">rep_file</span>
            <span class="p">)</span>
            <span class="c1"># need to transform the v,f,n to the new rotation and position</span>
            <span class="c1"># NOTE: we could initialize compartments with pos and rot instead</span>
            <span class="c1"># of transforming it every time we make a new one</span>
            <span class="n">compartment</span><span class="o">.</span><span class="n">transformMesh</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">rot</span><span class="p">)</span>
            <span class="n">env</span><span class="o">.</span><span class="n">addCompartment</span><span class="p">(</span><span class="n">compartment</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;surface&quot;</span> <span class="ow">in</span> <span class="n">comp_dic</span><span class="p">:</span>
                <span class="n">snode</span> <span class="o">=</span> <span class="n">comp_dic</span><span class="p">[</span><span class="s2">&quot;surface&quot;</span><span class="p">]</span>
                <span class="n">ingrs_dic</span> <span class="o">=</span> <span class="n">snode</span><span class="p">[</span><span class="s2">&quot;ingredients&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ingrs_dic</span><span class="p">):</span>
                    <span class="n">rSurf</span> <span class="o">=</span> <span class="n">Recipe</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;surf_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">compartments</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="c1">#                        rSurf = Recipe(name=o.name+&quot;_surf&quot;)</span>
                    <span class="k">for</span> <span class="n">ing_name</span> <span class="ow">in</span> <span class="n">ingrs_dic</span><span class="p">:</span>
                        <span class="c1"># either xref or defined</span>
                        <span class="n">ing_dic</span> <span class="o">=</span> <span class="n">ingrs_dic</span><span class="p">[</span><span class="n">ing_name</span><span class="p">]</span>
                        <span class="n">ingr</span> <span class="o">=</span> <span class="n">io_ingr</span><span class="o">.</span><span class="n">makeIngredientFromJson</span><span class="p">(</span>
                            <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">inode</span><span class="o">=</span><span class="n">ing_dic</span><span class="p">,</span> <span class="n">recipe</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">name</span>
                        <span class="p">)</span>
                        <span class="n">rSurf</span><span class="o">.</span><span class="n">addIngredient</span><span class="p">(</span><span class="n">ingr</span><span class="p">)</span>
                        <span class="c1"># setup recipe</span>
                    <span class="n">compartment</span><span class="o">.</span><span class="n">setSurfaceRecipe</span><span class="p">(</span><span class="n">rSurf</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;interior&quot;</span> <span class="ow">in</span> <span class="n">comp_dic</span><span class="p">:</span>
                <span class="n">snode</span> <span class="o">=</span> <span class="n">comp_dic</span><span class="p">[</span><span class="s2">&quot;interior&quot;</span><span class="p">]</span>
                <span class="n">ingrs_dic</span> <span class="o">=</span> <span class="n">snode</span><span class="p">[</span><span class="s2">&quot;ingredients&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ingrs_dic</span><span class="p">):</span>
                    <span class="c1">#                        rMatrix = Recipe(name=o.name+&quot;_int&quot;)</span>
                    <span class="n">rMatrix</span> <span class="o">=</span> <span class="n">Recipe</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;int_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">compartments</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">ing_name</span> <span class="ow">in</span> <span class="n">ingrs_dic</span><span class="p">:</span>
                        <span class="c1"># either xref or defined</span>
                        <span class="n">ing_dic</span> <span class="o">=</span> <span class="n">ingrs_dic</span><span class="p">[</span><span class="n">ing_name</span><span class="p">]</span>
                        <span class="n">ingr</span> <span class="o">=</span> <span class="n">io_ingr</span><span class="o">.</span><span class="n">makeIngredientFromJson</span><span class="p">(</span>
                            <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">inode</span><span class="o">=</span><span class="n">ing_dic</span><span class="p">,</span> <span class="n">recipe</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">name</span>
                        <span class="p">)</span>
                        <span class="n">rMatrix</span><span class="o">.</span><span class="n">addIngredient</span><span class="p">(</span><span class="n">ingr</span><span class="p">)</span>
                        <span class="c1"># setup recipe</span>
                    <span class="n">compartment</span><span class="o">.</span><span class="n">setInnerRecipe</span><span class="p">(</span><span class="n">rMatrix</span><span class="p">)</span></div>



<div class="viewcode-block" id="save_asPython">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.save_asPython">[docs]</a>
<span class="k">def</span> <span class="nf">save_asPython</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">setupfile</span><span class="p">,</span> <span class="n">useXref</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save the current environment setup as a python script file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">io_ingr</span> <span class="o">=</span> <span class="n">IOingredientTool</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">setupfile</span> <span class="o">=</span> <span class="n">setupfile</span>
    <span class="n">pathout</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">setupfile</span><span class="p">))</span>
    <span class="c1"># add the import statement</span>
    <span class="n">setupStr</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">import sys</span>
<span class="s2">import os</span>
<span class="s2">#autopack</span>
<span class="s2">import autopack</span>
<span class="s2">localdir = wrkDir = autopack.__path__[0]</span>
<span class="s2">from autopack.Ingredient import SingleSphereIngr, MultiSphereIngr</span>
<span class="s2">from autopack.Ingredient import MultiCylindersIngr,GrowIngredient,ActinIngredient</span>
<span class="s2">from autopack.Compartment import Compartment</span>
<span class="s2">from autopack.Recipe import Recipe</span>
<span class="s2">from autopack.Environment import Environment</span>
<span class="s2">from autopack.Graphics import AutopackViewer as AFViewer</span>
<span class="s2">#access the helper</span>
<span class="s2">helper = autopack.helper</span>
<span class="s2">if helper is None :</span>
<span class="s2">import upy</span>
<span class="s2">helperClass = upy.getHelperClass()</span>
<span class="s2">helper =helperClass()</span>
<span class="s2">#create the viewer</span>
<span class="s2">ViewerType=autopack.helper.host</span>
<span class="s2">afviewer = AFViewer(ViewerType=helper.host,helper=helper)#long ?</span>
<span class="s2">#make some option here</span>
<span class="s2">afviewer.doPoints = False</span>
<span class="s2">afviewer.doSpheres = False</span>
<span class="s2">afviewer.quality = 1 #lowest quality for sphere and cylinder</span>
<span class="s2">afviewer.visibleMesh = True #mesh default visibility</span>
<span class="s2">#create the env</span>
<span class="s2">h1 = Environment()</span>
<span class="s2">&quot;&quot;&quot;</span>
    <span class="n">setupStr</span> <span class="o">+=</span> <span class="s2">&quot;h1.name=&#39;&quot;</span> <span class="o">+</span> <span class="n">env</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">OPTIONS</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;gradients&quot;</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">gradients</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">vstr</span> <span class="o">=</span> <span class="n">getStringValueOptions</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>  <span class="c1"># env.setValueToXMLNode(v,options,k)</span>
        <span class="n">setupStr</span> <span class="o">+=</span> <span class="s2">&quot;h1.</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">vstr</span><span class="p">)</span>
    <span class="c1"># add the boundin box</span>
    <span class="n">vstr</span> <span class="o">=</span> <span class="n">getStringValueOptions</span><span class="p">(</span>
        <span class="n">env</span><span class="o">.</span><span class="n">boundingBox</span><span class="p">,</span> <span class="s2">&quot;boundingBox&quot;</span>
    <span class="p">)</span>  <span class="c1"># env.setValueToXMLNode(v,options,k)</span>
    <span class="n">setupStr</span> <span class="o">+=</span> <span class="s2">&quot;h1.</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;boundingBox&quot;</span><span class="p">,</span> <span class="n">vstr</span><span class="p">)</span>
    <span class="n">vstr</span> <span class="o">=</span> <span class="n">getStringValueOptions</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>  <span class="c1"># env.setValueToXMLNode(v,options,k)</span>
    <span class="n">setupStr</span> <span class="o">+=</span> <span class="s2">&quot;h1.</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="n">vstr</span><span class="p">)</span>

    <span class="c1"># TODO : GRADIENT</span>
    <span class="c1">#        if len(env.gradients):</span>
    <span class="c1">#            gradientsnode=env.xmldoc.createElement(&quot;gradients&quot;)</span>
    <span class="c1">#            root.appendChild(gradientsnode)</span>
    <span class="c1">#            for gname in env.gradients:</span>
    <span class="c1">#                g = env.gradients[gname]</span>
    <span class="c1">#                grnode = env.xmldoc.createElement(&quot;gradient&quot;)</span>
    <span class="c1">#                gradientsnode.appendChild(grnode)</span>
    <span class="c1">#                grnode.setAttribute(&quot;name&quot;,str(g.name))</span>
    <span class="c1">#                for k in g.OPTIONS:</span>
    <span class="c1">#                    v = getattr(g,k)</span>
    <span class="c1">#                    env.setValueToXMLNode(v,grnode,k)</span>
    <span class="c1">#</span>
    <span class="c1">#        grid path information</span>
    <span class="c1">#        if env.grid.filename is not None or env.grid.result_filename is not None:</span>
    <span class="c1">#            gridnode=env.xmldoc.createElement(&quot;grid&quot;)</span>
    <span class="c1">#            root.appendChild(gridnode)</span>
    <span class="c1">#            gridnode.setAttribute(&quot;grid_storage&quot;,str(env.grid.filename))</span>
    <span class="c1">#            gridnode.setAttribute(&quot;grid_result&quot;,str(env.grid.result_filename))</span>
    <span class="c1">#</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">exteriorRecipe</span>
    <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
        <span class="n">setupStr</span> <span class="o">+=</span> <span class="s2">&quot;cytoplasme = Recipe()</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">ingr</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">ingredients</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">useXref</span><span class="p">:</span>
                <span class="n">io_ingr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ingr</span><span class="p">,</span> <span class="n">pathout</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">ingr</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">ingr_format</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">)</span>
                <span class="n">setupStr</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="s2">&quot;execfile(&#39;&quot;</span>
                    <span class="o">+</span> <span class="n">pathout</span>
                    <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
                    <span class="o">+</span> <span class="n">ingr</span><span class="o">.</span><span class="n">name</span>
                    <span class="o">+</span> <span class="s2">&quot;.py&#39;,globals(),{&#39;recipe&#39;:cytoplasme})</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ingrnode</span> <span class="o">=</span> <span class="n">io_ingr</span><span class="o">.</span><span class="n">ingrPythonNode</span><span class="p">(</span><span class="n">ingr</span><span class="p">,</span> <span class="n">recipe</span><span class="o">=</span><span class="s2">&quot;cytoplasme&quot;</span><span class="p">)</span>
                <span class="n">setupStr</span> <span class="o">+=</span> <span class="n">ingrnode</span>
        <span class="n">setupStr</span> <span class="o">+=</span> <span class="s2">&quot;h1.setExteriorRecipe(cytoplasme)</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">compartments</span><span class="p">:</span>
        <span class="n">setupStr</span> <span class="o">+=</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; = Compartment(&#39;&quot;</span> <span class="o">+</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;&#39;,None, None, None,</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">setupStr</span> <span class="o">+=</span> <span class="s2">&quot;         filename=&#39;&quot;</span> <span class="o">+</span> <span class="n">o</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;&#39;,</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">representation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">setupStr</span> <span class="o">+=</span> <span class="s2">&quot;         object_name =&#39;&quot;</span> <span class="o">+</span> <span class="n">o</span><span class="o">.</span><span class="n">representation</span> <span class="o">+</span> <span class="s2">&quot;&#39;,</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">setupStr</span> <span class="o">+=</span> <span class="s2">&quot;         object_filename =&#39;&quot;</span> <span class="o">+</span> <span class="n">o</span><span class="o">.</span><span class="n">representation_file</span> <span class="o">+</span> <span class="s2">&quot;&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">setupStr</span> <span class="o">+=</span> <span class="s2">&quot;         )</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">setupStr</span> <span class="o">+=</span> <span class="s2">&quot;h1.addCompartment(&quot;</span> <span class="o">+</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;)</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">rs</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">surfaceRecipe</span>
        <span class="k">if</span> <span class="n">rs</span><span class="p">:</span>
            <span class="n">setupStr</span> <span class="o">+=</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_surface = Recipe(name=&#39;&quot;</span> <span class="o">+</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_surf&#39;)</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">ingr</span> <span class="ow">in</span> <span class="n">rs</span><span class="o">.</span><span class="n">ingredients</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">useXref</span><span class="p">:</span>
                    <span class="n">io_ingr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="n">ingr</span><span class="p">,</span> <span class="n">pathout</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">ingr</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">ingr_format</span><span class="o">=</span><span class="s2">&quot;python&quot;</span>
                    <span class="p">)</span>
                    <span class="n">setupStr</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="s2">&quot;execfile(&#39;&quot;</span>
                        <span class="o">+</span> <span class="n">pathout</span>
                        <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
                        <span class="o">+</span> <span class="n">ingr</span><span class="o">.</span><span class="n">name</span>
                        <span class="o">+</span> <span class="s2">&quot;.py&#39;,globals(),{&#39;recipe&#39;:&quot;</span>
                        <span class="o">+</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span>
                        <span class="o">+</span> <span class="s2">&quot;_surface})</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ingrnode</span> <span class="o">=</span> <span class="n">io_ingr</span><span class="o">.</span><span class="n">ingrPythonNode</span><span class="p">(</span><span class="n">ingr</span><span class="p">,</span> <span class="n">recipe</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_surface&quot;</span><span class="p">)</span>
                    <span class="n">setupStr</span> <span class="o">+=</span> <span class="n">ingrnode</span>
            <span class="n">setupStr</span> <span class="o">+=</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.setSurfaceRecipe(&quot;</span> <span class="o">+</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_surface)</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">ri</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">innerRecipe</span>
        <span class="k">if</span> <span class="n">ri</span><span class="p">:</span>
            <span class="n">setupStr</span> <span class="o">+=</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_inner = Recipe(name=&#39;&quot;</span> <span class="o">+</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_int&#39;)</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">ingr</span> <span class="ow">in</span> <span class="n">rs</span><span class="o">.</span><span class="n">ingredients</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">useXref</span><span class="p">:</span>
                    <span class="n">io_ingr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="n">ingr</span><span class="p">,</span> <span class="n">pathout</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">ingr</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">ingr_format</span><span class="o">=</span><span class="s2">&quot;python&quot;</span>
                    <span class="p">)</span>
                    <span class="n">setupStr</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="s2">&quot;execfile(&#39;&quot;</span>
                        <span class="o">+</span> <span class="n">pathout</span>
                        <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
                        <span class="o">+</span> <span class="n">ingr</span><span class="o">.</span><span class="n">name</span>
                        <span class="o">+</span> <span class="s2">&quot;.py&#39;,globals(),{&#39;recipe&#39;:&quot;</span>
                        <span class="o">+</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span>
                        <span class="o">+</span> <span class="s2">&quot;_inner})</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ingrnode</span> <span class="o">=</span> <span class="n">io_ingr</span><span class="o">.</span><span class="n">ingrPythonNode</span><span class="p">(</span><span class="n">ingr</span><span class="p">,</span> <span class="n">recipe</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_inner&quot;</span><span class="p">)</span>
                    <span class="n">setupStr</span> <span class="o">+=</span> <span class="n">ingrnode</span>
            <span class="n">setupStr</span> <span class="o">+=</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.setInnerRecipe(&quot;</span> <span class="o">+</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_inner)</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">setupStr</span> <span class="o">+=</span> <span class="s2">&quot;afviewer.SetHistoVol(h1,0,display=False)</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">setupStr</span> <span class="o">+=</span> <span class="s2">&quot;afviewer.displayPreFill()</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">setupStr</span> <span class="o">+=</span> <span class="s2">&quot;bbox = afviewer.helper.getObject(&#39;histvolBB&#39;)</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">setupStr</span> <span class="o">+=</span> <span class="s2">&quot;if bbox is None : bbox = afviewer.helper.box(&#39;histvolBB&#39;,cornerPoints=h1.boundingBox)</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">setupStr</span> <span class="o">+=</span> <span class="s2">&quot;helper = afviewer.helper</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">setupStr</span> <span class="o">+=</span> <span class="s2">&quot;noGUI = False</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">setupStr</span> <span class="o">+=</span> <span class="s2">&quot;try :</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">setupStr</span> <span class="o">+=</span> <span class="s2">&quot;    print (&#39;try&#39;)</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">setupStr</span> <span class="o">+=</span> <span class="p">(</span>
        <span class="s2">&quot;    AFGui.Set(&#39;&quot;</span>
        <span class="o">+</span> <span class="n">env</span><span class="o">.</span><span class="n">name</span>
        <span class="o">+</span> <span class="s2">&quot;&#39;,helper=afviewer.helper,afviewer=afviewer,histoVol=h1,bbox=bbox)</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="n">setupStr</span> <span class="o">+=</span> <span class="s2">&quot;except:</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">setupStr</span> <span class="o">+=</span> <span class="s2">&quot;    print (&#39;no GUI&#39;)</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">setupStr</span> <span class="o">+=</span> <span class="s2">&quot;    noGUI = True</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">setupfile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">setupStr</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="checkRotFormat">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.checkRotFormat">[docs]</a>
<span class="k">def</span> <span class="nf">checkRotFormat</span><span class="p">(</span><span class="n">rotation</span><span class="p">,</span> <span class="n">transpose</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">4</span><span class="p">,):</span>
        <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tr</span><span class="o">.</span><span class="n">matrix_from_quaternion</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>  <span class="c1"># transpose ?</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tr</span><span class="o">.</span><span class="n">matrix_from_quaternion</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rotation</span></div>



<div class="viewcode-block" id="gatherResult">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.gatherResult">[docs]</a>
<span class="k">def</span> <span class="nf">gatherResult</span><span class="p">(</span><span class="n">ingr_result</span><span class="p">,</span> <span class="n">transpose</span><span class="p">,</span> <span class="n">use_quaternion</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">lefthand</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">all_pos</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_rot</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ingr_result</span><span class="p">:</span>
        <span class="c1"># position</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;tolist&quot;</span><span class="p">):</span>
            <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="c1"># rotation</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;tolist&quot;</span><span class="p">):</span>
            <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>  <span class="c1"># this will not work with cellvIEW?</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">checkRotFormat</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">transpose</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>  <span class="c1"># this will not work with cellvIEW?</span>
        <span class="c1"># transpose ?</span>
        <span class="k">if</span> <span class="n">lefthand</span><span class="p">:</span>
            <span class="n">all_pos</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="nb">type</span><span class="p">])</span>  <span class="c1"># ing type?</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">quaternion_from_matrix</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">all_rot</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">-</span><span class="n">R</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">all_pos</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="nb">type</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">use_quaternion</span><span class="p">:</span>
                <span class="n">R</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">quaternion_from_matrix</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">all_rot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
        <span class="c1"># print ingr.composition_name, type, all_pos[-1], all_rot[-1]</span>
    <span class="k">return</span> <span class="n">all_pos</span><span class="p">,</span> <span class="n">all_rot</span></div>



<div class="viewcode-block" id="serializedRecipe">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.serializedRecipe">[docs]</a>
<span class="k">def</span> <span class="nf">serializedRecipe</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">transpose</span><span class="p">,</span> <span class="n">use_quaternion</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lefthand</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># specify the  keyword ?</span>
    <span class="n">sCompartment</span><span class="o">.</span><span class="n">static_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">sIngredientFiber</span><span class="o">.</span><span class="n">static_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">sIngredient</span><span class="o">.</span><span class="n">static_id</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">sIngredientGroup</span><span class="o">.</span><span class="n">static_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">all_pos</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_rot</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">sCompartment</span><span class="p">(</span><span class="s2">&quot;root&quot;</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">exteriorRecipe</span>
    <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
        <span class="n">exterior</span> <span class="o">=</span> <span class="n">sCompartment</span><span class="p">(</span><span class="s2">&quot;cytoplasme&quot;</span><span class="p">)</span>
        <span class="n">proteins</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># sIngredientGroup(&quot;proteins&quot;, 0)</span>
        <span class="n">fibers</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># sIngredientGroup(&quot;fibers&quot;, 1)</span>
        <span class="k">for</span> <span class="n">ingr</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">ingredients</span><span class="p">:</span>
            <span class="n">nbmol</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ingr</span><span class="o">.</span><span class="n">results</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ingr</span><span class="o">.</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">nbmol</span> <span class="o">=</span> <span class="n">ingr</span><span class="o">.</span><span class="n">count</span>
            <span class="n">toupdate</span> <span class="o">=</span> <span class="n">updatePositionsRadii</span><span class="p">(</span><span class="n">ingr</span><span class="p">)</span>
            <span class="n">kwds</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">nbmol</span><span class="p">,</span>
                <span class="s2">&quot;principal_vector&quot;</span><span class="p">:</span> <span class="n">ingr</span><span class="o">.</span><span class="n">principal_vector</span><span class="p">,</span>
                <span class="s2">&quot;molarity&quot;</span><span class="p">:</span> <span class="n">ingr</span><span class="o">.</span><span class="n">molarity</span><span class="p">,</span>
                <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">ingr</span><span class="o">.</span><span class="n">source</span><span class="p">,</span>
                <span class="s2">&quot;positions&quot;</span><span class="p">:</span> <span class="n">toupdate</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">],</span>
                <span class="s2">&quot;radii_lod&quot;</span><span class="p">:</span> <span class="n">toupdate</span><span class="p">[</span><span class="s2">&quot;radii&quot;</span><span class="p">],</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="n">ingr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;Grow&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fibers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">fibers</span> <span class="o">=</span> <span class="n">sIngredientGroup</span><span class="p">(</span><span class="s2">&quot;fibers&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">igr</span> <span class="o">=</span> <span class="n">sIngredient</span><span class="p">(</span><span class="n">ingr</span><span class="o">.</span><span class="n">composition_name</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
                <span class="n">fibers</span><span class="o">.</span><span class="n">addIngredient</span><span class="p">(</span><span class="n">igr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">proteins</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">proteins</span> <span class="o">=</span> <span class="n">sIngredientGroup</span><span class="p">(</span><span class="s2">&quot;proteins&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">igr</span> <span class="o">=</span> <span class="n">sIngredient</span><span class="p">(</span><span class="n">ingr</span><span class="o">.</span><span class="n">composition_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
                <span class="n">proteins</span><span class="o">.</span><span class="n">addIngredient</span><span class="p">(</span><span class="n">igr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">ap</span><span class="p">,</span> <span class="n">ar</span> <span class="o">=</span> <span class="n">gatherResult</span><span class="p">(</span>
                    <span class="n">ingr</span><span class="o">.</span><span class="n">results</span><span class="p">,</span>
                    <span class="n">transpose</span><span class="p">,</span>
                    <span class="n">use_quaternion</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="n">igr</span><span class="o">.</span><span class="n">ingredient_id</span><span class="p">,</span>
                    <span class="n">lefthand</span><span class="o">=</span><span class="n">lefthand</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">all_pos</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
                <span class="n">all_rot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>
        <span class="n">root</span><span class="o">.</span><span class="n">addCompartment</span><span class="p">(</span><span class="n">exterior</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">proteins</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exterior</span><span class="o">.</span><span class="n">addIngredientGroup</span><span class="p">(</span><span class="n">proteins</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fibers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exterior</span><span class="o">.</span><span class="n">addIngredientGroup</span><span class="p">(</span><span class="n">fibers</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">compartments</span><span class="p">:</span>
        <span class="n">co</span> <span class="o">=</span> <span class="n">sCompartment</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">rs</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">surfaceRecipe</span>
        <span class="k">if</span> <span class="n">rs</span><span class="p">:</span>
            <span class="n">surface</span> <span class="o">=</span> <span class="n">sCompartment</span><span class="p">(</span><span class="s2">&quot;surface&quot;</span><span class="p">)</span>
            <span class="n">proteins</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># sIngredientGroup(&quot;proteins&quot;, 0)</span>
            <span class="n">fibers</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># sIngredientGroup(&quot;fibers&quot;, 1)</span>
            <span class="k">for</span> <span class="n">ingr</span> <span class="ow">in</span> <span class="n">rs</span><span class="o">.</span><span class="n">ingredients</span><span class="p">:</span>
                <span class="n">nbmol</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ingr</span><span class="o">.</span><span class="n">results</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ingr</span><span class="o">.</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">nbmol</span> <span class="o">=</span> <span class="n">ingr</span><span class="o">.</span><span class="n">count</span>
                <span class="n">toupdate</span> <span class="o">=</span> <span class="n">updatePositionsRadii</span><span class="p">(</span><span class="n">ingr</span><span class="p">)</span>
                <span class="n">kwds</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">nbmol</span><span class="p">,</span>
                    <span class="s2">&quot;principal_vector&quot;</span><span class="p">:</span> <span class="n">ingr</span><span class="o">.</span><span class="n">principal_vector</span><span class="p">,</span>
                    <span class="s2">&quot;molarity&quot;</span><span class="p">:</span> <span class="n">ingr</span><span class="o">.</span><span class="n">molarity</span><span class="p">,</span>
                    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">ingr</span><span class="o">.</span><span class="n">source</span><span class="p">,</span>
                    <span class="s2">&quot;positions&quot;</span><span class="p">:</span> <span class="n">toupdate</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;radii_lod&quot;</span><span class="p">:</span> <span class="n">toupdate</span><span class="p">[</span><span class="s2">&quot;radii&quot;</span><span class="p">],</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="n">ingr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;Grow&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">fibers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">fibers</span> <span class="o">=</span> <span class="n">sIngredientGroup</span><span class="p">(</span><span class="s2">&quot;fibers&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">igr</span> <span class="o">=</span> <span class="n">sIngredient</span><span class="p">(</span><span class="n">ingr</span><span class="o">.</span><span class="n">composition_name</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
                    <span class="n">fibers</span><span class="o">.</span><span class="n">addIngredient</span><span class="p">(</span><span class="n">igr</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">proteins</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">proteins</span> <span class="o">=</span> <span class="n">sIngredientGroup</span><span class="p">(</span><span class="s2">&quot;proteins&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">igr</span> <span class="o">=</span> <span class="n">sIngredient</span><span class="p">(</span><span class="n">ingr</span><span class="o">.</span><span class="n">composition_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
                    <span class="n">proteins</span><span class="o">.</span><span class="n">addIngredient</span><span class="p">(</span><span class="n">igr</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                    <span class="n">ap</span><span class="p">,</span> <span class="n">ar</span> <span class="o">=</span> <span class="n">gatherResult</span><span class="p">(</span>
                        <span class="n">ingr</span><span class="o">.</span><span class="n">results</span><span class="p">,</span>
                        <span class="n">transpose</span><span class="p">,</span>
                        <span class="n">use_quaternion</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="n">igr</span><span class="o">.</span><span class="n">ingredient_id</span><span class="p">,</span>
                        <span class="n">lefthand</span><span class="o">=</span><span class="n">lefthand</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">all_pos</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
                    <span class="n">all_rot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>
            <span class="n">co</span><span class="o">.</span><span class="n">addCompartment</span><span class="p">(</span><span class="n">surface</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">proteins</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">surface</span><span class="o">.</span><span class="n">addIngredientGroup</span><span class="p">(</span><span class="n">proteins</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fibers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">surface</span><span class="o">.</span><span class="n">addIngredientGroup</span><span class="p">(</span><span class="n">fibers</span><span class="p">)</span>
        <span class="n">ri</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">innerRecipe</span>
        <span class="k">if</span> <span class="n">ri</span><span class="p">:</span>
            <span class="n">interior</span> <span class="o">=</span> <span class="n">sCompartment</span><span class="p">(</span><span class="s2">&quot;interior&quot;</span><span class="p">)</span>
            <span class="n">proteins</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># sIngredientGroup(&quot;proteins&quot;, 0)</span>
            <span class="n">fibers</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># sIngredientGroup(&quot;fibers&quot;, 1)</span>
            <span class="k">for</span> <span class="n">ingr</span> <span class="ow">in</span> <span class="n">ri</span><span class="o">.</span><span class="n">ingredients</span><span class="p">:</span>
                <span class="n">nbmol</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ingr</span><span class="o">.</span><span class="n">results</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ingr</span><span class="o">.</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">nbmol</span> <span class="o">=</span> <span class="n">ingr</span><span class="o">.</span><span class="n">count</span>
                <span class="n">toupdate</span> <span class="o">=</span> <span class="n">updatePositionsRadii</span><span class="p">(</span><span class="n">ingr</span><span class="p">)</span>
                <span class="n">kwds</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">nbmol</span><span class="p">,</span>
                    <span class="s2">&quot;principal_vector&quot;</span><span class="p">:</span> <span class="n">ingr</span><span class="o">.</span><span class="n">principal_vector</span><span class="p">,</span>
                    <span class="s2">&quot;molarity&quot;</span><span class="p">:</span> <span class="n">ingr</span><span class="o">.</span><span class="n">molarity</span><span class="p">,</span>
                    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">ingr</span><span class="o">.</span><span class="n">source</span><span class="p">,</span>
                    <span class="s2">&quot;positions&quot;</span><span class="p">:</span> <span class="n">toupdate</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;radii_lod&quot;</span><span class="p">:</span> <span class="n">toupdate</span><span class="p">[</span><span class="s2">&quot;radii&quot;</span><span class="p">],</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="n">ingr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;Grow&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">fibers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">fibers</span> <span class="o">=</span> <span class="n">sIngredientGroup</span><span class="p">(</span><span class="s2">&quot;fibers&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">igr</span> <span class="o">=</span> <span class="n">sIngredient</span><span class="p">(</span><span class="n">ingr</span><span class="o">.</span><span class="n">composition_name</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
                    <span class="n">fibers</span><span class="o">.</span><span class="n">addIngredient</span><span class="p">(</span><span class="n">igr</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">proteins</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">proteins</span> <span class="o">=</span> <span class="n">sIngredientGroup</span><span class="p">(</span><span class="s2">&quot;proteins&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">igr</span> <span class="o">=</span> <span class="n">sIngredient</span><span class="p">(</span><span class="n">ingr</span><span class="o">.</span><span class="n">composition_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
                    <span class="n">proteins</span><span class="o">.</span><span class="n">addIngredient</span><span class="p">(</span><span class="n">igr</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                    <span class="n">ap</span><span class="p">,</span> <span class="n">ar</span> <span class="o">=</span> <span class="n">gatherResult</span><span class="p">(</span>
                        <span class="n">ingr</span><span class="o">.</span><span class="n">results</span><span class="p">,</span>
                        <span class="n">transpose</span><span class="p">,</span>
                        <span class="n">use_quaternion</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="n">igr</span><span class="o">.</span><span class="n">ingredient_id</span><span class="p">,</span>
                        <span class="n">lefthand</span><span class="o">=</span><span class="n">lefthand</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">all_pos</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
                    <span class="n">all_rot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>
            <span class="n">co</span><span class="o">.</span><span class="n">addCompartment</span><span class="p">(</span><span class="n">interior</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">proteins</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">interior</span><span class="o">.</span><span class="n">addIngredientGroup</span><span class="p">(</span><span class="n">proteins</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fibers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">interior</span><span class="o">.</span><span class="n">addIngredientGroup</span><span class="p">(</span><span class="n">fibers</span><span class="p">)</span>
        <span class="n">root</span><span class="o">.</span><span class="n">addCompartment</span><span class="p">(</span><span class="n">co</span><span class="p">)</span>
    <span class="n">data_json</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">to_JSON</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">data_json</span><span class="p">,</span> <span class="n">all_pos</span><span class="p">,</span> <span class="n">all_rot</span></div>



<div class="viewcode-block" id="serializedFromResult">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.serializedFromResult">[docs]</a>
<span class="k">def</span> <span class="nf">serializedFromResult</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">transpose</span><span class="p">,</span> <span class="n">use_quaternion</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lefthand</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">all_pos</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_rot</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">sCompartment</span><span class="p">(</span><span class="s2">&quot;root&quot;</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;cytoplasme&quot;</span> <span class="ow">in</span> <span class="n">env</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="s2">&quot;cytoplasme&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
        <span class="n">exterior</span> <span class="o">=</span> <span class="n">sCompartment</span><span class="p">(</span><span class="s2">&quot;cytoplasme&quot;</span><span class="p">)</span>
        <span class="n">proteins</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># sIngredientGroup(&quot;proteins&quot;, 0)</span>
        <span class="c1"># fibers = None  # sIngredientGroup(&quot;fibers&quot;, 1)</span>
        <span class="k">for</span> <span class="n">ingr_name</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;ingredients&quot;</span><span class="p">]:</span>
            <span class="n">ingr</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">ingr_name</span><span class="p">]</span>
            <span class="n">kwds</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">ingr</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]),</span> <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">ingr</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]}</span>
            <span class="c1">#            if ingr.type == &quot;Grow&quot;:</span>
            <span class="c1">#                if fibers is None:</span>
            <span class="c1">#                    fibers = sIngredientGroup(&quot;fibers&quot;, 1)</span>
            <span class="c1">#                igr = sIngredient(ingr.composition_name, 1, **kwds)</span>
            <span class="c1">#                fibers.addIngredient(igr)</span>
            <span class="c1">#            else:</span>
            <span class="k">if</span> <span class="n">proteins</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">proteins</span> <span class="o">=</span> <span class="n">sIngredientGroup</span><span class="p">(</span><span class="s2">&quot;proteins&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">igr</span> <span class="o">=</span> <span class="n">sIngredient</span><span class="p">(</span><span class="n">ingr</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
            <span class="n">proteins</span><span class="o">.</span><span class="n">addIngredient</span><span class="p">(</span><span class="n">igr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">ap</span><span class="p">,</span> <span class="n">ar</span> <span class="o">=</span> <span class="n">gatherResult</span><span class="p">(</span>
                    <span class="n">ingr</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">],</span>
                    <span class="n">transpose</span><span class="p">,</span>
                    <span class="n">use_quaternion</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="n">igr</span><span class="o">.</span><span class="n">ingredient_id</span><span class="p">,</span>
                    <span class="n">lefthand</span><span class="o">=</span><span class="n">lefthand</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">all_pos</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
                <span class="n">all_rot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>
        <span class="n">root</span><span class="o">.</span><span class="n">addCompartment</span><span class="p">(</span><span class="n">exterior</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">proteins</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exterior</span><span class="o">.</span><span class="n">addIngredientGroup</span><span class="p">(</span><span class="n">proteins</span><span class="p">)</span>
    <span class="c1">#        if fibers is not None:</span>
    <span class="c1">#            exterior.addIngredientGroup(fibers)</span>
    <span class="k">if</span> <span class="s2">&quot;compartments&quot;</span> <span class="ow">in</span> <span class="n">env</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">composition_name</span> <span class="ow">in</span> <span class="n">env</span><span class="p">[</span><span class="s2">&quot;compartments&quot;</span><span class="p">]:</span>
            <span class="n">o</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="s2">&quot;compartments&quot;</span><span class="p">][</span><span class="n">composition_name</span><span class="p">]</span>
            <span class="n">co</span> <span class="o">=</span> <span class="n">sCompartment</span><span class="p">(</span><span class="n">composition_name</span><span class="p">)</span>
            <span class="n">rs</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="s2">&quot;surface&quot;</span> <span class="ow">in</span> <span class="n">o</span><span class="p">:</span>
                <span class="n">rs</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="s2">&quot;surface&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">rs</span><span class="p">:</span>
                <span class="n">surface</span> <span class="o">=</span> <span class="n">sCompartment</span><span class="p">(</span><span class="s2">&quot;surface&quot;</span><span class="p">)</span>
                <span class="n">proteins</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># sIngredientGroup(&quot;proteins&quot;, 0)</span>
                <span class="k">for</span> <span class="n">ingr_name</span> <span class="ow">in</span> <span class="n">rs</span><span class="p">[</span><span class="s2">&quot;ingredients&quot;</span><span class="p">]:</span>
                    <span class="n">ingr</span> <span class="o">=</span> <span class="n">rs</span><span class="p">[</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">ingr_name</span><span class="p">]</span>
                    <span class="n">kwds</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">ingr</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]),</span> <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">ingr</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]}</span>
                    <span class="c1">#                if ingr.type == &quot;Grow&quot;:</span>
                    <span class="c1">#                    if fibers is None:</span>
                    <span class="c1">#                        fibers = sIngredientGroup(&quot;fibers&quot;, 1)</span>
                    <span class="c1">#                    igr = sIngredient(ingr.composition_name, 1, **kwds)</span>
                    <span class="c1">#                    fibers.addIngredient(igr)</span>
                    <span class="c1">#                else:</span>
                    <span class="k">if</span> <span class="n">proteins</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">proteins</span> <span class="o">=</span> <span class="n">sIngredientGroup</span><span class="p">(</span><span class="s2">&quot;proteins&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">igr</span> <span class="o">=</span> <span class="n">sIngredient</span><span class="p">(</span><span class="n">ingr</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
                    <span class="n">proteins</span><span class="o">.</span><span class="n">addIngredient</span><span class="p">(</span><span class="n">igr</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                        <span class="n">ap</span><span class="p">,</span> <span class="n">ar</span> <span class="o">=</span> <span class="n">gatherResult</span><span class="p">(</span>
                            <span class="n">ingr</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">],</span>
                            <span class="n">transpose</span><span class="p">,</span>
                            <span class="n">use_quaternion</span><span class="p">,</span>
                            <span class="nb">type</span><span class="o">=</span><span class="n">igr</span><span class="o">.</span><span class="n">ingredient_id</span><span class="p">,</span>
                            <span class="n">lefthand</span><span class="o">=</span><span class="n">lefthand</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">all_pos</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
                        <span class="n">all_rot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>
                <span class="n">co</span><span class="o">.</span><span class="n">addCompartment</span><span class="p">(</span><span class="n">surface</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">proteins</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">surface</span><span class="o">.</span><span class="n">addIngredientGroup</span><span class="p">(</span><span class="n">proteins</span><span class="p">)</span>
            <span class="c1">#            if fibers is not None:</span>
            <span class="c1">#                surface.addIngredientGroup(fibers)</span>
            <span class="n">ri</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="s2">&quot;interior&quot;</span> <span class="ow">in</span> <span class="n">o</span><span class="p">:</span>
                <span class="n">ri</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="s2">&quot;interior&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ri</span><span class="p">:</span>
                <span class="n">interior</span> <span class="o">=</span> <span class="n">sCompartment</span><span class="p">(</span><span class="s2">&quot;interior&quot;</span><span class="p">)</span>
                <span class="n">proteins</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># sIngredientGroup(&quot;proteins&quot;, 0)</span>
                <span class="k">for</span> <span class="n">ingr_name</span> <span class="ow">in</span> <span class="n">ri</span><span class="p">[</span><span class="s2">&quot;ingredients&quot;</span><span class="p">]:</span>
                    <span class="n">ingr</span> <span class="o">=</span> <span class="n">ri</span><span class="p">[</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">ingr_name</span><span class="p">]</span>
                    <span class="n">kwds</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">ingr</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]),</span> <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">ingr</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]}</span>
                    <span class="c1">#                if ingr.type == &quot;Grow&quot;:</span>
                    <span class="c1">#                    if fibers is None:</span>
                    <span class="c1">#                        fibers = sIngredientGroup(&quot;fibers&quot;, 1)</span>
                    <span class="c1">#                    igr = sIngredient(ingr[&quot;name&quot;], 1, **kwds)</span>
                    <span class="c1">#                    fibers.addIngredient(igr)</span>
                    <span class="c1">#                else:</span>
                    <span class="k">if</span> <span class="n">proteins</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">proteins</span> <span class="o">=</span> <span class="n">sIngredientGroup</span><span class="p">(</span><span class="s2">&quot;proteins&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">igr</span> <span class="o">=</span> <span class="n">sIngredient</span><span class="p">(</span><span class="n">ingr</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
                    <span class="n">proteins</span><span class="o">.</span><span class="n">addIngredient</span><span class="p">(</span><span class="n">igr</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                        <span class="n">ap</span><span class="p">,</span> <span class="n">ar</span> <span class="o">=</span> <span class="n">gatherResult</span><span class="p">(</span>
                            <span class="n">ingr</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">],</span>
                            <span class="n">transpose</span><span class="p">,</span>
                            <span class="n">use_quaternion</span><span class="p">,</span>
                            <span class="nb">type</span><span class="o">=</span><span class="n">igr</span><span class="o">.</span><span class="n">ingredient_id</span><span class="p">,</span>
                            <span class="n">lefthand</span><span class="o">=</span><span class="n">lefthand</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">all_pos</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
                        <span class="n">all_rot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>
                <span class="n">co</span><span class="o">.</span><span class="n">addCompartment</span><span class="p">(</span><span class="n">interior</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">proteins</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">interior</span><span class="o">.</span><span class="n">addIngredientGroup</span><span class="p">(</span><span class="n">proteins</span><span class="p">)</span>
            <span class="c1">#            if fibers is not None:</span>
            <span class="c1">#                interior.addIngredientGroup(fibers)</span>
            <span class="n">root</span><span class="o">.</span><span class="n">addCompartment</span><span class="p">(</span><span class="n">co</span><span class="p">)</span>
    <span class="n">data_json</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">to_JSON</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">data_json</span><span class="p">,</span> <span class="n">all_pos</span><span class="p">,</span> <span class="n">all_rot</span></div>



<div class="viewcode-block" id="serializedRecipe_group_dic">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.serializedRecipe_group_dic">[docs]</a>
<span class="k">def</span> <span class="nf">serializedRecipe_group_dic</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">transpose</span><span class="p">,</span> <span class="n">use_quaternion</span><span class="p">,</span> <span class="n">lefthand</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># all_pos = []</span>
    <span class="c1"># all_rot = []</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">sCompartment</span><span class="p">(</span><span class="s2">&quot;root&quot;</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="s2">&quot;cytoplasme&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">sIngredientGroup</span><span class="p">(</span><span class="s2">&quot;cytoplasme&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ingr_name</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;ingredients&quot;</span><span class="p">]:</span>
            <span class="n">ingr</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">ingr_name</span><span class="p">]</span>
            <span class="n">kwds</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">ingr</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]),</span> <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">ingr</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]}</span>
            <span class="c1"># if ingr.type == &quot;Grow&quot;:</span>
            <span class="c1">#    igr = sIngredientFiber(ingr.composition_name, **kwds)</span>
            <span class="c1">#    group.addIngredientFiber(igr)</span>
            <span class="c1"># else:</span>
            <span class="n">igr</span> <span class="o">=</span> <span class="n">sIngredient</span><span class="p">(</span><span class="n">ingr</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
            <span class="n">group</span><span class="o">.</span><span class="n">addIngredient</span><span class="p">(</span><span class="n">igr</span><span class="p">)</span>
            <span class="c1"># ap, ar = gatherResult(ingr[&quot;results&quot;], transpose, use_quaternion, type=igr.ingredient_id, lefthand=lefthand)</span>
            <span class="c1"># all_pos.extend(ap)</span>
            <span class="c1"># all_rot.extend(ar)</span>
        <span class="n">root</span><span class="o">.</span><span class="n">addIngredientGroup</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">env</span><span class="p">[</span><span class="s2">&quot;compartments&quot;</span><span class="p">]:</span>
        <span class="n">co</span> <span class="o">=</span> <span class="n">sCompartment</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">rs</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="s2">&quot;compartments&quot;</span><span class="p">][</span><span class="n">o</span><span class="p">][</span><span class="s2">&quot;surface&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">rs</span><span class="p">:</span>
            <span class="n">group</span> <span class="o">=</span> <span class="n">sIngredientGroup</span><span class="p">(</span><span class="s2">&quot;surface&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ingr_name</span> <span class="ow">in</span> <span class="n">rs</span><span class="p">[</span><span class="s2">&quot;ingredients&quot;</span><span class="p">]:</span>
                <span class="n">ingr</span> <span class="o">=</span> <span class="n">rs</span><span class="p">[</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">ingr_name</span><span class="p">]</span>
                <span class="n">kwds</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">ingr</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]),</span> <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">ingr</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]}</span>
                <span class="n">igr</span> <span class="o">=</span> <span class="n">sIngredient</span><span class="p">(</span><span class="n">ingr</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
                <span class="n">group</span><span class="o">.</span><span class="n">addIngredient</span><span class="p">(</span><span class="n">igr</span><span class="p">)</span>

            <span class="n">co</span><span class="o">.</span><span class="n">addIngredientGroup</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="n">ri</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="s2">&quot;compartments&quot;</span><span class="p">][</span><span class="n">o</span><span class="p">][</span><span class="s2">&quot;interior&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ri</span><span class="p">:</span>
            <span class="n">group</span> <span class="o">=</span> <span class="n">sIngredientGroup</span><span class="p">(</span><span class="s2">&quot;interior&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ingr_name</span> <span class="ow">in</span> <span class="n">ri</span><span class="p">[</span><span class="s2">&quot;ingredients&quot;</span><span class="p">]:</span>
                <span class="n">ingr</span> <span class="o">=</span> <span class="n">ri</span><span class="p">[</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">ingr_name</span><span class="p">]</span>
                <span class="n">kwds</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">ingr</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]),</span> <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">ingr</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]}</span>
                <span class="c1">#                if ingr.type == &quot;Grow&quot;:</span>
                <span class="c1">#                    igr = sIngredientFiber(ingr.composition_name, **kwds)</span>
                <span class="c1">#                    group.addIngredientFiber(igr)</span>
                <span class="c1">#                else:</span>
                <span class="n">igr</span> <span class="o">=</span> <span class="n">sIngredient</span><span class="p">(</span><span class="n">ingr</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
                <span class="n">group</span><span class="o">.</span><span class="n">addIngredient</span><span class="p">(</span><span class="n">igr</span><span class="p">)</span>

            <span class="n">co</span><span class="o">.</span><span class="n">addIngredientGroup</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="n">root</span><span class="o">.</span><span class="n">addCompartment</span><span class="p">(</span><span class="n">co</span><span class="p">)</span>
    <span class="n">data_json</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">to_JSON</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">data_json</span>  <span class="c1"># , all_pos, all_rot</span></div>



<div class="viewcode-block" id="serializedRecipe_group">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.serializedRecipe_group">[docs]</a>
<span class="k">def</span> <span class="nf">serializedRecipe_group</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">transpose</span><span class="p">,</span> <span class="n">use_quaternion</span><span class="p">,</span> <span class="n">lefthand</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">all_pos</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_rot</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">sCompartment</span><span class="p">(</span><span class="s2">&quot;root&quot;</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">exteriorRecipe</span>
    <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">sIngredientGroup</span><span class="p">(</span><span class="s2">&quot;cytoplasme&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ingr</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">ingredients</span><span class="p">:</span>
            <span class="n">kwds</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">ingr</span><span class="o">.</span><span class="n">results</span><span class="p">),</span> <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">ingr</span><span class="o">.</span><span class="n">source</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">ingr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;Grow&quot;</span><span class="p">:</span>
                <span class="n">igr</span> <span class="o">=</span> <span class="n">sIngredientFiber</span><span class="p">(</span><span class="n">ingr</span><span class="o">.</span><span class="n">composition_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
                <span class="n">group</span><span class="o">.</span><span class="n">addIngredientFiber</span><span class="p">(</span><span class="n">igr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">igr</span> <span class="o">=</span> <span class="n">sIngredient</span><span class="p">(</span><span class="n">ingr</span><span class="o">.</span><span class="n">composition_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
                <span class="n">group</span><span class="o">.</span><span class="n">addIngredient</span><span class="p">(</span><span class="n">igr</span><span class="p">)</span>
            <span class="n">ap</span><span class="p">,</span> <span class="n">ar</span> <span class="o">=</span> <span class="n">gatherResult</span><span class="p">(</span>
                <span class="n">ingr</span><span class="o">.</span><span class="n">results</span><span class="p">,</span>
                <span class="n">transpose</span><span class="p">,</span>
                <span class="n">use_quaternion</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="n">igr</span><span class="o">.</span><span class="n">ingredient_id</span><span class="p">,</span>
                <span class="n">lefthand</span><span class="o">=</span><span class="n">lefthand</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">all_pos</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
            <span class="n">all_rot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>
        <span class="n">root</span><span class="o">.</span><span class="n">addIngredientGroup</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">compartments</span><span class="p">:</span>
        <span class="n">co</span> <span class="o">=</span> <span class="n">sCompartment</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">rs</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">surfaceRecipe</span>
        <span class="k">if</span> <span class="n">rs</span><span class="p">:</span>
            <span class="n">group</span> <span class="o">=</span> <span class="n">sIngredientGroup</span><span class="p">(</span><span class="s2">&quot;surface&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ingr</span> <span class="ow">in</span> <span class="n">rs</span><span class="o">.</span><span class="n">ingredients</span><span class="p">:</span>
                <span class="n">kwds</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">ingr</span><span class="o">.</span><span class="n">results</span><span class="p">),</span> <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">ingr</span><span class="o">.</span><span class="n">source</span><span class="p">}</span>
                <span class="k">if</span> <span class="n">ingr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;Grow&quot;</span><span class="p">:</span>
                    <span class="n">igr</span> <span class="o">=</span> <span class="n">sIngredientFiber</span><span class="p">(</span><span class="n">ingr</span><span class="o">.</span><span class="n">composition_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
                    <span class="n">group</span><span class="o">.</span><span class="n">addIngredientFiber</span><span class="p">(</span><span class="n">igr</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">igr</span> <span class="o">=</span> <span class="n">sIngredient</span><span class="p">(</span><span class="n">ingr</span><span class="o">.</span><span class="n">composition_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
                    <span class="n">group</span><span class="o">.</span><span class="n">addIngredient</span><span class="p">(</span><span class="n">igr</span><span class="p">)</span>
                <span class="n">ap</span><span class="p">,</span> <span class="n">ar</span> <span class="o">=</span> <span class="n">gatherResult</span><span class="p">(</span>
                    <span class="n">ingr</span><span class="o">.</span><span class="n">results</span><span class="p">,</span>
                    <span class="n">transpose</span><span class="p">,</span>
                    <span class="n">use_quaternion</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="n">igr</span><span class="o">.</span><span class="n">ingredient_id</span><span class="p">,</span>
                    <span class="n">lefthand</span><span class="o">=</span><span class="n">lefthand</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">all_pos</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
                <span class="n">all_rot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>
            <span class="n">co</span><span class="o">.</span><span class="n">addIngredientGroup</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="n">ri</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">innerRecipe</span>
        <span class="k">if</span> <span class="n">ri</span><span class="p">:</span>
            <span class="n">group</span> <span class="o">=</span> <span class="n">sIngredientGroup</span><span class="p">(</span><span class="s2">&quot;interior&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ingr</span> <span class="ow">in</span> <span class="n">ri</span><span class="o">.</span><span class="n">ingredients</span><span class="p">:</span>
                <span class="n">kwds</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">ingr</span><span class="o">.</span><span class="n">results</span><span class="p">),</span> <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">ingr</span><span class="o">.</span><span class="n">source</span><span class="p">}</span>
                <span class="k">if</span> <span class="n">ingr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;Grow&quot;</span><span class="p">:</span>
                    <span class="n">igr</span> <span class="o">=</span> <span class="n">sIngredientFiber</span><span class="p">(</span><span class="n">ingr</span><span class="o">.</span><span class="n">composition_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
                    <span class="n">group</span><span class="o">.</span><span class="n">addIngredientFiber</span><span class="p">(</span><span class="n">igr</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">igr</span> <span class="o">=</span> <span class="n">sIngredient</span><span class="p">(</span><span class="n">ingr</span><span class="o">.</span><span class="n">composition_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
                    <span class="n">group</span><span class="o">.</span><span class="n">addIngredient</span><span class="p">(</span><span class="n">igr</span><span class="p">)</span>
                <span class="n">ap</span><span class="p">,</span> <span class="n">ar</span> <span class="o">=</span> <span class="n">gatherResult</span><span class="p">(</span>
                    <span class="n">ingr</span><span class="o">.</span><span class="n">results</span><span class="p">,</span>
                    <span class="n">transpose</span><span class="p">,</span>
                    <span class="n">use_quaternion</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="n">igr</span><span class="o">.</span><span class="n">ingredient_id</span><span class="p">,</span>
                    <span class="n">lefthand</span><span class="o">=</span><span class="n">lefthand</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">all_pos</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
                <span class="n">all_rot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>
            <span class="n">co</span><span class="o">.</span><span class="n">addIngredientGroup</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="n">root</span><span class="o">.</span><span class="n">addCompartment</span><span class="p">(</span><span class="n">co</span><span class="p">)</span>
    <span class="n">data_json</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">to_JSON</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">data_json</span><span class="p">,</span> <span class="n">all_pos</span><span class="p">,</span> <span class="n">all_rot</span></div>



<span class="c1"># use as</span>
<span class="c1"># from autopack.IOutils import saveResultBinary</span>
<span class="c1"># saveResultBinary(env,&quot;C:\\Users\\ludov\\OneDrive\\Documents\\myRecipes\\test_tr&quot;,True,True,False)</span>
<span class="c1"># saveResultBinary(env,&quot;C:\\Users\\ludov\\OneDrive\\Documents\\myRecipes\\test_tr_lh&quot;,True,True,True)</span>
<span class="c1"># saveResultBinary(env,&quot;C:\\Users\\ludov\\OneDrive\\Documents\\myRecipes\\test&quot;,False,True,False)</span>
<span class="c1"># saveResultBinary(env,&quot;C:\\Users\\ludov\\OneDrive\\Documents\\myRecipes\\test_lh&quot;,False,True,True)</span>
<div class="viewcode-block" id="saveResultBinaryDic">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.saveResultBinaryDic">[docs]</a>
<span class="k">def</span> <span class="nf">saveResultBinaryDic</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">transpose</span><span class="p">,</span> <span class="n">use_quaternion</span><span class="p">,</span> <span class="n">lefthand</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># should follow the order of the serialized class order?</span>
    <span class="n">all_pos</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_rot</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fptr</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="s2">&quot;cytoplasme&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ingr_name</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;ingredients&quot;</span><span class="p">]:</span>
            <span class="n">ingr</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">ingr_name</span><span class="p">]</span>
            <span class="n">ap</span><span class="p">,</span> <span class="n">ar</span> <span class="o">=</span> <span class="n">gatherResult</span><span class="p">(</span>
                <span class="n">ingr</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">],</span> <span class="n">transpose</span><span class="p">,</span> <span class="n">use_quaternion</span><span class="p">,</span> <span class="n">lefthand</span><span class="o">=</span><span class="n">lefthand</span>
            <span class="p">)</span>
            <span class="n">all_pos</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
            <span class="n">all_rot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">env</span><span class="p">[</span><span class="s2">&quot;compartments&quot;</span><span class="p">]:</span>
        <span class="n">rs</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="s2">&quot;compartments&quot;</span><span class="p">][</span><span class="n">o</span><span class="p">][</span><span class="s2">&quot;surface&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">rs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ingr_name</span> <span class="ow">in</span> <span class="n">rs</span><span class="p">[</span><span class="s2">&quot;ingredients&quot;</span><span class="p">]:</span>
                <span class="n">ingr</span> <span class="o">=</span> <span class="n">rs</span><span class="p">[</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">ingr_name</span><span class="p">]</span>
                <span class="n">ap</span><span class="p">,</span> <span class="n">ar</span> <span class="o">=</span> <span class="n">gatherResult</span><span class="p">(</span>
                    <span class="n">ingr</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">],</span> <span class="n">transpose</span><span class="p">,</span> <span class="n">use_quaternion</span><span class="p">,</span> <span class="n">lefthand</span><span class="o">=</span><span class="n">lefthand</span>
                <span class="p">)</span>
                <span class="n">all_pos</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
                <span class="n">all_rot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>
        <span class="n">ri</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="s2">&quot;compartments&quot;</span><span class="p">][</span><span class="n">o</span><span class="p">][</span><span class="s2">&quot;interior&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ri</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ingr_name</span> <span class="ow">in</span> <span class="n">ri</span><span class="p">[</span><span class="s2">&quot;ingredients&quot;</span><span class="p">]:</span>
                <span class="n">ingr</span> <span class="o">=</span> <span class="n">ri</span><span class="p">[</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">ingr_name</span><span class="p">]</span>
                <span class="n">ap</span><span class="p">,</span> <span class="n">ar</span> <span class="o">=</span> <span class="n">gatherResult</span><span class="p">(</span>
                    <span class="n">ingr</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">],</span> <span class="n">transpose</span><span class="p">,</span> <span class="n">use_quaternion</span><span class="p">,</span> <span class="n">lefthand</span><span class="o">=</span><span class="n">lefthand</span>
                <span class="p">)</span>
                <span class="n">all_pos</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
                <span class="n">all_rot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>
    <span class="c1"># write allpos</span>
    <span class="n">fptr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_pos</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span>
    <span class="n">fptr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_rot</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span>
    <span class="n">fptr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">all_pos</span><span class="p">,</span> <span class="n">all_rot</span></div>



<div class="viewcode-block" id="toBinary">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.toBinary">[docs]</a>
<span class="k">def</span> <span class="nf">toBinary</span><span class="p">(</span><span class="n">all_pos</span><span class="p">,</span> <span class="n">all_rot</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="n">fptr</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
    <span class="n">fptr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_pos</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span>
    <span class="n">fptr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_rot</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span>
    <span class="n">fptr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="saveResultBinary">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.saveResultBinary">[docs]</a>
<span class="k">def</span> <span class="nf">saveResultBinary</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">transpose</span><span class="p">,</span> <span class="n">use_quaternion</span><span class="p">,</span> <span class="n">lefthand</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># should follow the order of the serialized class order?</span>
    <span class="n">all_pos</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_rot</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fptr</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">exteriorRecipe</span>
    <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ingr</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">ingredients</span><span class="p">:</span>
            <span class="n">ap</span><span class="p">,</span> <span class="n">ar</span> <span class="o">=</span> <span class="n">gatherResult</span><span class="p">(</span>
                <span class="n">ingr</span><span class="o">.</span><span class="n">results</span><span class="p">,</span> <span class="n">transpose</span><span class="p">,</span> <span class="n">use_quaternion</span><span class="p">,</span> <span class="n">lefthand</span><span class="o">=</span><span class="n">lefthand</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">uid</span>
            <span class="p">)</span>
            <span class="n">all_pos</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
            <span class="n">all_rot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>
            <span class="n">uid</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">compartments</span><span class="p">:</span>
        <span class="n">rs</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">surfaceRecipe</span>
        <span class="k">if</span> <span class="n">rs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ingr</span> <span class="ow">in</span> <span class="n">rs</span><span class="o">.</span><span class="n">ingredients</span><span class="p">:</span>
                <span class="n">ap</span><span class="p">,</span> <span class="n">ar</span> <span class="o">=</span> <span class="n">gatherResult</span><span class="p">(</span>
                    <span class="n">ingr</span><span class="o">.</span><span class="n">results</span><span class="p">,</span> <span class="n">transpose</span><span class="p">,</span> <span class="n">use_quaternion</span><span class="p">,</span> <span class="n">lefthand</span><span class="o">=</span><span class="n">lefthand</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">uid</span>
                <span class="p">)</span>
                <span class="n">all_pos</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
                <span class="n">all_rot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>
                <span class="n">uid</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">ri</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">innerRecipe</span>
        <span class="k">if</span> <span class="n">ri</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ingr</span> <span class="ow">in</span> <span class="n">ri</span><span class="o">.</span><span class="n">ingredients</span><span class="p">:</span>
                <span class="n">ap</span><span class="p">,</span> <span class="n">ar</span> <span class="o">=</span> <span class="n">gatherResult</span><span class="p">(</span>
                    <span class="n">ingr</span><span class="o">.</span><span class="n">results</span><span class="p">,</span> <span class="n">transpose</span><span class="p">,</span> <span class="n">use_quaternion</span><span class="p">,</span> <span class="n">lefthand</span><span class="o">=</span><span class="n">lefthand</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">uid</span>
                <span class="p">)</span>
                <span class="n">all_pos</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
                <span class="n">all_rot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>
                <span class="n">uid</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1"># write allpos</span>
    <span class="n">fptr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_pos</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span>  <span class="c1"># ?</span>
    <span class="n">fptr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_rot</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span>
    <span class="c1">#    numpy.array(all_pos, &#39;f&#39;).flatten().tofile(fptr)  # 4float position</span>
    <span class="c1">#    numpy.array(all_rot, &#39;f&#39;).flatten().tofile(fptr)  # 4flaot quaternion</span>
    <span class="n">fptr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="getAllPosRot">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.getAllPosRot">[docs]</a>
<span class="k">def</span> <span class="nf">getAllPosRot</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">transpose</span><span class="p">,</span> <span class="n">use_quaternion</span><span class="p">,</span> <span class="n">lefthand</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># should follow the order of the serialized class order?</span>
    <span class="n">all_pos</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_rot</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">exteriorRecipe</span>
    <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ingr</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">ingredients</span><span class="p">:</span>
            <span class="n">ap</span><span class="p">,</span> <span class="n">ar</span> <span class="o">=</span> <span class="n">gatherResult</span><span class="p">(</span>
                <span class="n">ingr</span><span class="o">.</span><span class="n">results</span><span class="p">,</span> <span class="n">transpose</span><span class="p">,</span> <span class="n">use_quaternion</span><span class="p">,</span> <span class="n">lefthand</span><span class="o">=</span><span class="n">lefthand</span>
            <span class="p">)</span>
            <span class="n">all_pos</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
            <span class="n">all_rot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">compartments</span><span class="p">:</span>
        <span class="n">rs</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">surfaceRecipe</span>
        <span class="k">if</span> <span class="n">rs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ingr</span> <span class="ow">in</span> <span class="n">rs</span><span class="o">.</span><span class="n">ingredients</span><span class="p">:</span>
                <span class="n">ap</span><span class="p">,</span> <span class="n">ar</span> <span class="o">=</span> <span class="n">gatherResult</span><span class="p">(</span>
                    <span class="n">ingr</span><span class="o">.</span><span class="n">results</span><span class="p">,</span> <span class="n">transpose</span><span class="p">,</span> <span class="n">use_quaternion</span><span class="p">,</span> <span class="n">lefthand</span><span class="o">=</span><span class="n">lefthand</span>
                <span class="p">)</span>
                <span class="n">all_pos</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
                <span class="n">all_rot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>
        <span class="n">ri</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">innerRecipe</span>
        <span class="k">if</span> <span class="n">ri</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ingr</span> <span class="ow">in</span> <span class="n">ri</span><span class="o">.</span><span class="n">ingredients</span><span class="p">:</span>
                <span class="n">ap</span><span class="p">,</span> <span class="n">ar</span> <span class="o">=</span> <span class="n">gatherResult</span><span class="p">(</span>
                    <span class="n">ingr</span><span class="o">.</span><span class="n">results</span><span class="p">,</span> <span class="n">transpose</span><span class="p">,</span> <span class="n">use_quaternion</span><span class="p">,</span> <span class="n">lefthand</span><span class="o">=</span><span class="n">lefthand</span>
                <span class="p">)</span>
                <span class="n">all_pos</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
                <span class="n">all_rot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>
    <span class="c1"># write allpos</span>
    <span class="k">return</span> <span class="n">all_pos</span><span class="p">,</span> <span class="n">all_rot</span></div>



<div class="viewcode-block" id="load_JsonString">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.load_JsonString">[docs]</a>
<span class="k">def</span> <span class="nf">load_JsonString</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">astring</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Setup the environment according the given json file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">env</span><span class="o">.</span><span class="n">jsondic</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">astring</span><span class="p">,</span> <span class="n">object_pairs_hook</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">)</span>
    <span class="n">setupFromJsonDic</span><span class="p">(</span>
        <span class="n">env</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="load_Json">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.load_Json">[docs]</a>
<span class="k">def</span> <span class="nf">load_Json</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">setupfile</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Setup the environment according the given json file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">setupfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">setupfile</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">setupfile</span>
    <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">jsondic</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">setupfile</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>  <span class="c1"># doesnt work with symbol link ?</span>
            <span class="k">if</span> <span class="n">autopack</span><span class="o">.</span><span class="n">use_json_hook</span><span class="p">:</span>
                <span class="n">env</span><span class="o">.</span><span class="n">jsondic</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                    <span class="n">fp</span><span class="p">,</span> <span class="n">object_pairs_hook</span><span class="o">=</span><span class="n">OrderedDict</span>
                <span class="p">)</span>  <span class="c1"># ,indent=4, separators=(&#39;,&#39;, &#39;: &#39;)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">env</span><span class="o">.</span><span class="n">jsondic</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
    <span class="n">setupFromJsonDic</span><span class="p">(</span>
        <span class="n">env</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="setupFromJsonDic">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.setupFromJsonDic">[docs]</a>
<span class="k">def</span> <span class="nf">setupFromJsonDic</span><span class="p">(</span>
    <span class="n">env</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">env</span><span class="o">.</span><span class="n">current_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">setupfile</span><span class="p">))</span>
    <span class="n">io_ingr</span> <span class="o">=</span> <span class="n">IOingredientTool</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">jsondic</span><span class="p">[</span><span class="s2">&quot;recipe&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
    <span class="n">env</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">jsondic</span><span class="p">[</span><span class="s2">&quot;recipe&quot;</span><span class="p">][</span><span class="s2">&quot;version&quot;</span><span class="p">]</span>
    <span class="c1"># is there any cutoms paths</span>
    <span class="k">if</span> <span class="s2">&quot;paths&quot;</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">jsondic</span><span class="p">[</span><span class="s2">&quot;recipe&quot;</span><span class="p">]:</span>
        <span class="n">env</span><span class="o">.</span><span class="n">custom_paths</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">jsondic</span><span class="p">[</span><span class="s2">&quot;recipe&quot;</span><span class="p">][</span>
            <span class="s2">&quot;paths&quot;</span>
        <span class="p">]</span>  <span class="c1"># list(env.jsondic[&quot;recipe&quot;][&quot;paths&quot;].items())</span>
        <span class="c1">#        autopack.replace_path.extend(env.custom_paths)#keyWordPAth,valuePath</span>
        <span class="n">autopack</span><span class="o">.</span><span class="n">updateReplacePath</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">custom_paths</span><span class="p">)</span>
    <span class="n">autopack</span><span class="o">.</span><span class="n">CURRENT_RECIPE_PATH</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">current_path</span>

    <span class="k">if</span> <span class="s2">&quot;gradients&quot;</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">jsondic</span><span class="p">:</span>
        <span class="n">env</span><span class="o">.</span><span class="n">gradients</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">gradientsnode</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">jsondic</span><span class="p">[</span><span class="s2">&quot;gradients&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gradientsnode</span><span class="p">):</span>  <span class="c1"># number of gradients defined</span>
            <span class="k">for</span> <span class="n">g_name</span> <span class="ow">in</span> <span class="n">gradientsnode</span><span class="p">:</span>
                <span class="n">g_dic</span> <span class="o">=</span> <span class="n">gradientsnode</span><span class="p">[</span><span class="n">g_name</span><span class="p">]</span>
                <span class="n">env</span><span class="o">.</span><span class="n">setGradient</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">g_name</span><span class="p">,</span>
                    <span class="n">mode</span><span class="o">=</span><span class="n">g_dic</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">],</span>
                    <span class="n">direction</span><span class="o">=</span><span class="n">g_dic</span><span class="p">[</span><span class="s2">&quot;direction&quot;</span><span class="p">],</span>
                    <span class="n">weight_mode</span><span class="o">=</span><span class="n">g_dic</span><span class="p">[</span><span class="s2">&quot;weight_mode&quot;</span><span class="p">],</span>
                    <span class="n">description</span><span class="o">=</span><span class="n">g_dic</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">],</span>
                    <span class="n">pick_mode</span><span class="o">=</span><span class="n">g_dic</span><span class="p">[</span><span class="s2">&quot;pick_mode&quot;</span><span class="p">],</span>
                    <span class="n">radius</span><span class="o">=</span><span class="n">g_dic</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">],</span>
                <span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;grid&quot;</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">jsondic</span><span class="p">:</span>
        <span class="n">gridnode</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">jsondic</span><span class="p">[</span><span class="s2">&quot;grid&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gridnode</span><span class="p">):</span>
            <span class="n">env</span><span class="o">.</span><span class="n">grid_filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">gridnode</span><span class="p">[</span><span class="s2">&quot;grid_storage&quot;</span><span class="p">])</span>
            <span class="n">env</span><span class="o">.</span><span class="n">grid_result_filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">gridnode</span><span class="p">[</span><span class="s2">&quot;grid_result&quot;</span><span class="p">])</span>

    <span class="n">sortkey</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">lower</span>

    <span class="k">if</span> <span class="s2">&quot;cytoplasme&quot;</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">jsondic</span><span class="p">:</span>
        <span class="n">ingrs_dic</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">jsondic</span><span class="p">[</span><span class="s2">&quot;cytoplasme&quot;</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ingrs_dic</span><span class="p">):</span>
            <span class="n">rCyto</span> <span class="o">=</span> <span class="n">Recipe</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">ing_name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ingrs_dic</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">sortkey</span><span class="p">):</span>  <span class="c1"># ingrs_dic:</span>
                <span class="c1"># either xref or defined</span>
                <span class="n">ing_dic</span> <span class="o">=</span> <span class="n">ingrs_dic</span><span class="p">[</span><span class="n">ing_name</span><span class="p">]</span>
                <span class="n">ingr</span> <span class="o">=</span> <span class="n">io_ingr</span><span class="o">.</span><span class="n">makeIngredientFromJson</span><span class="p">(</span>
                    <span class="n">env</span><span class="p">,</span> <span class="n">inode</span><span class="o">=</span><span class="n">ing_dic</span><span class="p">,</span> <span class="n">recipe</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">name</span>
                <span class="p">)</span>
                <span class="n">rCyto</span><span class="o">.</span><span class="n">addIngredient</span><span class="p">(</span><span class="n">ingr</span><span class="p">)</span>
                <span class="c1"># setup recipe</span>
            <span class="n">env</span><span class="o">.</span><span class="n">setExteriorRecipe</span><span class="p">(</span><span class="n">rCyto</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;compartments&quot;</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">jsondic</span><span class="p">:</span>
        <span class="c1"># use some include ?</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">jsondic</span><span class="p">[</span><span class="s2">&quot;compartments&quot;</span><span class="p">]):</span>
            <span class="c1"># if &quot;include&quot; in env.jsondic[&quot;compartments&quot;]:</span>
            <span class="c1"># include all compartments from given filename.</span>
            <span class="c1"># transform the geometry of the compartment packing rep</span>
            <span class="k">for</span> <span class="n">cname</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">jsondic</span><span class="p">[</span><span class="s2">&quot;compartments&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">cname</span> <span class="o">==</span> <span class="s2">&quot;include&quot;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ncompart</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                        <span class="n">env</span><span class="o">.</span><span class="n">jsondic</span><span class="p">[</span><span class="s2">&quot;compartments&quot;</span><span class="p">][</span><span class="s2">&quot;include&quot;</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="n">addCompartments</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">ncompart</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">io_ingr</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">comp_dic</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">jsondic</span><span class="p">[</span><span class="s2">&quot;compartments&quot;</span><span class="p">][</span><span class="n">cname</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">comp_dic</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
                <span class="n">geom</span> <span class="o">=</span> <span class="n">comp_dic</span><span class="p">[</span><span class="s2">&quot;geom&quot;</span><span class="p">]</span>
                <span class="n">gname</span> <span class="o">=</span> <span class="n">name</span>
                <span class="n">mtype</span> <span class="o">=</span> <span class="s2">&quot;file&quot;</span>
                <span class="k">if</span> <span class="s2">&quot;meshType&quot;</span> <span class="ow">in</span> <span class="n">comp_dic</span><span class="p">:</span>
                    <span class="n">mtype</span> <span class="o">=</span> <span class="n">comp_dic</span><span class="p">[</span><span class="s2">&quot;meshType&quot;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="s2">&quot;geom_type&quot;</span> <span class="ow">in</span> <span class="n">comp_dic</span><span class="p">:</span>
                    <span class="n">mtype</span> <span class="o">=</span> <span class="n">comp_dic</span><span class="p">[</span><span class="s2">&quot;geom_type&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="s2">&quot;gname&quot;</span> <span class="ow">in</span> <span class="n">comp_dic</span><span class="p">:</span>
                    <span class="n">gname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">comp_dic</span><span class="p">[</span><span class="s2">&quot;gname&quot;</span><span class="p">])</span>
                <span class="n">rep</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="s2">&quot;rep&quot;</span> <span class="ow">in</span> <span class="n">comp_dic</span><span class="p">:</span>
                    <span class="n">rep</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">comp_dic</span><span class="p">[</span><span class="s2">&quot;rep&quot;</span><span class="p">])</span>
                <span class="n">rep_file</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="s2">&quot;rep_file&quot;</span> <span class="ow">in</span> <span class="n">comp_dic</span><span class="p">:</span>
                    <span class="n">rep_file</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">comp_dic</span><span class="p">[</span><span class="s2">&quot;rep_file&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">rep</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rep</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">rep</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">rep</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">rname</span> <span class="o">=</span> <span class="n">rep_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">fileName</span><span class="p">,</span> <span class="n">fileExtension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">rname</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">fileExtension</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">fileExtension</span> <span class="o">=</span> <span class="n">autopack</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">hext</span>
                        <span class="k">if</span> <span class="n">fileExtension</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                            <span class="n">rep_file</span> <span class="o">=</span> <span class="n">rep_file</span> <span class="o">+</span> <span class="n">fileExtension</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">rep_file</span> <span class="o">=</span> <span class="n">rep_file</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">fileExtension</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rep</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">rep_file</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">compartment</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">create_compartment</span><span class="p">(</span>
                    <span class="n">name</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">gname</span><span class="p">,</span> <span class="n">rep</span><span class="p">,</span> <span class="n">rep_file</span><span class="p">,</span> <span class="n">mtype</span>
                <span class="p">)</span>
                <span class="n">env</span><span class="o">.</span><span class="n">addCompartment</span><span class="p">(</span><span class="n">compartment</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;surface&quot;</span> <span class="ow">in</span> <span class="n">comp_dic</span><span class="p">:</span>
                    <span class="n">snode</span> <span class="o">=</span> <span class="n">comp_dic</span><span class="p">[</span><span class="s2">&quot;surface&quot;</span><span class="p">]</span>
                    <span class="n">ingrs_dic</span> <span class="o">=</span> <span class="n">snode</span><span class="p">[</span><span class="s2">&quot;ingredients&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ingrs_dic</span><span class="p">):</span>
                        <span class="n">rSurf</span> <span class="o">=</span> <span class="n">Recipe</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;surf_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">compartments</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                        <span class="k">for</span> <span class="n">ing_name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ingrs_dic</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">sortkey</span><span class="p">):</span>  <span class="c1"># ingrs_dic:</span>
                            <span class="c1"># either xref or defined</span>
                            <span class="n">ing_dic</span> <span class="o">=</span> <span class="n">ingrs_dic</span><span class="p">[</span><span class="n">ing_name</span><span class="p">]</span>
                            <span class="n">ingr</span> <span class="o">=</span> <span class="n">io_ingr</span><span class="o">.</span><span class="n">makeIngredientFromJson</span><span class="p">(</span>
                                <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">inode</span><span class="o">=</span><span class="n">ing_dic</span><span class="p">,</span> <span class="n">recipe</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">name</span>
                            <span class="p">)</span>
                            <span class="n">rSurf</span><span class="o">.</span><span class="n">addIngredient</span><span class="p">(</span><span class="n">ingr</span><span class="p">)</span>
                            <span class="c1"># setup recipe</span>
                        <span class="n">compartment</span><span class="o">.</span><span class="n">setSurfaceRecipe</span><span class="p">(</span><span class="n">rSurf</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;interior&quot;</span> <span class="ow">in</span> <span class="n">comp_dic</span><span class="p">:</span>
                    <span class="n">snode</span> <span class="o">=</span> <span class="n">comp_dic</span><span class="p">[</span><span class="s2">&quot;interior&quot;</span><span class="p">]</span>
                    <span class="n">ingrs_dic</span> <span class="o">=</span> <span class="n">snode</span><span class="p">[</span><span class="s2">&quot;ingredients&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ingrs_dic</span><span class="p">):</span>
                        <span class="c1">#                        rMatrix = Recipe(name=o.name+&quot;_int&quot;)</span>
                        <span class="n">rMatrix</span> <span class="o">=</span> <span class="n">Recipe</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;int_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">compartments</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                        <span class="k">for</span> <span class="n">ing_name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ingrs_dic</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">sortkey</span><span class="p">):</span>  <span class="c1"># ingrs_dic:</span>
                            <span class="c1"># either xref or defined</span>
                            <span class="n">ing_dic</span> <span class="o">=</span> <span class="n">ingrs_dic</span><span class="p">[</span><span class="n">ing_name</span><span class="p">]</span>
                            <span class="n">ingr</span> <span class="o">=</span> <span class="n">io_ingr</span><span class="o">.</span><span class="n">makeIngredientFromJson</span><span class="p">(</span>
                                <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">inode</span><span class="o">=</span><span class="n">ing_dic</span><span class="p">,</span> <span class="n">recipe</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">name</span>
                            <span class="p">)</span>
                            <span class="n">rMatrix</span><span class="o">.</span><span class="n">addIngredient</span><span class="p">(</span><span class="n">ingr</span><span class="p">)</span>
                            <span class="c1"># setup recipe</span>
                        <span class="n">compartment</span><span class="o">.</span><span class="n">setInnerRecipe</span><span class="p">(</span><span class="n">rMatrix</span><span class="p">)</span>
                    <span class="c1"># Go through all ingredient and setup the partner</span>
    <span class="n">env</span><span class="o">.</span><span class="n">loopThroughIngr</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">set_partners_ingredient</span><span class="p">)</span>
    <span class="c1"># restore env.molecules if any resuylt was loaded</span>
    <span class="n">env</span><span class="o">.</span><span class="n">loopThroughIngr</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">restore_molecules_array</span><span class="p">)</span></div>



<div class="viewcode-block" id="load_MixedasJson">
<a class="viewcode-back" href="../../../cellpack.autopack.html#cellpack.autopack.IOutils.load_MixedasJson">[docs]</a>
<span class="k">def</span> <span class="nf">load_MixedasJson</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">resultfilename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transpose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="c1">#        from upy.hostHelper import Helper as helper</span>
    <span class="k">if</span> <span class="n">resultfilename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">resultfilename</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">result_file</span>
    <span class="c1"># use the current dictionary ?jsondic</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">resultfilename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>  <span class="c1"># doesnt work with symbol link ?</span>
        <span class="k">if</span> <span class="n">autopack</span><span class="o">.</span><span class="n">use_json_hook</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">result_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                <span class="n">fp</span><span class="p">,</span> <span class="n">object_pairs_hook</span><span class="o">=</span><span class="n">OrderedDict</span>
            <span class="p">)</span>  <span class="c1"># ,indent=4, separators=(&#39;,&#39;, &#39;: &#39;)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">result_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="c1"># needto parse</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">orgaresult</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">exteriorRecipe</span>
    <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;cytoplasme&quot;</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">result_json</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;ingredients&quot;</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">result_json</span><span class="p">[</span><span class="s2">&quot;cytoplasme&quot;</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">ingr</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">ingredients</span><span class="p">:</span>
                    <span class="n">name_ingr</span> <span class="o">=</span> <span class="n">ingr</span><span class="o">.</span><span class="n">name</span>
                    <span class="k">if</span> <span class="n">name_ingr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">result_json</span><span class="p">[</span><span class="s2">&quot;cytoplasme&quot;</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">]:</span>
                        <span class="c1"># backward compatiblity</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">ingr</span><span class="o">.</span><span class="n">composition_name</span>
                            <span class="ow">not</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">result_json</span><span class="p">[</span><span class="s2">&quot;cytoplasme&quot;</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">]</span>
                        <span class="p">):</span>
                            <span class="k">continue</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">name_ingr</span> <span class="o">=</span> <span class="n">ingr</span><span class="o">.</span><span class="n">composition_name</span>
                    <span class="n">iresults</span><span class="p">,</span> <span class="n">ingrname</span><span class="p">,</span> <span class="n">ingrcompNum</span><span class="p">,</span> <span class="n">ptInd</span><span class="p">,</span> <span class="n">rad</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">getOneIngrJson</span><span class="p">(</span>
                        <span class="n">ingr</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">result_json</span><span class="p">[</span><span class="s2">&quot;cytoplasme&quot;</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">name_ingr</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">iresults</span><span class="p">:</span>  <span class="c1"># what if quaternion ?</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>  <span class="c1"># quaternion</span>
                            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
                                    <span class="n">rot</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">matrix_from_quaternion</span><span class="p">(</span>
                                        <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                    <span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>  <span class="c1"># transpose ?</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">rot</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">matrix_from_quaternion</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># transpose ?</span>
                                    <span class="c1">#                        ingr.results.append([numpy.array(r[0]),rot])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">rot</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">rot</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">rot</span><span class="p">,</span> <span class="n">ingrname</span><span class="p">,</span> <span class="n">ingrcompNum</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="c1"># organelle ingr</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">orga</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">compartments</span><span class="p">):</span>
        <span class="n">orgaresult</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        <span class="c1"># organelle surface ingr</span>
        <span class="k">if</span> <span class="n">orga</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">result_json</span><span class="p">[</span><span class="s2">&quot;compartments&quot;</span><span class="p">]:</span>
            <span class="k">continue</span>
        <span class="n">rs</span> <span class="o">=</span> <span class="n">orga</span><span class="o">.</span><span class="n">surfaceRecipe</span>
        <span class="k">if</span> <span class="n">rs</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;surface&quot;</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">result_json</span><span class="p">[</span><span class="s2">&quot;compartments&quot;</span><span class="p">][</span><span class="n">orga</span><span class="o">.</span><span class="n">name</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">ingr</span> <span class="ow">in</span> <span class="n">rs</span><span class="o">.</span><span class="n">ingredients</span><span class="p">:</span>
                    <span class="n">name_ingr</span> <span class="o">=</span> <span class="n">ingr</span><span class="o">.</span><span class="n">name</span>
                    <span class="c1"># replace number by name ?</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">orga</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_surf_&quot;</span> <span class="o">+</span> <span class="n">ingr</span><span class="o">.</span><span class="n">composition_name</span>
                        <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">result_json</span><span class="p">[</span><span class="s2">&quot;compartments&quot;</span><span class="p">][</span><span class="n">orga</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;surface&quot;</span><span class="p">][</span>
                            <span class="s2">&quot;ingredients&quot;</span>
                        <span class="p">]</span>
                    <span class="p">):</span>
                        <span class="n">name_ingr</span> <span class="o">=</span> <span class="n">orga</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_surf_&quot;</span> <span class="o">+</span> <span class="n">ingr</span><span class="o">.</span><span class="n">composition_name</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">name_ingr</span>
                        <span class="ow">not</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">result_json</span><span class="p">[</span><span class="s2">&quot;compartments&quot;</span><span class="p">][</span><span class="n">orga</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;surface&quot;</span><span class="p">][</span>
                            <span class="s2">&quot;ingredients&quot;</span>
                        <span class="p">]</span>
                    <span class="p">):</span>
                        <span class="c1"># backward compatiblity</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">ingr</span><span class="o">.</span><span class="n">composition_name</span>
                            <span class="ow">not</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">result_json</span><span class="p">[</span><span class="s2">&quot;compartments&quot;</span><span class="p">][</span><span class="n">orga</span><span class="o">.</span><span class="n">name</span><span class="p">][</span>
                                <span class="s2">&quot;surface&quot;</span>
                            <span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">]</span>
                        <span class="p">):</span>
                            <span class="k">continue</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">name_ingr</span> <span class="o">=</span> <span class="n">ingr</span><span class="o">.</span><span class="n">composition_name</span>
                    <span class="n">iresults</span><span class="p">,</span> <span class="n">ingrname</span><span class="p">,</span> <span class="n">ingrcompNum</span><span class="p">,</span> <span class="n">ptInd</span><span class="p">,</span> <span class="n">rad</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">getOneIngrJson</span><span class="p">(</span>
                        <span class="n">ingr</span><span class="p">,</span>
                        <span class="n">env</span><span class="o">.</span><span class="n">result_json</span><span class="p">[</span><span class="s2">&quot;compartments&quot;</span><span class="p">][</span><span class="n">orga</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;surface&quot;</span><span class="p">][</span>
                            <span class="s2">&quot;ingredients&quot;</span>
                        <span class="p">][</span><span class="n">name_ingr</span><span class="p">],</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">iresults</span><span class="p">:</span>
                        <span class="n">rot</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>  <span class="c1"># quaternion</span>
                            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
                                    <span class="n">rot</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">matrix_from_quaternion</span><span class="p">(</span>
                                        <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                    <span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>  <span class="c1"># transpose ?</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">rot</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">matrix_from_quaternion</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># transpose ?</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">rot</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                            <span class="c1">#                        ingr.results.append([numpy.array(r[0]),rot])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">rot</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                        <span class="n">orgaresult</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">ingrcompNum</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">rot</span><span class="p">,</span> <span class="n">ingrname</span><span class="p">,</span> <span class="n">ingrcompNum</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="p">)</span>
        <span class="c1"># organelle matrix ingr</span>
        <span class="n">ri</span> <span class="o">=</span> <span class="n">orga</span><span class="o">.</span><span class="n">innerRecipe</span>
        <span class="k">if</span> <span class="n">ri</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;interior&quot;</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">result_json</span><span class="p">[</span><span class="s2">&quot;compartments&quot;</span><span class="p">][</span><span class="n">orga</span><span class="o">.</span><span class="n">name</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">ingr</span> <span class="ow">in</span> <span class="n">ri</span><span class="o">.</span><span class="n">ingredients</span><span class="p">:</span>
                    <span class="n">name_ingr</span> <span class="o">=</span> <span class="n">ingr</span><span class="o">.</span><span class="n">name</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">orga</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_int_&quot;</span> <span class="o">+</span> <span class="n">ingr</span><span class="o">.</span><span class="n">composition_name</span>
                        <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">result_json</span><span class="p">[</span><span class="s2">&quot;compartments&quot;</span><span class="p">][</span><span class="n">orga</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;interior&quot;</span><span class="p">][</span>
                            <span class="s2">&quot;ingredients&quot;</span>
                        <span class="p">]</span>
                    <span class="p">):</span>
                        <span class="n">name_ingr</span> <span class="o">=</span> <span class="n">orga</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_int_&quot;</span> <span class="o">+</span> <span class="n">ingr</span><span class="o">.</span><span class="n">composition_name</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">name_ingr</span>
                        <span class="ow">not</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">result_json</span><span class="p">[</span><span class="s2">&quot;compartments&quot;</span><span class="p">][</span><span class="n">orga</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;interior&quot;</span><span class="p">][</span>
                            <span class="s2">&quot;ingredients&quot;</span>
                        <span class="p">]</span>
                    <span class="p">):</span>
                        <span class="c1"># backward compatiblity</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">ingr</span><span class="o">.</span><span class="n">composition_name</span>
                            <span class="ow">not</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">result_json</span><span class="p">[</span><span class="s2">&quot;compartments&quot;</span><span class="p">][</span><span class="n">orga</span><span class="o">.</span><span class="n">name</span><span class="p">][</span>
                                <span class="s2">&quot;interior&quot;</span>
                            <span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">]</span>
                        <span class="p">):</span>
                            <span class="k">continue</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">name_ingr</span> <span class="o">=</span> <span class="n">ingr</span><span class="o">.</span><span class="n">composition_name</span>
                    <span class="n">iresults</span><span class="p">,</span> <span class="n">ingrname</span><span class="p">,</span> <span class="n">ingrcompNum</span><span class="p">,</span> <span class="n">ptInd</span><span class="p">,</span> <span class="n">rad</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">getOneIngrJson</span><span class="p">(</span>
                        <span class="n">ingr</span><span class="p">,</span>
                        <span class="n">env</span><span class="o">.</span><span class="n">result_json</span><span class="p">[</span><span class="s2">&quot;compartments&quot;</span><span class="p">][</span><span class="n">orga</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;interior&quot;</span><span class="p">][</span>
                            <span class="s2">&quot;ingredients&quot;</span>
                        <span class="p">][</span><span class="n">name_ingr</span><span class="p">],</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">iresults</span><span class="p">:</span>
                        <span class="n">rot</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>  <span class="c1"># quaternion</span>
                            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
                                    <span class="n">rot</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">matrix_from_quaternion</span><span class="p">(</span>
                                        <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                    <span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>  <span class="c1"># transpose ?</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">rot</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">matrix_from_quaternion</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># transpose ?</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">rot</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                            <span class="c1">#                        ingr.results.append([numpy.array(r[0]),rot])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">rot</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                        <span class="n">orgaresult</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">ingrcompNum</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">rot</span><span class="p">,</span> <span class="n">ingrname</span><span class="p">,</span> <span class="n">ingrcompNum</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="p">)</span>
    <span class="n">freePoint</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># pickle.load(rfile)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">rfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">resultfilename</span> <span class="o">+</span> <span class="s2">&quot;_free_points&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
        <span class="n">freePoint</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">rfile</span><span class="p">)</span>
        <span class="n">rfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>  <span class="c1"># noqa: E722</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">orgaresult</span><span class="p">,</span> <span class="n">freePoint</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">cellPack 1.0.7 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../cellpack.html" >cellpack</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../autopack.html" >cellpack.autopack</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">cellpack.autopack.IOutils</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2021, Megan Riel-Mehan.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>